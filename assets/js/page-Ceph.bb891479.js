(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{707:function(s,a,t){"use strict";t.r(a);var e=t(1),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"ceph"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ceph"}},[s._v("#")]),s._v(" Ceph")]),s._v(" "),t("p",[s._v("：一个分布式存储系统。可以将多个主机的磁盘联网组合成一个资源池，提供块存储、文件存储、对象存储服务。")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://docs.ceph.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方文档"),t("OutboundLink")],1)]),s._v(" "),t("li",[s._v("读音为 "),t("code",[s._v("/ˈsɛf/")])]),s._v(" "),t("li",[s._v("采用 C++ 开发。")]),s._v(" "),t("li",[s._v("2006 年由 Sage Weil 发布，2014 年被红帽公司收购。")])]),s._v(" "),t("h2",{attrs:{id:"原理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#原理"}},[s._v("#")]),s._v(" 原理")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("Ceph 集群分布式部署在多个主机上，运行多种服务进程：")]),s._v(" "),t("ul",[t("li",[s._v("Monitor（MON）\n"),t("ul",[t("li",[s._v("负责存储、维护 Cluster Map ，比如各个服务的地址、配置、状态等信息。")]),s._v(" "),t("li",[s._v("支持部署多个实例，基于 Paxos 算法实现一致性。")]),s._v(" "),t("li",[s._v("每个实例占用 1GB 以上内存。")]),s._v(" "),t("li",[s._v("客户端一般通过访问 Monitor 来与 Ceph 集群交互。")])])]),s._v(" "),t("li",[s._v("Manager（MGR）\n"),t("ul",[t("li",[s._v("负责管理一些功能模块，比如 Dashboard 。")]),s._v(" "),t("li",[s._v("每个实例都会运行 Dashboard 模块，提供 Web 管理页面。集成了一套 grafana、prometheus、node_exporter、alertmanager 监控进程。")])])]),s._v(" "),t("li",[s._v("Object Storage Daemon（OSD）\n"),t("ul",[t("li",[s._v("负责将数据存储到设备中，供用户读写。")]),s._v(" "),t("li",[s._v("通常在每个主机上，将存储设备格式化为 LVM 逻辑卷，并部署一个 OSD 进程来管理。\n"),t("ul",[t("li",[s._v("将 OSD 元数据保存在 LVM label 中，方便发现与逻辑卷关联的 OSD 。")])])])])]),s._v(" "),t("li",[s._v("Crash\n"),t("ul",[t("li",[s._v("负责收集其它服务的崩溃信息。")])])]),s._v(" "),t("li",[s._v("Meta Data Server（MDS）\n"),t("ul",[t("li",[s._v("负责存储 CephFS 文件系统的元数据，比如文件权限、属性。")]),s._v(" "),t("li",[s._v("启用文件存储时才需要。将文件的内容存储在 OSD ，而元数据存储在 MDS 服务器。")])])]),s._v(" "),t("li",[s._v("RADOS Gateway（RGW）\n"),t("ul",[t("li",[s._v("通过 RESTful API 提供对象存储功能。")]),s._v(" "),t("li",[s._v("启用对象存储时才需要。")])])])])]),s._v(" "),t("li",[t("p",[s._v("RADOS ：Ceph 的存储层，以对象存储的形式存储所有数据，因此存储数据的基本单位为 object 。")]),s._v(" "),t("ul",[t("li",[s._v("每个 object 的默认大小为 4MB ，拥有一个在集群内唯一的 object id 。")]),s._v(" "),t("li",[s._v("Ceph 会将 object 根据哈希值分配到一些 pg（Placement Group） 中，从而方便分组管理大量 object 。")]),s._v(" "),t("li",[s._v("支持创建多个存储池（Pool），对 pg 进行分组管理。")])])]),s._v(" "),t("li",[t("p",[s._v("应用程序可通过 librados 库访问 RADOS 。librados 库提供了三种常用的存储接口：")]),s._v(" "),t("ul",[t("li",[s._v("librbd\n"),t("ul",[t("li",[s._v("：用于块存储。")]),s._v(" "),t("li",[s._v("Ceph 不依赖其它文件系统，可以用自带的存储后端 BlueStore 直接管理 HDD、SSD 硬盘。")])])]),s._v(" "),t("li",[s._v("MDS\n"),t("ul",[t("li",[s._v("：用于文件存储。")]),s._v(" "),t("li",[s._v("提供了一种网络文件系统 CephFS ，兼容 POSIX 文件系统。")])])]),s._v(" "),t("li",[s._v("RADOS Gateway\n"),t("ul",[t("li",[s._v("：用于对象存储，兼容 S3、Swift 。")])])])])]),s._v(" "),t("li",[t("p",[s._v("Ceph 新增数据的流程：")]),s._v(" "),t("ol",[t("li",[s._v("应用程序访问 Monitor ，获知所有 OSD 的信息。")]),s._v(" "),t("li",[s._v("将数据分割为以 object 为单位，再以 pg 为单位分组。")]),s._v(" "),t("li",[s._v("将 pg 分配到一些 OSD 中存储。\n"),t("ul",[t("li",[s._v("应用程序直接与 OSD 进程通信，不需要经过 Monitor 中转，因此分散了负载压力。")]),s._v(" "),t("li",[s._v("应用程序和 OSD 进程都能根据 CRUSH 算法计算出每个 pg 应该存储到哪个 OSD 的哪个位置，不需要查表，因此效率更高。")])])])])])]),s._v(" "),t("h2",{attrs:{id:"部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#部署"}},[s._v("#")]),s._v(" 部署")]),s._v(" "),t("p",[s._v("Ceph 有多种部署方式：")]),s._v(" "),t("ul",[t("li",[s._v("ceph-ansible ：基于 ansible playbook 部署 Ceph 集群。")]),s._v(" "),t("li",[s._v("ceph-deploy ：一个命令行工具，已停止维护。")]),s._v(" "),t("li",[s._v("Cephadm ：一个 Python3 脚本，用于以容器形式部署 Ceph 集群，通过编排（Orchestrator，orch）接口控制 Ceph 。")]),s._v(" "),t("li",[s._v("Rook ：用于在 k8s 中部署 Ceph 集群。")])]),s._v(" "),t("h3",{attrs:{id:"版本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#版本"}},[s._v("#")]),s._v(" 版本")]),s._v(" "),t("p",[s._v("大概每年发布一个大版本：")]),s._v(" "),t("ul",[t("li",[s._v("v9 ：版本名为 Infernalis ，2015 年发布。")]),s._v(" "),t("li",[s._v("v15 ：版本名为 Octopus ，2020 年发布。")]),s._v(" "),t("li",[s._v("v16 ：版本名为 Pacific ，2021 年发布。")])]),s._v(" "),t("h3",{attrs:{id:"cephadm"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cephadm"}},[s._v("#")]),s._v(" Cephadm")]),s._v(" "),t("p",[s._v("部署步骤：")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("下载 Cephadm 脚本：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("version")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("pacific\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://github.com/ceph/ceph/raw/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${version}")]),s._v("/src/cephadm/cephadm\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("在当前主机上部署一个初始化的 Ceph 集群：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("python3 cephadm bootstrap --mon-ip "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("ip"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("该命令会：")]),s._v(" "),t("ul",[t("li",[s._v("采用指定 IP 作为当前主机的 IP 。")]),s._v(" "),t("li",[s._v("检查本机是否安装了依赖软件，没有则自动安装：\n"),t("ul",[t("li",[s._v("docker 或 podman 容器引擎")]),s._v(" "),t("li",[s._v("systemctl")]),s._v(" "),t("li",[s._v("lvcreate")]),s._v(" "),t("li",[s._v("chronyd")])])]),s._v(" "),t("li",[s._v("以容器形式运行一个 Monitor 和 Manager 进程，并在防火墙开通相应端口。")]),s._v(" "),t("li",[s._v("为 Ceph 集群生成一个新的 SSH 密钥。\n"),t("ul",[t("li",[s._v("密钥保存到 /etc/ceph/ceph.client.admin.keyring 文件。")]),s._v(" "),t("li",[s._v("公钥保存到 /etc/ceph/ceph.pub 文件，并添加到 /root/.ssh/authorized_keys 文件。")])])]),s._v(" "),t("li",[s._v("给当前主机添加 _admin 标签。\n"),t("ul",[t("li",[s._v("如果主机带有 _admin 标签，则会自动拷贝私钥文件和 /etc/ceph/ceph.conf 到该主机，允许它们管理集群。")]),s._v(" "),t("li",[s._v("如果主机带有 _no_schedule 标签，则不会在该主机部署服务进程。")])])]),s._v(" "),t("li",[s._v("启动 Ceph Dashboard ，并在终端打印初始的账号、密码。\n"),t("ul",[t("li",[s._v("默认监听 HTTPS 8443 端口，可以禁用 SSL 协议："),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("ceph config "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" mgr mgr/dashboard/ssl "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\nceph config "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" mgr mgr/dashboard/server_port "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\nceph config "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" mgr mgr/dashboard/ssl_server_port "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8443")]),s._v("\nceph mgr module disable dashboard\nceph mgr module "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" dashboard\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])])])])])])]),s._v(" "),t("li",[t("p",[s._v("进入 ceph shell ：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("python3 cephadm shell\nceph status\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ul",[t("li",[s._v("也可以执行 "),t("code",[s._v("yum install ceph-common")]),s._v(" ，在宿主机上安装 ceph 命令。")])])]),s._v(" "),t("li",[t("p",[s._v("添加其它主机")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("ceph orch "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" host2 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.2\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("需要先拷贝 SSH 公钥到目标主机："),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("ssh-copy-id -f -i /etc/ceph/ceph.pub root@10.0.0.2\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])])])]),s._v(" "),t("li",[t("p",[s._v("部署 OSD 进程：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("ceph-volume lvm zap /dev/vdb --destroy    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 擦除一个磁盘")]),s._v("\nceph orch daemon "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" osd host1:/dev/vdb   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建 OSD 进程，管理磁盘")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])])]),s._v(" "),t("p",[s._v("命令：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("python3 cephadm\n                version\n                check-host                        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检查本机是否安装了 cephadm 依赖")]),s._v("\n                bootstrap --mon-ip "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("ip"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 引导启动一个新集群，重复执行则会部署多个集群")]),s._v("\n                rm-cluster --fsid "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("fsid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" --force  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除集群，需要指定集群 ID")]),s._v("\n                shell                             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打开 ceph shell ，这会创建一个临时的 ceph 容器")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("                                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出当前主机上的服务进程")]),s._v("\n                logs --name "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看指定服务进程的日志")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("ul",[t("li",[s._v("cephadm 将日志保存到 journalctl ，也可以直接看容器日志。")])]),s._v(" "),t("h2",{attrs:{id:"管理命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#管理命令"}},[s._v("#")]),s._v(" 管理命令")]),s._v(" "),t("h3",{attrs:{id:"集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#集群"}},[s._v("#")]),s._v(" 集群")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看集群")]),s._v("\nceph -v\nceph status\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 升级集群")]),s._v("\nceph orch upgrade start --ceph-version "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16.2")]),s._v(".6   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 升级到指定版本")]),s._v("\nceph orch upgrade status                        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看升级任务的状态。执行 ceph status 还会显示升级的进度条")]),s._v("\nceph orch upgrade stop                          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 停止升级任务")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置集群")]),s._v("\nceph config dump                    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输出集群的配置参数，不包括默认的配置参数")]),s._v("\nceph config "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("                      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出所有可用的配置参数")]),s._v("\nceph config log "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("                 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看配置参数最近 n 次的变更记录")]),s._v("\nceph config get "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("who"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 读取配置参数，who 表示服务类型")]),s._v("\nceph config "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("who"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("value"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置配置参数")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("h3",{attrs:{id:"主机"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#主机"}},[s._v("#")]),s._v(" 主机")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("ceph orch "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("hostname"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("addr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("label"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加一个主机，指定名称和 IP 地址，还可以附加标签")]),s._v("\nceph orch "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("hostname"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nceph orch "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\nceph orch "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" set-addr  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("hostname"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("addr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 更新主机的地址")]),s._v("\nceph orch "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" label "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("hostname"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("label"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 给一个主机添加标签")]),s._v("\nceph orch "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" label "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("hostname"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("label"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h3",{attrs:{id:"服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#服务"}},[s._v("#")]),s._v(" 服务")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("ceph orch status                              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示编排器的状态，比如 cephadm")]),s._v("\nceph orch "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("service_type"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("service_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出集群中的服务")]),s._v("\n              --export                        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 导出 spec 配置")]),s._v("\nceph orch "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("hostname"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("service_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出主机上的服务进程实例")]),s._v("\nceph orch "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("service_name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("                   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除一个服务，这会终止其所有进程实例")]),s._v("\nceph orch apply -i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("xx.yml"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("                   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 导入服务的 spec 配置")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("ul",[t("li",[s._v("每种服务可能运行多个进程实例。\n"),t("ul",[t("li",[s._v("服务的名称采用小写的服务类型，例如 mon 。")]),s._v(" "),t("li",[s._v("服务进程以守护进程的形式运行，称为 daemon 。\n"),t("ul",[t("li",[s._v("daemon 的命名格式为 "),t("code",[s._v("<service_name>.<hostname>")]),s._v(" ，例如 mon.host1 。")]),s._v(" "),t("li",[s._v("daemon 的容器命名格式为 "),t("code",[s._v("ceph-<fsid>-<process_name>")]),s._v(" 。")])])]),s._v(" "),t("li",[s._v("没有直接重启服务的命令，管理不方便。")])])]),s._v(" "),t("li",[s._v("同种服务的 daemon 采用同一份配置（Specification，spec）。例如 mon 服务的配置如下："),t("div",{staticClass:"language-yml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("service_type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mon\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("service_name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mon\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("placement")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关于部署的配置")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("count")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定需要部署的实例数")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# count_per_host: 1   # 每个主机上部署的实例数")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# hosts:              # 或者指定用于部署的主机名")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - host-1")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# label: null         # 根据标签筛选用于部署的主机名")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# unmanaged: false      # 是否禁止 Orchestrator 管理该服务")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])])])]),s._v(" "),t("h3",{attrs:{id:"osd"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#osd"}},[s._v("#")]),s._v(" OSD")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("ceph osd "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("                                   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出所有 OSD")]),s._v("\nceph osd tree                                 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 以树形结构列出所有 OSD")]),s._v("\nceph orch device "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("hostname"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出主机上的存储设备")]),s._v("\n                    --wide                    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示详细信息")]),s._v("\nceph orch daemon "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" osd "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("hostname"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("device"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建 OSD 进程，管理指定的存储设备")]),s._v("\nceph orch apply osd --all-available-devices   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加 spec 配置：自动为所有可用的存储设备部署 OSD 进程")]),s._v("\n                    --unmanaged"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 禁止编排 OSD 进程，不允许自动部署、手动部署")]),s._v("\nceph orch osd "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("osd_id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".                  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 移除 OSD 进程，这会添加一个计划任务")]),s._v("\nceph orch osd "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" status                       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看移除任务的状态")]),s._v("\nceph orch osd "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" stop "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("osd_id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 停止移除任务")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph-volume 是一个更底层的命令")]),s._v("\nceph-volume lvm list                          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出所有已关联 OSD 的 logical volume")]),s._v("\nceph-volume lvm zap "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("device"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".               "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 擦除一个 device 的内容。这会通过 dd if=/dev/zero of=<device> 命令销毁其中的分区表")]),s._v("\n                    --destroy                 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 擦除一个 raw device 时，销毁其中的 volume group 和 logical volume")]),s._v("\nceph-volume lvm prepare --data "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("device"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 为一个 device 创建 OSD")]),s._v("\nceph-volume lvm activate\n                    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("osd_id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("uuid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动 OSD 进程，需要指定其编号和 uuid")]),s._v("\n                    --all                     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 自动发现所有 device 已关联的 OSD ，并启动")]),s._v("\nceph-volume lvm deactivate "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("osd_id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("uuid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 停止 OSD 进程")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("ul",[t("li",[s._v("ceph-volume 会自动发现主机上的存储设备，满足以下条件才视作可用，允许创建 OSD ：\n"),t("ul",[t("li",[s._v("大于 5 GB 。")]),s._v(" "),t("li",[s._v("没有挂载。")]),s._v(" "),t("li",[s._v("不包含文件系统。")]),s._v(" "),t("li",[s._v("没有磁盘分区（partition）。因此通常使用以下两种存储设备：\n"),t("ul",[t("li",[s._v("raw device ：原始存储设备，比如磁盘。")]),s._v(" "),t("li",[s._v("logical volume ：LVM 逻辑卷。")])])])])])]),s._v(" "),t("h3",{attrs:{id:"pool"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pool"}},[s._v("#")]),s._v(" Pool")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("ceph osd pool "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("                        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出所有 pool")]),s._v("\nceph osd pool create "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("pool"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建一个 pool ，指定名称")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("pg_num"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("pgp_num"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("replicated"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("erasure"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nceph osd pool "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("pool"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("pool"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" --yes-i-really-really-mean-it   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除一个 pool ，需要两次指定其名称")]),s._v("\nceph osd pool get "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("pool"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 读取配置参数")]),s._v("\nceph osd pool "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("pool"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("value"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("ul",[t("li",[s._v("pool 分为两种类型：\n"),t("ul",[t("li",[s._v("replicated ：复制池，默认采用。将 object 保存多份，从而实现数据备份。\n"),t("ul",[t("li",[s._v("假设全部 OSD 的磁盘容量为 100G ，存储的 pool size 为 3 ，则 pool 最多允许写入 33G 数据。")])])]),s._v(" "),t("li",[s._v("erasure ：纠错码池。通过占用大概 1.5 倍的存储空间来实现数据备份。\n"),t("ul",[t("li",[s._v("比复制池占用的存储空间更少，但是读取时占用更多 CPU 和内存来解码，读取延迟较大，适合冷备份。")])])])])]),s._v(" "),t("li",[s._v("pool 常见的配置参数："),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("size              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 该 pool 中每个 object 的副本数，即将所有数据保存 size 份。默认为 3")]),s._v("\nmin_size          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 读写 object 时需要的最小副本数。默认为 2")]),s._v("\npg_num            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 该 pool 包含的 pg 数，默认为 32 。应该根据 osd_count*100/pool_size 估算，并取最近的一个 2^n 幂值")]),s._v("\npgp_num           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用于 CRUSH 计算的 pg 数，取值应该等于 pg_num")]),s._v("\ncrush_rule        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 采用的 CRUSH 规则。默认为 replicated_rule")]),s._v("\nquota_max_bytes   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 存储容量。默认为 0 ，不限制")]),s._v("\nquota_max_objects "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 存储的 object 数。默认为 0 ，不限制")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])])]),s._v(" "),t("li",[s._v("mon 服务关于 pool 的配置参数："),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("mon_allow_pool_delete       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否允许删除 pool ，默认为 false")]),s._v("\nmon_allow_pool_size_one     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否允许 pool size 设置为 1 。默认为 false ，因此 size 至少要为 2")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pool 配置参数的默认值")]),s._v("\nosd_pool_default_size\nosd_pool_default_min_size\nosd_pool_default_pg_num\nosd_pool_default_pgp_num\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])])]),s._v(" "),t("li",[s._v("pool 中 pg 的常见状态："),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 正常状态")]),s._v("\nactive        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以读写")]),s._v("\nclean         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pg 不存在故障的 object")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 异常状态")]),s._v("\ndown          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pg 离线")]),s._v("\nundersized    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pg 实际运行的副本数少于 pool size")]),s._v("\ndegraded      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 降级了，pg 中存在一些 object ，其副本数少于 pool size")]),s._v("\nstale         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pg 的状态没有更新到 Monitor ，可能是存储该 pg 的所有 OSD 都故障了")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关于检查、恢复")]),s._v("\ndeep          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 根据 checksum 检查 pg 的数据是否一致")]),s._v("\npeer          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 存储该 pg 的所有 OSD 互相通信，将该 pg 的状态同步一致")]),s._v("\nrecovery      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 根据操作日志找出 pg 中与其它副本不一致的 object ，进行同步。常见于 OSD 重启时")]),s._v("\nbackfill      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检查并同步 pg 中的全部 object ，常见于新增 pg、OSD 时")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])])])]),s._v(" "),t("h3",{attrs:{id:"cephfs"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cephfs"}},[s._v("#")]),s._v(" CephFS")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("ceph fs "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("                                    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出已创建的 fs")]),s._v("\nceph fs status\nceph fs new "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("fs_name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("meta"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建一个 fs，指定其用于存储元数据、数据的 pool")]),s._v("\nceph fs "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("fs_name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" --yes-i-really-mean-it  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除一个 fs")]),s._v("\nceph fs add_data_pool "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("fs_name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("pool"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 给 CephFS 增加数据池")]),s._v("\nceph fs get "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("fs_name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("                         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 读取全部配置参数")]),s._v("\nceph fs "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("fs_name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("value"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改一个配置参数")]),s._v("\n\nceph mds "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("stat")]),s._v("                                 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示 mds 的状态")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("ul",[t("li",[s._v("Ceph 集群中可以创建多个 CephFS 文件系统实例，简称为 fs 。\n"),t("ul",[t("li",[s._v("每个 fs 需要使用至少两个 pool ，分别用于存储数据、元数据。")]),s._v(" "),t("li",[s._v("每个 fs 需要使用至少一个 MDS 服务器。")])])]),s._v(" "),t("li",[s._v("fs 常见的配置参数："),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("max_file_size   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 单个文件的最大体积，默认为 1024^4")]),s._v("\ndown            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否停止服务。通过设置该参数为 true 或 false ，可以停止或启动 fs")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])]),s._v(" "),t("li",[s._v("例：创建 fs"),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("ceph osd pool create cephfs1.data\nceph osd pool create cephfs1.meta\nceph fs new cephfs1 cephfs1.meta cephfs1.data\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])])]),s._v(" "),t("li",[s._v("Linux 内核已经内置了 ceph 模块，因此可以直接用 mount 命令挂载 CephFS 文件系统："),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mount")]),s._v(" -t ceph "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("mon_ip:port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("src_dir"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("dst_dir"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 访问 mon 服务器，将 CephFS 文件系统的 src_dir 挂载到当前主机的 dst_dir")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-o options"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可加上一些逗号分隔的选项，如下：")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("guest            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# CephX 用户")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("secret")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("xxx            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# CephX 密钥")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("secretfile")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("xxx        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# CephX 密钥文件")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("fs")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("cephfs1            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认挂载第一个 fs")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("ul",[t("li",[s._v("secretfile、fs 选项需要安装 ceph 软件包才能使用，其提供了功能更多的 mount.ceph 命令。")]),s._v(" "),t("li",[s._v("例："),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /mnt/cephfs\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mount")]),s._v(" -t ceph   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.1:/  /mnt/cephfs   -o "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("admin,secret"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("xxx\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'10.0.0.1:/  /mnt/cephfs    ceph    name=admin,secret=xxx    0   0'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/fstab\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("dmesg")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看挂载日志")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("umount")]),s._v(" /mnt/cephfs    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 卸载")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])])]),s._v(" "),t("li",[s._v("如果停止 fs ，则客户端访问已挂载的 fs 时会出错，比如无响应、umount 失败。")])])])]),s._v(" "),t("h3",{attrs:{id:"volume"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#volume"}},[s._v("#")]),s._v(" volume")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("ceph fs volume "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("                             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出已创建的 volume")]),s._v("\nceph fs volume create "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("volume"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建一个 volume")]),s._v("\nceph fs volume "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("volume"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" --yes-i-really-mean-it\n\nceph fs subvolume "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\nceph fs subvolume create "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("vol_name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("sub_name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("group_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nceph fs subvolume "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("vol_name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("sub_name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("group_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\nceph fs subvolumegroup "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\nceph fs subvolumegroup create "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("vol_name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("group_name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nceph fs subvolumegroup "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("vol_name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("group_name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("ul",[t("li",[s._v("CephFS volume 是对一种快速创建 fs 的方式。\n"),t("ul",[t("li",[s._v("创建一个 volume 时，会自动创建：\n"),t("ul",[t("li",[s._v("一个同名的 fs 。")]),s._v(" "),t("li",[s._v("两个 pool ，命名格式为 "),t("code",[s._v("cephfs.<volume>.data")]),s._v(" 和 "),t("code",[s._v("cephfs.<volume>.meta")]),s._v(" 。")]),s._v(" "),t("li",[s._v("两个 MDS 服务器。")])])]),s._v(" "),t("li",[s._v("删除一个 volume 时，会自动删除关联的 fs、pool 和 MDS 。")]),s._v(" "),t("li",[s._v("每个 volume 中可以创建多个子卷（subvolume）或子卷组（subvolume group），相当于文件夹。")])])]),s._v(" "),t("li",[s._v("例：查看 mds.volume1 的配置"),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ceph: root@CentOS /"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph orch ls mds mds.volume1 --export")]),s._v("\nservice_type: mds\nservice_id: volume1\nservice_name: mds.volume1\nplacement:\n  count: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])])])]),s._v(" "),t("h3",{attrs:{id:"cephx"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cephx"}},[s._v("#")]),s._v(" CephX")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("ceph auth "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出已创建的凭证")]),s._v("\nceph auth get "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 读取指定的凭证")]),s._v("\nceph auth "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("ul",[t("li",[s._v("Ceph 集群采用 CephX 协议进行身份认证。")]),s._v(" "),t("li",[s._v("凭证示例："),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("client.admin                                            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用户名")]),s._v("\n        key: AQD9O45hiBQrDBAAsMYpN0ddCF/apJpYIoLokg"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 密钥，采用 base64 编码")]),s._v("\n        caps: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" allow *                             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 权限")]),s._v("\n        caps: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mgr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" allow *\n        caps: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mon"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" allow *\n        caps: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("osd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" allow *\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])])])])])}),[],!1,null,null,null);a.default=n.exports}}]);