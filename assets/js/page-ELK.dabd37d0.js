(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{628:function(a,v,_){"use strict";_.r(v);var t=_(1),l=Object(t.a)({},(function(){var a=this,v=a.$createElement,_=a._self._c||v;return _("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[_("h1",{attrs:{id:"elk"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#elk"}},[a._v("#")]),a._v(" ELK")]),a._v(" "),_("p",[a._v("：一个对大量数据（通常是日志）进行采集、存储、展示的系统，又称为 ELK Stack 或 Elastic Stack ，由 Elastic 公司发布。")]),a._v(" "),_("ul",[_("li",[_("a",{attrs:{href:"https://www.elastic.co/guide/index.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("官方文档"),_("OutboundLink")],1)]),a._v(" "),_("li",[_("a",{attrs:{href:"https://www.elastic.co/cn/downloads/",target:"_blank",rel:"noopener noreferrer"}},[a._v("下载页面"),_("OutboundLink")],1)])]),a._v(" "),_("h2",{attrs:{id:"原理"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#原理"}},[a._v("#")]),a._v(" 原理")]),a._v(" "),_("h3",{attrs:{id:"组件"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#组件"}},[a._v("#")]),a._v(" 组件")]),a._v(" "),_("p",[a._v("ELk 系统主要由以下软件组成：")]),a._v(" "),_("ul",[_("li",[a._v("ElasticSearch\n"),_("ul",[_("li",[a._v("用于存储数据，并支持查询。")])])]),a._v(" "),_("li",[a._v("Logstash\n"),_("ul",[_("li",[a._v("用于收集日志数据，解析成格式化数据之后，发送到 ES 中存储。")])])]),a._v(" "),_("li",[a._v("Kibana\n"),_("ul",[_("li",[a._v("一个基于 node.js 运行的 Web 服务器，用于查询、展示 ES 中存储的数据。")])])])]),a._v(" "),_("p",[a._v("ELK 系统还可以选择加入以下软件：")]),a._v(" "),_("ul",[_("li",[a._v("Beats\n"),_("ul",[_("li",[a._v("采用 Golang 开发，用于采集日志数据。比 Logstash 更轻量级，但功能较少。")]),a._v(" "),_("li",[a._v("Beats 程序有多种类型：\n"),_("ul",[_("li",[a._v("Filebeat ：用于采集日志文件。")]),a._v(" "),_("li",[a._v("Packetbeat ：用于采集网络数据包的日志。")]),a._v(" "),_("li",[a._v("Winlogbeat ：用于采集 Windows 的 event 日志。")]),a._v(" "),_("li",[a._v("Metricbeat ：用于采集系统或软件的性能指标。")]),a._v(" "),_("li",[a._v("Auditbeat ：用于采集 Linux Audit 进程的日志。")])])]),a._v(" "),_("li",[a._v("用户也可以基于 Beats 框架开发自定义的 Beats 程序。")])])]),a._v(" "),_("li",[a._v("Elastic Agent\n"),_("ul",[_("li",[a._v("v7.8 版本新增的软件，用于采集日志数据。它集成了不同类型的 Beats 的功能。")])])]),a._v(" "),_("li",[a._v("Observability\n"),_("ul",[_("li",[a._v("为 Kibana 扩展了一些日志可视化的功能，比如实时查看日志、设置告警规则。")])])]),a._v(" "),_("li",[a._v("Security\n"),_("ul",[_("li",[a._v("用于监控一些安全事项。")])])]),a._v(" "),_("li",[a._v("APM（Application Performance Monitoring）\n"),_("ul",[_("li",[a._v("用于采集、监控应用程序的性能指标。")])])]),a._v(" "),_("li",[a._v("Enterprise Search\n"),_("ul",[_("li",[a._v("提供搜索功能，可以集成到业务网站的搜索栏中。")])])])]),a._v(" "),_("p",[a._v("总结：")]),a._v(" "),_("ul",[_("li",[a._v("上述软件都是由 Elastic 公司开发。")]),a._v(" "),_("li",[a._v("这些软件运行时可能需要 JDK、node.js 等环境，不过从 v7.0 版本开始，二进制发行版都已经自带了。")]),a._v(" "),_("li",[a._v("部署时，ELk 系统中各个软件的版本应该尽量一致，否则可能不兼容。")])]),a._v(" "),_("h3",{attrs:{id:"工作流程"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#工作流程"}},[a._v("#")]),a._v(" 工作流程")]),a._v(" "),_("ul",[_("li",[_("p",[a._v("ELK 的主要工作流程：")]),a._v(" "),_("ol",[_("li",[a._v("在每个主机上部署 Beats 进程，自动采集日志，然后发送到 Logstash 。")]),a._v(" "),_("li",[a._v("Logstash 将日志解析成 JSON 格式，然后发送到 ES 中存储。")]),a._v(" "),_("li",[a._v("用户使用 Kibana ，从 ES 中查询日志数据并展示。")])])]),a._v(" "),_("li",[_("p",[a._v("考虑到整个工作流程的耗时，用户查看最新日志时存在大概 2s 的延迟。而且 Kibana 本身刷新网页需要几秒耗时。")])]),a._v(" "),_("li",[_("p",[a._v("关于 Logstash 与 Beats ：")]),a._v(" "),_("ul",[_("li",[a._v("早期，是用 Logstash 采集日志然后发送到 ES 中存储。")]),a._v(" "),_("li",[a._v("后来，由于 Logstash 消耗内存较多，采集日志的效率较低，因此开发了轻量级的 Beats 程序来取代 Logstash 。\n"),_("ul",[_("li",[a._v("Beats 不擅长解析日志文本。因此通常不会让 Beats 直接将原始日志发送到 ES ，而是先发送到 Logstash 进行解析，再由 Logstash 发送到 ES 。")]),a._v(" "),_("li",[a._v("如果日志的并发量太大，可以让 Beats 将采集的日志先发送到 Kafka 缓冲，然后让 Logstash 从 Kafka 获取数据。")])])])])])]),a._v(" "),_("h2",{attrs:{id:"相关概念"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#相关概念"}},[a._v("#")]),a._v(" 相关概念")]),a._v(" "),_("ul",[_("li",[_("p",[a._v("Flume")]),a._v(" "),_("ul",[_("li",[a._v("：一个命令行工具，用于日志采集。类似于 Logstash ，但功能较少。")]),a._v(" "),_("li",[a._v("由 Cloudera 公司采用 Java 开发，2012 年成为 ASF 的顶级项目。")]),a._v(" "),_("li",[a._v("通过 tail -f 的方式采集日志文件的内容，因此重启采集进程之后会重复采集。")])])]),a._v(" "),_("li",[_("p",[a._v("Fluentd")]),a._v(" "),_("ul",[_("li",[a._v("：一个命令行工具，用于日志采集。类似于 Logstash ，也有丰富的插件。")]),a._v(" "),_("li",[a._v("2011 年首次发布，由 Treasure Data 公司采用 Ruby 开发。")]),a._v(" "),_("li",[a._v("采集的数据解析为 JSON 对象，可以输出到 ES、MongoDB、Kafka 等。")]),a._v(" "),_("li",[a._v("可以替换 ELK 系统中的 Logstash ，组成 EFK 。")])])]),a._v(" "),_("li",[_("p",[a._v("Loki")]),a._v(" "),_("ul",[_("li",[a._v("：一个包括日志采集、存储、展示的系统，由 Grafana Labs 公司发布。包括以下组件：\n"),_("ul",[_("li",[a._v("Promtail ：用于采集日志文件。")]),a._v(" "),_("li",[a._v("Loki ：用于存储日志数据。")]),a._v(" "),_("li",[a._v("Grafana ：用于展示日志数据。")])])]),a._v(" "),_("li",[a._v("借鉴了 Prometheus 的工作方式，给日志数据添加一些键值对格式的标签，从而筛选日志。比 ELK 的查询、显示速度快很多，但不支持全文查询。")])])])])])}),[],!1,null,null,null);v.default=l.exports}}]);