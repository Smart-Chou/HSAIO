(window.webpackJsonp=window.webpackJsonp||[]).push([[124],{693:function(s,a,t){"use strict";t.r(a);var n=t(1),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"nacos"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nacos"}},[s._v("#")]),s._v(" Nacos")]),s._v(" "),t("p",[s._v("：一个 Web 服务器，提供了配置管理、服务发现的功能。")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://nacos.io/zh-cn/docs/quick-start.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方文档"),t("OutboundLink")],1)]),s._v(" "),t("li",[s._v("发音为 "),t("code",[s._v("/nɑ:kəʊs/")]),s._v(" 。")]),s._v(" "),t("li",[s._v("由阿里巴巴公司开源，采用 Java 开发。")])]),s._v(" "),t("h2",{attrs:{id:"部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#部署"}},[s._v("#")]),s._v(" 部署")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("下载二进制包，解压后以单机模式启动：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" startup.sh -m standalone\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("访问 "),t("code",[s._v("http://127.0.0.1:8848/nacos/")]),s._v(" 即可登录 Nacos 的 Web 页面，默认账号、密码为 nacos、nacos 。")])])]),s._v(" "),t("li",[t("p",[s._v("或者用 Docker 部署：")]),s._v(" "),t("div",{staticClass:"language-yml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nacos")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nacos\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nacos/nacos"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("v2.0.4\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" unless"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("stopped\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("MODE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" standalone\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# JVM_XMS: 1g")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# JVM_XMX: 1g")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 8848"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8848")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("ul",[t("li",[s._v("Nacos 默认将数据存储在自己目录中，可配置以下环境变量，将数据存储到 MySQL 中："),t("div",{staticClass:"language-yml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("SPRING_DATASOURCE_PLATFORM")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("MYSQL_SERVICE_HOST")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 10.0.0.1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("MYSQL_SERVICE_PORT")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("MYSQL_SERVICE_USER")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nacos\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("MYSQL_SERVICE_PASSWORD")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token important"}},[s._v("******")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("MYSQL_SERVICE_DB_NAME")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nacos\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("MYSQL_SERVICE_DB_PARAM")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" characterEncoding=utf8"),t("span",{pre:!0,attrs:{class:"token important"}},[s._v("&connectTimeout=1000&socketTimeout=3000&autoReconnect=true&useSSL=false")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),s._v("需要执行数据库的初始化脚本 "),t("a",{attrs:{href:"https://github.com/alibaba/nacos/blob/master/distribution/conf/nacos-mysql.sql",target:"_blank",rel:"noopener noreferrer"}},[s._v("nacos-mysql.sql"),t("OutboundLink")],1)])])])]),s._v(" "),t("h2",{attrs:{id:"用法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#用法"}},[s._v("#")]),s._v(" 用法")]),s._v(" "),t("h3",{attrs:{id:"配置管理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置管理"}},[s._v("#")]),s._v(" 配置管理")]),s._v(" "),t("ul",[t("li",[s._v("Configuration Set ：配置集，即一个配置文件，包含一些配置参数。")]),s._v(" "),t("li",[s._v("DataID ：每个配置集的 ID ，命名格式为 "),t("code",[s._v("${prefix}-${spring.profile.active}.${file-extension}")]),s._v(" 。")]),s._v(" "),t("li",[s._v("Namespace ：Nacos 支持创建多个命名空间，比如 default、test、prod ，用于隔离 service、DataID、Group 等资源。")]),s._v(" "),t("li",[s._v("Group ：每个 Namespace 中可以创建多个分组，用于隔离配置集。")])]),s._v(" "),t("h3",{attrs:{id:"服务发现"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#服务发现"}},[s._v("#")]),s._v(" 服务发现")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("Nacos 将注册的服务分为两类，采用不同的健康检查方式：")]),s._v(" "),t("ul",[t("li",[s._v("临时实例\n"),t("ul",[t("li",[s._v("：不健康一段时间之后会被自动注销。")]),s._v(" "),t("li",[s._v("临时实例会定期向 Nacos 发送一个 HTTP 请求，进行心跳检查。如果该实例尚未注册，则自动注册。")])])]),s._v(" "),t("li",[s._v("持久实例\n"),t("ul",[t("li",[s._v("：不健康时不会注销，只是不加入负载均衡。")]),s._v(" "),t("li",[s._v("Nacos 定期（默认间隔为 20 秒）向持久实例发送一个 TCP 或 HTTP 请求，如果响应失败则将它标记为不健康。")])])])])]),s._v(" "),t("li",[t("p",[s._v("Spring Boot 服务使用 Nacos 的配置示例：")]),s._v(" "),t("div",{staticClass:"language-yml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spring")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("application")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" demo\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("profiles")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("active")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" test\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cloud")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nacos")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("config")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("                                     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关于配置管理功能")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server-addr")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 10.0.0.1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8848")]),s._v("                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Nacos 服务器的地址")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# namespace: public                       # 该服务所属的命名空间")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# group: DEFAULT_GROUP                    # 该服务所属的 group")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# prefix: ${spring.application.name}      # 根据 prefix 等参数确定 DataID ，找到对应的配置集，给该服务采用")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# file-extension: properties              # 配置文件的扩展名，比如 yaml")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# refresh:")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   enabled: true                         # 是否自动从 Nacos 获取最新的配置，这样不必重启服务")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("discovery")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("                                  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关于服务发现功能")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server-addr")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 10.0.0.1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8848")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# namespace: public")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# group: DEFAULT_GROUP")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# service: ${spring.application.name}     # 注册的服务名")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# spring.cloud.nacos.discovery.ip: xxx    # 注册的 IP ，供其它服务调用。默认采用第一个网卡的 IP")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# spring.cloud.nacos.discovery.port: ${server.port}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ephemeral: true                         # 是否为临时实例")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# weight: 1                               # 该服务实例在负载均衡时的权重，取值范围为 1~100")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# metadata:                               # 添加一些该服务实例的元数据")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   preserved.heart.beat.interval: 5000   # 发送心跳的间隔时长，单位为 ms")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   preserved.heart.beat.timeout: 15000   # 如果该时长内无心跳，则 Nacos 将该服务实例标记为不健康")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   preserved.ip.delete.timeout: 30000    # 如果该时长内无心跳，则 Nacos 将该服务实例注销")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("健康保护阈值：一个浮点数，取值范围为 0~1 。当一个服务的健康实例数占总数的比值小于阈值时，Nacos 会将不健康的实例加入负载均衡。这样会损失部分流量，但避免剩下的健康实例负载过大、服务雪崩。")])])]),s._v(" "),t("h3",{attrs:{id:"http-api"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#http-api"}},[s._v("#")]),s._v(" HTTP API")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发布配置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -X POST "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://127.0.0.1:8848/nacos/v1/cs/configs?dataId=d1&group=test&content=HelloWorld"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取配置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -X GET "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://127.0.0.1:8848/nacos/v1/cs/configs?dataId=d1&group=test"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注册服务")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -X POST "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://127.0.0.1:8848/nacos/v1/ns/instance?serviceName=nginx&ip=10.0.0.1&port=80'")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发现服务")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -X GET "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://127.0.0.1:8848/nacos/v1/ns/instance/list?serviceName=nginx'")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);