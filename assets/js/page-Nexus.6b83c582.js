(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{557:function(s,a,t){s.exports=t.p+"assets/img/Nexus.146dbfa6.png"},645:function(s,a,t){"use strict";t.r(a);var e=t(1),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"nexus"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#nexus"}},[s._v("#")]),s._v(" Nexus")]),s._v(" "),e("p",[s._v("：NXRM（Nexus Repository Manager），一个 Web 服务器，提供了多种格式的工件仓库。")]),s._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://help.sonatype.com/repomanager3",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方文档"),e("OutboundLink")],1)]),s._v(" "),e("li",[s._v("采用 Java 开发，由 Sonatype 公司开源。\n"),e("ul",[e("li",[s._v("分为社区版（OSS）、专业版（PRO）。")])])])]),s._v(" "),e("h2",{attrs:{id:"部署"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#部署"}},[s._v("#")]),s._v(" 部署")]),s._v(" "),e("ul",[e("li",[s._v("用 docker-compose 部署："),e("div",{staticClass:"language-yml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3'")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nexus")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nexus\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sonatype/nexus3"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("3.37.3\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" unless"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("stopped\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("INSTALL4J_ADD_VM_PARAMS")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("Xms2703m "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("Xmx2703m "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("XX"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("MaxDirectMemorySize=2703m "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("Djava.util.prefs.userRoot=/nexus"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("data/javaprefs\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 8081"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8081")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ./data"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/nexus"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("data\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br")])]),e("ul",[e("li",[s._v("需要调整挂载目录的权限："),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])])]),s._v(" "),e("li",[s._v("默认用户名为 admin ，初始密码记录在 admin.password 文件中。")])])])]),s._v(" "),e("h2",{attrs:{id:"用法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#用法"}},[s._v("#")]),s._v(" 用法")]),s._v(" "),e("h3",{attrs:{id:"web-ui"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#web-ui"}},[s._v("#")]),s._v(" Web UI")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("Nexus 的 Web 页面分为两大区域：")]),s._v(" "),e("ul",[e("li",[s._v("Browse ：浏览页面，可以对工件进行浏览（呈树形图）、搜索、上传、删除。")]),s._v(" "),e("li",[s._v("Administration ：后台管理。")])])]),s._v(" "),e("li",[e("p",[s._v("浏览仓库列表：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(557),alt:"",loading:"lazy"}})])])]),s._v(" "),e("h3",{attrs:{id:"后台管理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#后台管理"}},[s._v("#")]),s._v(" 后台管理")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("在 Repositories 页面可以管理仓库。")])]),s._v(" "),e("li",[e("p",[s._v("在 Cleanup Policy 页面可以创建自动清理策略。")]),s._v(" "),e("ul",[e("li",[s._v("比如 Last Downloaded Before 策略是删除最后下载日期在 n 天以前的工件，但忽略从未下载的工件。")]),s._v(" "),e("li",[s._v("创建策略之后，需要在某个仓库的配置页面采用。")])])]),s._v(" "),e("li",[e("p",[s._v("在 Capabilities 页面可以启用一些次要功能。")])]),s._v(" "),e("li",[e("p",[s._v("在 Task 页面可以创建多种类型的定时任务，例如：")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("Admin - Cleanup repositories using their associated policies   "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 根据 Cleanup Policy 清理各个仓库。默认添加了该任务，每天执行一次")]),s._v("\nAdmin - Compact blob store        "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 压缩 Blob ，这会释放 deleted 文件的存储空间。建议添加该任务")]),s._v("\nMaven - Delete SNAPSHOT           "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 同一快照至少保留 m 个，并根据包名中的时间戳，删除早于 n 天的快照")]),s._v("\nMaven - Delete unused SNAPSHOT    "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除超过 n 天未使用（包括上传、下载）的快照")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])])])]),s._v(" "),e("h3",{attrs:{id:"仓库"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#仓库"}},[s._v("#")]),s._v(" 仓库")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("根据存储的工件（Component）格式对仓库（Repository）分类：")]),s._v(" "),e("ul",[e("li",[s._v("关于软件包：\n"),e("ul",[e("li",[s._v("apt")]),s._v(" "),e("li",[s._v("conda")]),s._v(" "),e("li",[s._v("yum")])])]),s._v(" "),e("li",[s._v("关于代码包：\n"),e("ul",[e("li",[s._v("go")]),s._v(" "),e("li",[s._v("maven")]),s._v(" "),e("li",[s._v("npm")]),s._v(" "),e("li",[s._v("nuget")]),s._v(" "),e("li",[s._v("pypi")]),s._v(" "),e("li",[s._v("r")]),s._v(" "),e("li",[s._v("rubygems")])])]),s._v(" "),e("li",[s._v("关于 Docker 镜像：\n"),e("ul",[e("li",[s._v("docker ：在 Docker 仓库的场景，Nexus 比 Harbor 少了很多功能。")]),s._v(" "),e("li",[s._v("helm")])])]),s._v(" "),e("li",[s._v("关于文件：\n"),e("ul",[e("li",[s._v("gitlfs")]),s._v(" "),e("li",[s._v("raw ：将工件以二进制形式存储。")])])])])]),s._v(" "),e("li",[e("p",[s._v("仓库有多种存储类型：")]),s._v(" "),e("ul",[e("li",[s._v("hosted ：普通仓库。")]),s._v(" "),e("li",[s._v("proxy ：对远程仓库的代理和缓存。当用户请求下载一个工件时，先尝试从本地缓存获取。如果不存在，则从远程仓库获取并缓存。")]),s._v(" "),e("li",[s._v("group ：组，可以包含多个任意类型的仓库，在逻辑上合并它们的工件。\n"),e("ul",[e("li",[s._v("默认创建了 hosted 类型的 maven-releases、maven-snapshots 仓库，proxy 类型的 maven-central 仓库，三者都包含于 group 类型的 maven-public 仓库。")]),s._v(" "),e("li",[s._v("从 maven-public 仓库下载工件时，会自动到 3 个成员仓库中寻找。但上传工件时，必须区分 maven-releases 和 maven-snapshots 仓库。")])])])])]),s._v(" "),e("li",[e("p",[s._v("在 Nexus 底层，仓库需要存储在 Blob 中。")]),s._v(" "),e("ul",[e("li",[s._v("Blob 是在本机或云端创建的存储空间。\n"),e("ul",[e("li",[s._v("默认创建了一个名为 default 的 Blob ，存储所有仓库。")])])]),s._v(" "),e("li",[s._v("Blob 采用软删除（soft deleted）。\n"),e("ul",[e("li",[s._v("删除一个工件时，只是标记为 deleted 状态，但并不会立即释放存储空间。")])])]),s._v(" "),e("li",[s._v("Blob 分为多种类型：\n"),e("ul",[e("li",[s._v("File ：存储在本机的文件系统中。")]),s._v(" "),e("li",[s._v("AWS S3")])])])])])]),s._v(" "),e("h3",{attrs:{id:"访问控制"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#访问控制"}},[s._v("#")]),s._v(" 访问控制")]),s._v(" "),e("ul",[e("li",[s._v("采用基于角色的访问控制。\n"),e("ul",[e("li",[s._v("默认禁止匿名用户访问。")]),s._v(" "),e("li",[s._v("每个用户（User）可以分配多个角色（Role），每个角色可以分配多种权限（Privilege）。")])])]),s._v(" "),e("li",[s._v("权限示例："),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("nx-userschangepw      "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改密码")]),s._v("\nnx-search-read        "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许搜索")]),s._v("\nnx-component-upload   "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许上传")]),s._v("\n\nnx-repository-view-*-*-*            "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 对 nexus 仓库的访问权限：允许对 * 类型的、名为 * 的仓库，进行 * 操作")]),s._v("\nnx-repository-view-maven2-*-browse  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许对 maven2 类型的、名为 * 的仓库，进行 browse 操作")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("ul",[e("li",[s._v("对仓库的操作分为："),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("browse    "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通过 Web UI 浏览")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通过 HTTP 请求读取工件")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v("       "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通过 HTTP 请求添加工件")]),s._v("\nedit\ndelete\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])])]),s._v(" "),e("li",[s._v("对于 npm 类型的仓库，需要启用 "),e("code",[s._v("npm Bearer Token Realm")]),s._v(" ，提供身份认证的 token 。")])])])]),s._v(" "),e("h3",{attrs:{id:"restful-api"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#restful-api"}},[s._v("#")]),s._v(" Restful API")]),s._v(" "),e("ul",[e("li",[s._v("关于工件的 API ："),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("GET     /service/rest/repository/browse/"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$repository")]),s._v("/        "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 以 HTML 基本视图显示文件列表")]),s._v("\n\nGET     /service/rest/v1/components?repository"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$repository")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出某个仓库的工件信息，默认只显示第一页")]),s._v("\nPOST    /service/rest/v1/components?repository"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$repository")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 上传工件到指定仓库。上传成功时的响应为空")]),s._v("\nGET     /service/rest/v1/components/"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$component_id")]),s._v("           "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取指定工件的信息，需要指定工件在所有仓库中的唯一 ID")]),s._v("\nDELETE  /service/rest/v1/components/"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$component_id")]),s._v("           "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除工件")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])])]),s._v(" "),e("li",[s._v("例：上传一个二进制文件"),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -X POST "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://localhost:8081/service/rest/v1/components?repository=test'")]),s._v("\n      -u admin:******\n      -F raw.assetN"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("@f1         "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 要上传的文件")]),s._v("\n      -F raw.assetN.filename"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("f1 "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 上传之后的文件名")]),s._v("\n      -F raw.directory"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/        "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 上传之后的保存目录")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])])])])])}),[],!1,null,null,null);a.default=n.exports}}]);