(window.webpackJsonp=window.webpackJsonp||[]).push([[131],{879:function(s,a,t){"use strict";t.r(a);var n=t(1),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"openldap"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#openldap"}},[s._v("#")]),s._v(" OpenLDAP")]),s._v(" "),t("p",[s._v("：一个开源的 LDAP 服务器。")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://www.openldap.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("官网"),t("OutboundLink")],1)]),s._v(" "),t("li",[s._v("它会运行一个 slapd 进程，作为 LDAP 服务器。")]),s._v(" "),t("li",[s._v("同类产品：\n"),t("ul",[t("li",[s._v("Active Directory ：简称为 AD ，同时支持 LDAP 和 Kerberos 协议。")]),s._v(" "),t("li",[s._v("Apache Directory Server")])])])]),s._v(" "),t("h2",{attrs:{id:"部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#部署"}},[s._v("#")]),s._v(" 部署")]),s._v(" "),t("ul",[t("li",[s._v("用 docker-compose 运行，配置如下："),t("div",{staticClass:"language-yml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("openldap")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" osixia/openldap"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("1.4.0\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hostname")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" openldap\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 389"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("389")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 636"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("636")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ./data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/var/lib/ldap        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 挂载存储目录")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ./conf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/etc/ldap/slapd.d    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 挂载配置目录")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("ul",[t("li",[s._v("该 Docker 镜像的 "),t("a",{attrs:{href:"https://github.com/osixia/docker-openldap",target:"_blank",rel:"noopener noreferrer"}},[s._v("GitHub"),t("OutboundLink")],1)]),s._v(" "),t("li",[s._v("默认监听两个端口：\n"),t("ul",[t("li",[s._v("389 ：用于非加密通信。")]),s._v(" "),t("li",[s._v("636 ：用于 SSL/TLS 加密通信。")])])]),s._v(" "),t("li",[s._v("默认创建了一个 {1}mdb 数据库，在容器内执行以下命令尝试查询："),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("ldapsearch -H ldapi:/// -Y EXTERNAL -b "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("cn")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("config\nldapsearch -H ldapi:/// -Y EXTERNAL -b "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("olcDatabase")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("mdb,cn"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("config\nldapsearch -x -D "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("cn")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("admin,dc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("example,dc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("org -w admin -b "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dc")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("example,dc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("org\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])])]),s._v(" "),t("li",[s._v("接下来可以在 Ldap Admin 中开始操作。")])])])]),s._v(" "),t("h2",{attrs:{id:"原理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#原理"}},[s._v("#")]),s._v(" 原理")]),s._v(" "),t("ul",[t("li",[s._v("OpenLDAP 支持创建多种数据库，常见的后端类型如下："),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("config    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用于存储 Slapd 的配置")]),s._v("\nbdb       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将数据存储到 Berkeley DB 文件数据库，已弃用")]),s._v("\nhdb       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 另一种 bdb ，已弃用")]),s._v("\nldap      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将数据存储到另一个 LDAP 服务器")]),s._v("\nldif      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将数据存储以 LDIF 格式存储在文件中")]),s._v("\nmdb       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将数据存储到 LMDB 数据库中")]),s._v("\nmeta      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 元数据目录")]),s._v("\nmonitor   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用于监控 slapd ，只能创建一个数据库实例")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("passwd")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用于以只读权限访问 /etc/passwd 文件")]),s._v("\nshell     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 基于 Shell")]),s._v("\nsql       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 基于 SQL")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("ul",[t("li",[s._v("一般的数据库推荐采用 mdb 。")])])])]),s._v(" "),t("h2",{attrs:{id:"命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#命令"}},[s._v("#")]),s._v(" 命令")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("语法：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("ldapadd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("ldapmodify"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("ldapdelete"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("ldapsearch\n        -H ldap://localhost:389     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 采用 ldap 协议，指定服务器的 URI")]),s._v("\n        -H ldaps://localhost:636    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 采用 ldaps 协议，进行加密通信")]),s._v("\n        -H ldapi:///var/run/ldapi   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 采用 ldapi 协议，通过 Unix Socket 连接")]),s._v("\n        -b "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("dn"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("                     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定服务器上的一个 dn 作为查询的起点")]),s._v("\n        -f "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("file"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("                   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 读取并执行 .ldif 文件的内容")]),s._v("\n\n        -X dn:"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("dn"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("                  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 采用 SASL 认证模式（默认采用），需要先指定用户 dn ，接着按提示输入密码")]),s._v("\n        -Y "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("mechanism"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定 SASL 机制")]),s._v("\n        -x                          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 采用简单认证模式")]),s._v("\n        -D "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("dn"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("                     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定用户名")]),s._v("\n        -w "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("password"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("               "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输入明文密码（用于简单认证模式）")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("例：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("ldapsearch -H ldapi:/// -Y EXTERNAL -b "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dc")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("example,dc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("org                    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 采用 SASL 认证模式，通过 Unix Socket 连接（这样可以免密登录）")]),s._v("\nldapsearch -x -b "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dc")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("example,dc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("org                                          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 采用简单认证模式，但并指定用户，即作为匿名用户")]),s._v("\nldapsearch -x -D "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("cn")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("admin,dc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("example,dc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("org -w admin -b "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dc")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("example,dc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("org   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 采用简单认证模式，并指定用户")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])])])]),s._v(" "),t("h2",{attrs:{id:"配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[s._v("#")]),s._v(" 配置")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("OpenLDAP 提供了一个在线配置系统，称为 OLC 。")]),s._v(" "),t("ul",[t("li",[s._v("OLC 系统使用一个 Root DN 为 "),t("code",[s._v("cn=config")]),s._v(" 的 DIT 来存储配置信息，从而支持在线修改配置，且不用重启就能生效。")]),s._v(" "),t("li",[s._v("OLC 系统的配置属性的名称都以 "),t("code",[s._v("olc")]),s._v(" 开头。")])])]),s._v(" "),t("li",[t("p",[s._v("OLC 系统中的每个条目会在磁盘的配置文件目录下保存为一个 .ldif 文件，如下：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("/etc/ldap/slapd.d/\n├── "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("cn")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("config.ldif                  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 存储 `dn: cn=config` 条目，该条目的子节点则存储在 cn=config/ 目录下")]),s._v("\n└── "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("cn")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("config/\n    ├── "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("cn")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("module"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(".ldif           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 存储 `dn: cn=module{0}` 条目，它用于加载模块")]),s._v("\n    ├── "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("cn")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("schema.ldif\n    ├── "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("cn")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("schema/\n    │   ├── "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("cn")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("core.ldif\n    │   ├── "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("cn")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("cosine.ldif\n    │   └── "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("cn")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("nis.ldif\n    ├── "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("olcDatabase")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("config.ldif\n    ├── "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("olcDatabase")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("-1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("frontend.ldif\n    ├── "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("olcDatabase")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("mdb.ldif\n    └── "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("olcDatabase")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("mdb/\n        ├── "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("olcOverlay")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("memberof.ldif\n        └── "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("olcOverlay")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("refint.ldif\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("ul",[t("li",[s._v("用户不应该直接修改这些 .ldif 文件，而应该通过 ldapadd、ldapmodify 等命令进行在线配置。")])])]),s._v(" "),t("li",[t("p",[t("code",[s._v("olcDatabase={0}config.ldif")]),s._v(" 的内容示例如下：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("dn: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("olcDatabase")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("config\nobjectClass: olcDatabaseConfig\nolcDatabase: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("config\nolcAccess: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("to * by dn.exact"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("gidNumber"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("+uidNumber"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",cn"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("peercred,cn"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("external,cn"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("auth manage\n                   by * "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("break")]),s._v("\nolcRootDN: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("cn")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("admin,cn"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("config\nolcRootPW: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("e1NTSEF9MGJYN2xxMDZZOEQxVmZwVTFyZUs3RFZrMng4TDFPYWk")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\nstructuralObjectClass: olcDatabase\nConfigentryUUID: 72c4b61a-be77-103a-9ff0-9ddaa4d2c622\ncreatorsName: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("cn")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("config\ncreateTimestamp: 20201119055436Z\nentryCSN: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20201119072303")]),s._v(".463947Z"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#000000#000#000000")]),s._v("\nmodifiersName: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("gidNumber")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("+uidNumber"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",cn"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("peercred,cn"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("external,cn"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("auth    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这一个长 dn 是默认用户")]),s._v("\nmodifyTimestamp: 20201119072303Z\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("ul",[t("li",[t("code",[s._v("olcDatabase ：[{<index>}] <type>")]),s._v(" "),t("ul",[t("li",[s._v("用于创建一个数据库实例。")]),s._v(" "),t("li",[s._v("index ：该数据库实例在同类数据库中的索引。不指定时会根据创建顺序自动生成。")]),s._v(" "),t("li",[s._v("type ：该数据库的后端类型。")])])]),s._v(" "),t("li",[t("code",[s._v("olcSuffix: <dn suffix>")]),s._v(" "),t("ul",[t("li",[s._v("指定一个 dn 后缀。所有包含该 dn 后缀的查询请求会被转发到该数据库，通常与该数据库的 Root DN 相同。")]),s._v(" "),t("li",[s._v("查询目标指向 olcDatabase 的 dn 时，会返回该该数据库的配置信息。而查询目标指向 olcSuffix 时，会返回该数据库中存储的条目。")])])]),s._v(" "),t("li",[t("code",[s._v("olcRootDN ：<dn>")]),s._v(" "),t("ul",[t("li",[s._v("创建一个对该数据库有完全权限的 root 用户（这会保存为指定 dn 的条目）。")]),s._v(" "),t("li",[s._v("dn ：root 用户的名称，不一定指向实际存在的条目。可以引用 SASL 用户。")])])]),s._v(" "),t("li",[t("code",[s._v("olcRootPW ：<password>")]),s._v(" "),t("ul",[t("li",[s._v("为 root 用户指定密码。可以指定多个密码。")]),s._v(" "),t("li",[s._v("password ：可以是明文密码，也可以是密码的哈希值。")])])]),s._v(" "),t("li",[t("code",[s._v("olcAccess: to <what> [ by <who> [<accesslevel>] [<control>] ]+")]),s._v(" "),t("ul",[t("li",[s._v("允许 what 被 who 访问，分配 accesslevel 级别的权限。")]),s._v(" "),t("li",[s._v("如果不配置 olcAccess ，则默认为 "),t("code",[s._v("* by * read")]),s._v(" 。")]),s._v(" "),t("li",[s._v("如果用户访问一个对象时没有读取权限，会报错该对象不存在。")]),s._v(" "),t("li",[s._v("在存在多个 olcAccess 规则时，最先匹配的那个会生效。如下，匿名用户会应用第二个 by 规则。"),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("olcAccess: {0}to *\n                    by self write\n                    by anonymous auth\n                    by * read\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])])]),s._v(" "),t("li",[s._v("what 的取值示例："),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("*           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 所有条目或属性")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dn")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("regex"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 与正则表达式匹配的条目或属性")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])]),s._v(" "),t("li",[s._v("who 的取值示例："),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("*           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 所有用户，包括匿名用户")]),s._v("\nanonymous   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 匿名用户")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("users")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通过身份认证的用户")]),s._v("\nself        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 目标条目自身的用户")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dn")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("regex"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 与正则表达式匹配的用户")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])])])])])])])]),s._v(" "),t("h3",{attrs:{id:"配置密码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置密码"}},[s._v("#")]),s._v(" 配置密码")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("生成密码的哈希值：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("root@openldap:/"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# slappasswd")]),s._v("\nNew password:                             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 按提示输入密码")]),s._v("\nRe-enter new password:\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("SSHA"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("CZX8qY73ejSEKSyWsKFxpWqSJoyDgCRG    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 它会根据输入的密码生成一个哈希值")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("创建一个 .ldif 文件：")]),s._v(" "),t("div",{staticClass:"language-ini line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-ini"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 替换 {0}config 数据库的 Root 密码")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("dn: olcDatabase")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("{0}config, cn=config                # 指定一个要操作的条目")]),s._v("\nchangetype: modify                                  # 指定操作类型为 modify\nreplace: olcRootPW                                  # 指定 modify 类型为 replace ，并指定要操作的属性\nolcRootPW: {SSHA}CZX8qY73ejSEKSyWsKFxpWqSJoyDgCRG   # 采用刚刚生成的哈希值作为密码\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("导入 .ldif 文件：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("root@openldap:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ldapadd -H ldapi:/// -Y EXTERNAL -f 1.ldif")]),s._v("\nSASL/EXTERNAL authentication started                                    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示的前 3 行表示正在进行 SASL 认证")]),s._v("\nSASL username: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("gidNumber")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("+uidNumber"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",cn"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("peercred,cn"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("external,cn"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("auth  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 当前 SASL 的用户名")]),s._v("\nSASL SSF: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nmodifying entry "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"olcDatabase={0}config, cn=config"')]),s._v("                      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 正在修改一个条目（操作成功并不会显示反馈，操作失败才会显示报错）")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("尝试用新密码查询：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("ldapsearch -x -D "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cn=admin,cn=config"')]),s._v(" -w ****** -b "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cn=config'")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])])]),s._v(" "),t("h3",{attrs:{id:"配置数据库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置数据库"}},[s._v("#")]),s._v(" 配置数据库")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("创建一个 .ldif 文件：")]),s._v(" "),t("div",{staticClass:"language-ini line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-ini"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置 {1}mdb 数据库的 olcSuffix")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("dn: olcDatabase")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("{1}mdb,cn=config")]),s._v("\nchangetype: modify\nreplace: olcSuffix\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("olcSuffix: dc")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("example,dc=org")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置 {1}mdb 数据库的 root 名")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("dn: olcDatabase")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("{1}mdb,cn=config")]),s._v("\nchangetype: modify\nreplace: olcRootDN\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("olcRootDN: cn")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("root,dc=example,dc=org")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置 {1}mdb 数据库的 root 密码")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("dn: olcDatabase")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("{1}mdb,cn=config")]),s._v("\nchangetype: modify\nreplace: olcRootPW\nolcRootPW:{SSHA}CZX8qY73ejSEKSyWsKFxpWqSJoyDgCRG\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置 {1}mdb 数据库的访问权限")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("dn: olcDatabase")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("{1}mdb,cn=config")]),s._v("\nchangetype: modify\nreplace: olcAccess\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("olcAccess: {0}to * by dn.exact")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth manage")]),s._v("\n  by * break\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("olcAccess: {1}to attrs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("userPassword,shadowLastChange by self write      # 设置对密码的权限")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("by dn")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v('"cn=root,dc=example,dc=org" write')]),s._v("\n  by anonymous auth\n  by * none\nolcAccess: {2}to * by self read                                         # 设置对条目的权限\n  "),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("by dn")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v('"cn=root,dc=example,dc=org" write')]),s._v("\n  by * none\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br")])]),t("p",[s._v("TODO ：")]),s._v(" "),t("ul",[t("li",[s._v("这里使用默认创建的 "),t("code",[s._v("olcDatabase={1}mdb,cn=config")]),s._v(" 数据库，不知道如何创建新的数据库。")]),s._v(" "),t("li",[s._v("上述配置中可以修改 olcRootDN 的名称，但改变默认的 olcSuffix 就会导致查询不到。")])])]),s._v(" "),t("li",[t("p",[s._v("导入 .ldif 文件：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("root@openldap:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ldapadd -H ldapi:/// -Y EXTERNAL -f 1.ldif")]),s._v("\nSASL/EXTERNAL authentication started\nSASL username: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("gidNumber")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("+uidNumber"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",cn"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("peercred,cn"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("external,cn"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("auth\nSASL SSF: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nmodifying entry "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"olcDatabase={1}mdb,cn=config"')]),s._v("\n\nmodifying entry "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"olcDatabase={1}mdb,cn=config"')]),s._v("\n\nmodifying entry "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"olcDatabase={1}mdb,cn=config"')]),s._v("\n\nmodifying entry "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"olcDatabase={1}mdb,cn=config"')]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])])])]),s._v(" "),t("h3",{attrs:{id:"导入条目"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#导入条目"}},[s._v("#")]),s._v(" 导入条目")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("创建一个 .ldif 文件：")]),s._v(" "),t("div",{staticClass:"language-ini line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-ini"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("dn: ou")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("dev,dc=example,dc=org")]),s._v("\nobjectClass: organizationalUnit\nou: dev\n\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("dn: ou")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("ops,dc=example,dc=org")]),s._v("\nobjectClass: organizationalUnit\nou: ops\n\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("dn: cn")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("LeoHsiao,ou=ops,dc=example,dc=org")]),s._v("\nobjectClass: person\ncn: LeoHsiao\nsn: Leo\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("导入 .ldif 文件：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("root@openldap:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ldapadd -H ldapi:/// -Y EXTERNAL -f 1.ldif")]),s._v("\nSASL/EXTERNAL authentication started\nSASL username: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("gidNumber")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("+uidNumber"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",cn"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("peercred,cn"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("external,cn"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("auth\nSASL SSF: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nadding new entry "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ou=dev,dc=example,dc=org"')]),s._v("\n\nadding new entry "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ou=ops,dc=example,dc=org"')]),s._v("\n\nadding new entry "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cn=LeoHsiao,ou=ops,dc=example,dc=org"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])])])])])}),[],!1,null,null,null);a.default=e.exports}}]);