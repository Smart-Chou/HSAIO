(window.webpackJsonp=window.webpackJsonp||[]).push([[153],{751:function(s,t,a){"use strict";a.r(t);var n=a(1),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"ssh"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ssh"}},[s._v("#")]),s._v(" SSH")]),s._v(" "),a("p",[s._v("：Secure Shell ，一个加密的网络传输协议，常用于远程登录、传输文件。")]),s._v(" "),a("ul",[a("li",[s._v("于 1995 年发布。\n"),a("ul",[a("li",[s._v("最初是 Unix 系统上的一个程序，后来扩展到其他类 Unix 平台。")]),s._v(" "),a("li",[s._v("主要有两个版本，SSH2 修复了 SSH1 的一些漏洞。")])])]),s._v(" "),a("li",[s._v("基于 TCP 协议通信，工作在应用层。")]),s._v(" "),a("li",[s._v("采用 C/S 架构工作。\n"),a("ul",[a("li",[s._v("SSH 服务器要运行一个守护进程 sshd ，监听发到某个端口（默认是 TCP 22 端口）的 SSH 请求。")]),s._v(" "),a("li",[s._v("SSH 客户端可采用 SecureCRT、Putty 等软件，向服务器发起 SSH 请求。")])])]),s._v(" "),a("li",[s._v("FTP、Telnet、POP 等网络传输协议采用明文传输数据，容易被监听。而 SSH 将数据经过非对称加密之后再传输，很安全，但速度较慢。")])]),s._v(" "),a("h2",{attrs:{id:"服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务器"}},[s._v("#")]),s._v(" 服务器")]),s._v(" "),a("h3",{attrs:{id:"部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署"}},[s._v("#")]),s._v(" 部署")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("运行 sshd 服务器：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v("\nsystemctl start sshd\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" sshd\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("或者运行 docker 镜像：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10022")]),s._v(":22 --name sshd "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SSH_ENABLE_ROOT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SSH_ENABLE_ROOT_PASSWORD_AUTH")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    panubo/sshd:1.5.0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ul",[a("li",[s._v("需要进入容器，手动修改 root 密码。")])])])]),s._v(" "),a("h3",{attrs:{id:"配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[s._v("#")]),s._v(" 配置")]),s._v(" "),a("p",[s._v("sshd 的主配置文件是 "),a("code",[s._v("/etc/ssh/sshd_config")]),s._v(" ，内容示例：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("Port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v("                           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 监听的端口号")]),s._v("\nListenAddress "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0             "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许连接的 IP")]),s._v("\n\nAllowUsers root leo@10.0.0.1      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 只允许这些用户进行 SSH 登录。可以使用通配符 * 和 ? ，可以指定用户的 IP ，可以指定多个用户（用空格分隔）")]),s._v("\nAllowGroups *                     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 只允许这些用户组进行 SSH 登录")]),s._v("\n\nProtocol "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("                        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# SSH 协议的版本")]),s._v("\nHostKey /etc/ssh/ssh_host_rsa_key "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用 SSH2 时，RSA 私钥的位置")]),s._v("\n\nMaxAuthTries "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 每个 TCP 连接的最多认证次数。如果客户端输错密码的次数达到该值的一半，则断开连接")]),s._v("\nMaxSessions "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 最多连接的终端数")]),s._v("\n\nPermitRootLogin "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("               "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许 root 用户登录")]),s._v("\nPasswordAuthentication "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许使用密码登录（否则只能使用 SSH 私钥登录）")]),s._v("\nPermitEmptyPasswords no           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 不允许使用空密码登录")]),s._v("\n\nUseDNS no                         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 不检查目标主机的主机名、 IP 是否与 DNS 一致，否则会增加建立 SSH 连接的耗时")]),s._v("\nStrictHostKeyChecking ask         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# SSH 登录其它主机时，如果发现其公钥与 known_hosts 中的记录不同，则采取什么措施。默认为询问是否连接")]),s._v("\nStrictModes "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("                   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 被 SSH 登录时，检查用户的家目录、authorized_keys 等文件是否只被该用户拥有写权限")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("ul",[a("li",[s._v("修改了配置文件之后，要重启 sshd 服务才会生效："),a("code",[s._v("systemctl restart sshd")])]),s._v(" "),a("li",[a("code",[s._v("~/.ssh/authorized_keys")]),s._v(" 文件记录了一些公钥，允许客户端使用对应的私钥进行 SSH 认证，登录到本机。")]),s._v(" "),a("li",[a("code",[s._v("~/.ssh/known_hosts")]),s._v(" 文件记录了所有与本机成功进行了 SSH 认证的主机的公钥。")]),s._v(" "),a("li",[s._v("如果 StrictModes 检查不通过，则 sshd 依然会拒绝 SSH 认证，并在 "),a("code",[s._v("/var/log/secure")]),s._v(" 文件中报错 "),a("code",[s._v("Authentication refused: bad ownership or modes for file ~/.ssh/authorized_keys")]),s._v(" 。此时建议执行："),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("700")]),s._v("   ~   ~/.ssh\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v("   ~/.ssh/authorized_keys\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])]),s._v(" "),a("li",[s._v("使用 SSH 客户端登录 SSH 服务器时，有两种认证方式：\n"),a("ul",[a("li",[s._v("账号和密码认证：容易被暴力破解密码，还可能受到“中间人攻击”（连接到一个冒充的 SSH 服务器）。")]),s._v(" "),a("li",[s._v("密钥认证：先将 SSH 客户端的公钥放在 SSH 服务器上，当 SSH 客户端要登录时会发出该公钥的指纹，而 SSH 服务器会根据指纹检查 authorized_keys 中是否有匹配的公钥，有的话就允许该客户端登录。然后 SSH 服务器会用该公钥加密一个消息回复给 SSH 客户端，该消息只能被 SSH 客户端的私钥解密，这样就完成了双向认证。")])])]),s._v(" "),a("li",[s._v("为了避免恶意用户频繁尝试 SSH 登录，进行暴力破解，可采取以下措施：\n"),a("ul",[a("li",[s._v("使用复杂的 SSH 密码，或者只允许使用 SSH 密钥进行登录。")]),s._v(" "),a("li",[s._v("禁止 root 用户远程登录，这样暴力破解时还需要猜测有效的用户名。")]),s._v(" "),a("li",[s._v("禁止公网 IP 登录，甚至只允许白名单的 IP 登录。")])])])]),s._v(" "),a("h3",{attrs:{id:"白名单、黑名单"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#白名单、黑名单"}},[s._v("#")]),s._v(" 白名单、黑名单")]),s._v(" "),a("p",[s._v("当 Linux 收到一个 ssh 或 telnet 的连接请求时，会先查看 "),a("code",[s._v("/etc/hosts.allow")]),s._v(" 文件：")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("如果包含该 IP ，则建立 TCP 连接，开始身份认证。")])]),s._v(" "),a("li",[a("p",[s._v("如果不包含该 IP ，则查看 /etc/hosts.deny 文件：")]),s._v(" "),a("ul",[a("li",[s._v("如果包含该 IP ，则拒绝连接。")]),s._v(" "),a("li",[s._v("如果不包含该 IP ，则允许连接。")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("/etc/hosts.allow")]),s._v(" 的内容示例：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("sshd:192.168.0.1\nsshd:192.168.220.    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许一个网段")]),s._v("\nin.telnetd:192.168.0.1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("/etc/hosts.deny")]),s._v(" 的内容示例：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("sshd:ALL              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 禁止所有 IP")]),s._v("\nin.telnetd:ALL\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ul",[a("li",[s._v("修改了配置文件之后，要重启 sshd、telnet 服务才会生效。")])])])]),s._v(" "),a("h2",{attrs:{id:"客户端"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#客户端"}},[s._v("#")]),s._v(" 客户端")]),s._v(" "),a("p",[s._v("使用客户端：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("user"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("host"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用 ssh 协议，以 user 用户（默认为 root ）的身份登录 host 主机")]),s._v("\n      -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定端口号")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("command"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 不打开远程主机的 shell ，而是以非交互模式执行一条命令")]),s._v("\n\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 建立 SSH 连接的同时，可以运行一个代理服务器")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# bind_address 默认为 localhost ，绑定到其它地址时需要在 sshd_config 中启用 GatewayPorts 配置")]),s._v("\n      -L "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("bind_address:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("bind_port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("host"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 让本地的 ssh 进程监听 bind_port 端口，将该端口收到的 TCP 数据包传输到远程主机，由后者转发到任意主机的 <host>:<port>")]),s._v("\n      -R "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("bind_address:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("bind_port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("host"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 让远程主机的 sshd 进程监听 bind_port 端口，将其 TCP 数据包传输到本机，由后者转发到任意主机的 <host>:<port>")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("ul",[a("li",[s._v("例："),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" root@10.0.0.1  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -lh\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" root@10.0.0.1  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hostname | xargs echo"')]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用引号将待执行的命令标明为一个字符串，以免被特殊字符截断")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" root@10.0.0.1  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'echo $HOSTNAME'")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用单引号时，不会在本机读取变量的值，而是直接先将命令发送到远端去执行")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])]),s._v(" "),a("li",[s._v("ssh 登录成功之后，会在目标主机上打开一个 shell 终端，并将其 stdin、stdout 绑定到当前终端。")]),s._v(" "),a("li",[s._v("ssh 连接 timeout 的可能原因：\n"),a("ul",[a("li",[s._v("与目标主机的网络不通。")]),s._v(" "),a("li",[s._v("目标主机没有运行 sshd 服务器，或者防火墙没有开通 22 端口。")]),s._v(" "),a("li",[s._v("目标主机的负载太大，接近卡死，不能响应 ssh 连接请求。")])])]),s._v(" "),a("li",[s._v("通过 sshpass 命令可以传递密码给 ssh、scp 命令，如下："),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" sshpass\nsshpass -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" root@10.0.0.1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),s._v("但这样会将明文密码泄露到终端，比较危险。")]),s._v(" "),a("li",[s._v("采用以下格式可以发送多行命令："),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" -tt root@10.0.0.1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOL\n  uname -n\n  echo hello\nexit\nEOL")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("ul",[a("li",[a("code",[s._v("-tt")]),s._v(" 选项用于强制分配伪终端，从而将远程终端的内容显示到当前终端。")]),s._v(" "),a("li",[s._v("这里将 EOF 声明为定界符，将两个定界符之间的所有内容当作 sh 脚本发送到远程终端执行。\n甚至两个定界符之间的缩进空格，也会被一起发送。")]),s._v(" "),a("li",[s._v("最后一条命令应该是 exit ，用于主动退出远程终端。")])])])]),s._v(" "),a("h2",{attrs:{id:"相关命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#相关命令"}},[s._v("#")]),s._v(" 相关命令")]),s._v(" "),a("h3",{attrs:{id:"ssh-keygen"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ssh-keygen"}},[s._v("#")]),s._v(" ssh-keygen")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ ssh-keygen                        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 生成一对 SSH 密钥（默认采用 RSA 加密算法）")]),s._v("\n            -r rsa                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定加密算法（默认是 rsa）")]),s._v("\n            -C "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"123456@email.com"')]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加备注信息")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ul",[a("li",[s._v("默认会将私钥文件 id_rsa 、公钥文件 id_rsa.pub 保存到 ~/.ssh/ 目录下。")]),s._v(" "),a("li",[s._v("id_rsa.pub 的内容示例如下，只占一行，包括加密算法名称、公钥值、备注信息三个字段。"),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("ssh-rsa AAAAB3NzaC1yc2EAAAABJQAAAQEArFUEBouVr03Wr8qpS2BDSDxi/HCIykWnepfVdafRHoAVcp/YxjiuszjKMRiNXY78yg4P5j9NB1+r0M9OrKkg0yspluWQDLX06EWr3l48+tVHLaCCF+JNJQIuFILvbu+/paKnM3pnCw3WROmJL/o/E75bLNowT5NSIEU2nDbJCvNIslD/VnhdXAoLyqio28McOp2Wie0fJ2x8s1vbLsjdURsr3AUO+KlAoVOgg5Ok7/RZ0ywcWE78IWkIluBQV7I0K5wia2TM+X0I3KvaX1xj5zp18+1X9UeQOEDU10mCZN+mig3Z1qJov1MPS19bMN4BhS5HXDTihW1yW+oRYptG0Q== root@CentOS-1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])]),s._v(" "),a("h3",{attrs:{id:"ssh-copy-id"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ssh-copy-id"}},[s._v("#")]),s._v(" ssh-copy-id")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ ssh-copy-id root@10.0.0.1         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将本机的 SSH 公钥拷贝给目标主机上的指定用户")]),s._v("\n              -i ~/.ssh/id_rsa.pub  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定要拷贝的 SSH 公钥")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ul",[a("li",[s._v("执行该命令时，需要先通过目标主机的 SSH 认证，才有拷贝 SSH 公钥的权限。")]),s._v(" "),a("li",[s._v("该 SSH 公钥会被拷贝到目标主机的指定用户的 ~/.ssh/authorized_keys 文件中，允许以后本机以该用户的 SSH 私钥登录到目标主机。")])]),s._v(" "),a("h3",{attrs:{id:"scp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#scp"}},[s._v("#")]),s._v(" scp")]),s._v(" "),a("p",[s._v("：安全拷贝协议（Secure copy protocol），基于 SSH 协议加密通信，用于在主机之间拷贝文件。")]),s._v(" "),a("p",[s._v("用法：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("file"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". root@10.10.0.1:/root  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将本机的文件拷贝到其它主机（需要通过 SSH 认证）")]),s._v("\n      root@10.10.0.1:/root/f1 /root   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将其它主机的文件拷贝到本机的指定目录")]),s._v("\n      -r                              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 递归操作（用于拷贝目录）")]),s._v("\n      -P "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v("                           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定 SSH 的端口")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h3",{attrs:{id:"sftp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sftp"}},[s._v("#")]),s._v(" sftp")]),s._v(" "),a("p",[s._v("：安全文件传输协议（Secure File Transfer Protocol），基于 SSH 协议加密通信，兼容 FTP 的大部分指令，比 scp 的功能更多。")]),s._v(" "),a("p",[s._v("例：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@CentOS ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sftp root@10.0.0.1")]),s._v("\nConnecting to "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nsftp"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("pwd")]),s._v("\nRemote working directory: /root\nsftp"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\nsftp"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -l\ndrwxr-xr-x    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" root root     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Dec  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2016")]),s._v(" backup\n-rw-r--r--    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6821")]),s._v(" Dec "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v(" test.py\n-rwxrwxr-x    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("115")]),s._v(" Dec "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v(" test.sh\nsftp"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" get test.sh\nFetching /root/test.sh to test.sh\n/root/test.sh                                                "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("%   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6821")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(".7KB/s   00:00\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);