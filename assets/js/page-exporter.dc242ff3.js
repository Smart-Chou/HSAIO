(window.webpackJsonp=window.webpackJsonp||[]).push([[60],{632:function(s,t,a){"use strict";a.r(t);var n=a(1),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"exporter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#exporter"}},[s._v("#")]),s._v(" exporter")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://prometheus.io/docs/instrumenting/exporters/",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方及社区的 exporter 列表"),a("OutboundLink")],1)]),s._v(" "),a("li",[s._v("主流软件大多提供了自己的 exporter 程序，比如 mysqld_exporter、redis_exporter 。有的软件甚至本身就集成了 exporter 格式的 HTTP API 。\n"),a("ul",[a("li",[s._v("没必要启用所有 exporter ，有的监控指标较少，不如自制。")]),s._v(" "),a("li",[s._v("Prometheus 提供了多种编程语言的库，供用户开发 exporter 程序。例如 Python 的第三方库 prometheus-client 。")])])])]),s._v(" "),a("h2",{attrs:{id:"集成类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#集成类型"}},[s._v("#")]),s._v(" 集成类型")]),s._v(" "),a("h3",{attrs:{id:"prometheus"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prometheus"}},[s._v("#")]),s._v(" Prometheus")]),s._v(" "),a("ul",[a("li",[s._v("本身集成了 exporter 格式的 API ，默认的 metrics_path 为 "),a("code",[s._v("/metrics")]),s._v(" 。")]),s._v(" "),a("li",[s._v('在 Grafana 上显示指标时，可参考 Prometheus 数据源自带的 "Prometheus Stats" 仪表盘。')]),s._v(" "),a("li",[s._v("指标示例："),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("prometheus_build_info"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("branch"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"HEAD"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("goversion")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"go1.14.2"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("instance")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.0.0.1:9090"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("job")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"prometheus"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("revision")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ecee9c8abfd118f139014cb1b174b08db3f342cf"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2.18.1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 版本信息")]),s._v("\n\ntime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" - process_start_time_seconds                             "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 运行时长（s）")]),s._v("\nrate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("process_cpu_seconds_total"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                             "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 占用 CPU 核数")]),s._v("\nprocess_resident_memory_bytes                                   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 占用内存")]),s._v("\nprometheus_tsdb_storage_blocks_bytes                            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tsdb block 占用的磁盘空间")]),s._v("\nsum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("delta"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("prometheus_http_requests_total"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(" by "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 每分钟收到 HTTP 请求的次数")]),s._v("\nsum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("delta"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("prometheus_http_request_duration_seconds_sum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 每分钟处理 HTTP 请求的耗时（s）")]),s._v("\n\ncount"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("up "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# target 在线数")]),s._v("\nsum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scrape_samples_scraped"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# scrape 的指标数")]),s._v("\nsum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scrape_duration_seconds"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# scrape 的耗时（s）")]),s._v("\nsum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("delta"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("prometheus_rule_evaluations_total"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(" without "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rule_group"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rule 每分钟的执行次数")]),s._v("\nsum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("delta"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("prometheus_rule_evaluation_failures_total"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(" without "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rule_group"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rule 每分钟的执行失败次数")]),s._v("\ndelta"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("prometheus_rule_evaluation_duration_seconds_sum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rule 每分钟的执行耗时（s）")]),s._v("\n\nALERTS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("alertname"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xxx"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("alertstate")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pending|firing"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 存在的警报")]),s._v("\nALERTS_FOR_STATE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("alertname"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xxx"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("                               "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 警报开始的时间戳（这是 pending 状态的开始时间，不能区分 firing 状态）")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])])])]),s._v(" "),a("h3",{attrs:{id:"alertmanager"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#alertmanager"}},[s._v("#")]),s._v(" Alertmanager")]),s._v(" "),a("ul",[a("li",[s._v("本身集成了 exporter 格式的 API ，默认的 metrics_path 为 "),a("code",[s._v("/metrics")]),s._v(" 。")]),s._v(" "),a("li",[s._v("指标示例："),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("alertmanager_build_info"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("branch"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"HEAD"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("goversion")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"go1.13.5"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("instance")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.0.0.1:9093"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("job")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"alertmanager"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("revision")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"f74be0400a6243d10bb53812d6fa408ad71ff32d"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.20.0"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 版本信息")]),s._v("\n\ntime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" - process_start_time_seconds       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 运行时长（s）")]),s._v("\nirate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("process_cpu_seconds_total"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("5m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 占用 CPU 核数")]),s._v("\nprocess_resident_memory_bytes             "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 占用内存")]),s._v("\nsum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("delta"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("alertmanager_http_request_duration_seconds_sum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 处理 HTTP 请求的耗时（s）")]),s._v("\n\nalertmanager_alerts                       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 存在的警报数（包括激活的、被抑制的）")]),s._v("\nalertmanager_silences"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("state"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"active"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Silences 数量")]),s._v("\nalertmanager_notifications_total          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发送的消息数")]),s._v("\nalertmanager_notifications_failed_total   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发送失败的消息数")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("ul",[a("li",[s._v("如果重启 Alertmanager ，则会使一些计数的指标归零。")])])])]),s._v(" "),a("h3",{attrs:{id:"grafana"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#grafana"}},[s._v("#")]),s._v(" Grafana")]),s._v(" "),a("ul",[a("li",[s._v("本身集成了 exporter 格式的 API ，默认的 metrics_path 为 "),a("code",[s._v("/metrics")]),s._v(" 。\n"),a("ul",[a("li",[s._v("访问时不需要身份认证，但只提供了关于 Grafana 运行状态的指标。")])])]),s._v(" "),a("li",[s._v('在 Grafana 上显示指标时，可参考 Prometheus 数据源自带的 "Grafana metrics" 仪表盘。')]),s._v(" "),a("li",[s._v("指标示例："),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("grafana_build_info"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("branch"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"HEAD"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("edition")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"oss"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("goversion")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"go1.14.1"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("instance")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.0.0.1:3000"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("job")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"grafana"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("revision")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"aee1438ff2"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"7.0.0"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 版本信息")]),s._v("\n\ntime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" - process_start_time_seconds       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 运行时长（s）")]),s._v("\nirate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("process_cpu_seconds_total"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("5m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 占用 CPU 核数")]),s._v("\nprocess_resident_memory_bytes             "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 占用内存")]),s._v("\n\ngrafana_alerting_active_configurations    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Alert Rule 的总数")]),s._v("\ngrafana_alerting_active_alerts            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Alert Rule 的激活数量")]),s._v("\ngrafana_emails_sent_total\ngrafana_emails_sent_failed\n\ndelta"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("grafana_http_request_duration_seconds_count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("handler"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/"')]),s._v(",method"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET"')]),s._v(",status_code"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"200"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 每分钟收到的 HTTP 请求数")]),s._v("\ndelta"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("grafana_http_request_duration_seconds_sum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("handler"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/"')]),s._v(",method"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET"')]),s._v(",status_code"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"200"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 每分钟处理 HTTP 请求的耗时")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])])])]),s._v(" "),a("h3",{attrs:{id:"jenkins"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jenkins"}},[s._v("#")]),s._v(" Jenkins")]),s._v(" "),a("ul",[a("li",[s._v('安装插件 "Prometheus metrics" 可提供 exporter 格式的 API ，默认的 metrics_path 为 '),a("code",[s._v("/prometheus/")]),s._v(" 。\n"),a("ul",[a("li",[s._v('在 Jenkins 的 "Configure System" 页面可以对 "Prometheus" 栏进行配置。')]),s._v(" "),a("li",[s._v("不能统计到安装该插件以前的 Jenkins 指标。")])])]),s._v(" "),a("li",[s._v("指标示例："),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" - process_start_time_seconds     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 运行时长（s）")]),s._v("\nirate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("process_cpu_seconds_total"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("5m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 占用 CPU 核数")]),s._v("\nprocess_resident_memory_bytes           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 占用内存")]),s._v("\ndelta"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("http_requests_count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 每分钟收到 HTTP 请求的次数")]),s._v("\nhttp_requests"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("quantile"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=~")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.5|0.99"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 每分钟处理 HTTP 请求的耗时（s）")]),s._v("\n\njenkins_node_count_value                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# node 总数")]),s._v("\njenkins_node_online_value               "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# node 在线数")]),s._v("\njenkins_executor_count_value            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行器的总数")]),s._v("\njenkins_executor_in_use_value           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行器正在使用的数量")]),s._v("\njenkins_node_builds_count               "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Jenkins 本次启动以来的构建总次数")]),s._v("\n\njenkins_job_count_value                 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Job 总数")]),s._v("\njenkins_queue_size_value                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 构建队列中的 Job 数（最好为 0 ）")]),s._v("\ndefault_jenkins_builds_duration_milliseconds_summary_count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jenkins_job")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xxx'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Job 的构建总次数（当构建结束时才记录）")]),s._v("\ndefault_jenkins_builds_duration_milliseconds_summary_sum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("jenkins_job"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xxx'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Job 的构建总耗时（包括被阻塞的时长）")]),s._v("\ndefault_jenkins_builds_success_build_count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("jenkins_job"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xxx'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Job 构建成功的次数")]),s._v("\ndefault_jenkins_builds_failed_build_count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("jenkins_job"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xxx'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("                     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Job 构建失败的次数")]),s._v("\ndefault_jenkins_builds_last_build_start_time_milliseconds"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("jenkins_job"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xxx'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Job 最近一次构建的开始时间")]),s._v("\ndefault_jenkins_builds_last_build_duration_milliseconds"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("jenkins_job"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xxx'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Job 最近一次构建的持续时长")]),s._v("\ndefault_jenkins_builds_last_build_result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("jenkins_job"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xxx'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("                      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Job 最近一次构建的结果（ 1 代表 success 、0 代表其它状态）")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("ul",[a("li",[s._v("如果删除某个 Job 的构建记录，则会使其总的构建次数减少。")])])])]),s._v(" "),a("h3",{attrs:{id:"zookeeper"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zookeeper"}},[s._v("#")]),s._v(" ZooKeeper")]),s._v(" "),a("ul",[a("li",[s._v("可启用 exporter API ，默认监听 7000 端口， metrics_path 为 "),a("code",[s._v("/metrics")]),s._v(" 。")]),s._v(" "),a("li",[s._v("指标示例："),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关于 zk 集群")]),s._v("\nquorum_size               "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 非 observer 的 server 数量。这取决于配置文件，不会监控在线的 server 数")]),s._v("\nsynced_observers          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# observer 数量")]),s._v("\nelection_time_sum         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 最近一次选举的耗时，单位 ms")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("uptime")]),s._v("                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# leader 的任期时长，单位 ms")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关于 znode")]),s._v("\nznode_count               "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 节点的数量")]),s._v("\nephemerals_count          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 临时节点的数量")]),s._v("\nwrite_per_namespace_sum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"brokers"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 每个一级节点的写数据量")]),s._v("\nread_per_namespace_sum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"brokers"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 每个一级节点的读数据量")]),s._v("\nreadlatency_count         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 读操作的数量。仅统计当前 server 收到的请求")]),s._v("\nreadlatency_sum           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 读操作的耗时")]),s._v("\nupdatelatency_count       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 读操作的数量")]),s._v("\nupdatelatency_sum         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 写操作的耗时，包括等待 quorum 投票")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关于客户端")]),s._v("\nconnection_request_count  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 客户端发出连接请求的累计数量")]),s._v("\nglobal_sessions           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 客户端会话数")]),s._v("\nwatch_count               "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# watch 的数量")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])])])]),s._v(" "),a("h2",{attrs:{id:"通用类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#通用类型"}},[s._v("#")]),s._v(" 通用类型")]),s._v(" "),a("h3",{attrs:{id:"node-exporter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#node-exporter"}},[s._v("#")]),s._v(" node_exporter")]),s._v(" "),a("p",[s._v("：用于监控类 Unix 主机。")]),s._v(" "),a("ul",[a("li",[a("p",[a("a",{attrs:{href:"https://github.com/prometheus/node_exporter",target:"_blank",rel:"noopener noreferrer"}},[s._v("GitHub"),a("OutboundLink")],1)])]),s._v(" "),a("li",[a("p",[s._v("下载后启动：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("./node_exporter\n               "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# --web.listen-address=":9100"')]),s._v("\n               "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# --web.telemetry-path="/metrics"')]),s._v("\n               "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --log.level=info")]),s._v("\n               "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --log.format=logfmt")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("默认的访问地址为 "),a("a",{attrs:{href:"http://localhost:9100/metrics",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://localhost:9100/metrics"),a("OutboundLink")],1)])]),s._v(" "),a("li",[a("p",[s._v("指标示例：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("node_exporter_build_info"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("branch"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"HEAD"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("goversion")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"go1.15.8"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("instance")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.0.0.1:9100"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("job")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node_exporter"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("revision")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"b597c1244d7bef49e6f3359c87a56dd7707f6719"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.1.2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 版本信息")]),s._v("\nnode_uname_info"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("domainname"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"(none)"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("instance")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.0.0.1:9100"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("job")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node_exporter"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("machine")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x86_64"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("nodename")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Centos-1"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("release")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3.10.0-862.el7.x86_64"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("sysname")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Linux"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#1 SMP Fri Apr 20 16:44:24 UTC 2018"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 主机信息")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关于时间")]),s._v("\nnode_boot_time_seconds                        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 主机的启动时刻")]),s._v("\nnode_time_seconds                             "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 主机的当前时间（Unix 时间戳）")]),s._v("\nnode_time_seconds - node_boot_time_seconds    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 主机的运行时长（s）")]),s._v("\nnode_time_seconds - time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" + T                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 主机的时间误差，其中 T 是估计每次抓取及传输的耗时")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关于 CPU")]),s._v("\nnode_load1                                                                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 每分钟的平均负载")]),s._v("\ncount"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("node_cpu_seconds_total"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("mode"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'idle'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# CPU 核数")]),s._v("\navg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("irate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("node_cpu_seconds_total"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("5m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(" without "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cpu"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" * "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# CPU 各模式占比（%）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" - avg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("irate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("node_cpu_seconds_total"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("mode"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"idle"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("5m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(" without"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cpu"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(" * "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# CPU 使用率（%）")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关于内存")]),s._v("\nnode_memory_MemTotal_bytes                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 内存总量，单位 bytes")]),s._v("\nnode_memory_MemAvailable_bytes                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 内存可用量，CentOS 7 以上版本才支持该指标")]),s._v("\nnode_memory_SwapTotal_bytes                   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# swap 内存总量")]),s._v("\nnode_memory_SwapFree_bytes                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# swap 内存可用量")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关于磁盘")]),s._v("\nsum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("node_filesystem_size_bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("fstype"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=~")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("ext"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("d"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("xfs"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(", mountpoint"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("~"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("/boot"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" without"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("device, fstype, mountpoint"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 磁盘总量")]),s._v("\nsum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("node_filesystem_avail_bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("fstype"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=~")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("ext"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("d"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("xfs"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(", mountpoint"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("~"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("/boot"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" without"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("device, fstype, mountpoint"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 磁盘可用量")]),s._v("\nsum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("node_disk_read_bytes_total"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 磁盘每秒读取量")]),s._v("\nsum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("node_disk_written_bytes_total"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 磁盘每秒写入量")]),s._v("\nnode_filefd_maximum                           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 文件描述符的数量上限")]),s._v("\nnode_filefd_allocated                         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 文件描述符的使用数量")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关于网卡")]),s._v("\nnode_network_info"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("address"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"00:60:F6:71:20:18"')]),s._v(",broadcast"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ff:ff:ff:ff:ff:ff"')]),s._v(",device"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"eth0"')]),s._v(",duplex"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"full"')]),s._v(",ifalias"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(",operstate"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"up"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 网卡的信息（broadcast 是广播地址，duplex 是双工模式，）")]),s._v("\nnode_network_up                                                     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 网卡的状态，取值 1、0 表示是否正在启用")]),s._v("\nnode_network_mtu_bytes                                              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# MTU 大小")]),s._v("\nrate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("node_network_receive_bytes_total"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("device"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("~"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("lo"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("docker0"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 网卡每秒接收量")]),s._v("\nrate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("node_network_transmit_bytes_total"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("device"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("~"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("lo"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("docker0"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 网卡每秒发送量")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关于 IP 协议")]),s._v("\nnode_network_receive_packets_total        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 网卡接收的数据包数")]),s._v("\nnode_network_receive_errs_total           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 网卡接收的错误包数")]),s._v("\nnode_network_receive_drop_total           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 网卡接收时的丢弃包数")]),s._v("\nnode_network_receive_compressed_total     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 网卡接收的压缩包数")]),s._v("\nnode_network_receive_multicast_total      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 网卡接收的多播包数")]),s._v("\nnode_network_transmit_packets_total       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 网卡发送的数据包数")]),s._v("\nnode_network_transmit_errs_total\nnode_network_transmit_drop_total\nnode_network_transmit_compressed_total\nnode_netstat_Icmp_InMsgs                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 接收的 ICMP 包数")]),s._v("\nnode_netstat_Icmp_InErrors                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 接收的 ICMP 错误包数")]),s._v("\nnode_netstat_Icmp_OutMsgs                 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发送的 ICMP 包数")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关于 Socket")]),s._v("\nnode_sockstat_sockets_used                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用的 Socket 数")]),s._v("\nnode_sockstat_TCP_inuse                   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 监听的 TCP Socket 数")]),s._v("\nnode_sockstat_TCP_tw\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关于 TCP/UDP 协议")]),s._v("\nnode_netstat_Tcp_CurrEstab                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ESTABLISHED 加 CLOSE_WAIT 状态的 TCP 连接数")]),s._v("\nnode_netstat_Tcp_InSegs                   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 接收的 TCP 包数（包括错误的）")]),s._v("\nnode_netstat_Tcp_InErrs                   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 接收的 TCP 错误包数（比如校验和错误）")]),s._v("\nnode_netstat_Tcp_OutSegs                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发送的 TCP 包数")]),s._v("\nnode_netstat_Udp_InDatagrams              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 接收的 UDP 包数")]),s._v("\nnode_netstat_Udp_InErrors                 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 接收的 UDP 错误包数")]),s._v("\nnode_netstat_Udp_OutDatagrams             "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发送的 UDP 包数")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br")])])])]),s._v(" "),a("h3",{attrs:{id:"process-exporter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#process-exporter"}},[s._v("#")]),s._v(" process-exporter")]),s._v(" "),a("p",[s._v("：用于监控 Linux 主机上的进程、线程。")]),s._v(" "),a("ul",[a("li",[a("p",[a("a",{attrs:{href:"https://github.com/ncabatoff/process-exporter",target:"_blank",rel:"noopener noreferrer"}},[s._v("GitHub"),a("OutboundLink")],1)])]),s._v(" "),a("li",[a("p",[s._v("它主要通过读取 "),a("code",[s._v("/proc/<pid>/")]),s._v(" 目录下的信息，来收集进程指标。")])]),s._v(" "),a("li",[a("p",[s._v("下载后启动：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("./process-exporter -config.path"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("process-exporter.yml\n                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -web.listen-address :9256")]),s._v("\n                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -web.telemetry-path /metrics")]),s._v("\n                  -children"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("false                 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否将子进程占用的资源统计到父进程名下，默认为 true")]),s._v("\n                  -threads"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("false                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否采集每个线程的指标，默认为 true")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("在配置文件中定义需要监控的进程：")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("process_names")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("exe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" top                           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义多行条件，匹配任一条件的进程都会被监控")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /bin/ping\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("comm")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" bash\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{.ExeBase}}"')]),s._v("            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义进程组的 name ，这里调用了模板变量")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cmdline")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /bin/ping localhost\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ping {{.Matches.name}}"')]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里调用正则匹配的元素组作为 name")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cmdline")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ping www.("),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")]),s._v("P<name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\\w"),a("span",{pre:!0,attrs:{class:"token important"}},[s._v("*).com")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用 ?P<name> 的格式命名正则匹配的元素组")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("ul",[a("li",[s._v("process-exporter 运行时，会将主机上每个进程尝试匹配配置文件中的规则。\n"),a("ul",[a("li",[s._v("如果匹配某个条件，则监控该进程。")]),s._v(" "),a("li",[s._v("如果匹配多个条件，则只采用最先匹配的条件。")]),s._v(" "),a("li",[s._v("如果所有条件都不匹配，则不监控该进程。")])])]),s._v(" "),a("li",[s._v("匹配规则分为 3 种类型：\n"),a("ul",[a("li",[s._v("exe ：对进程启动命令中的可执行文件路径，即 "),a("code",[s._v("argv[0]")]),s._v(" ，进行匹配（必须完全相同）。")]),s._v(" "),a("li",[s._v("comm ：对进程的可执行文件的文件名，即 "),a("code",[s._v("/proc/<PID>/comm")]),s._v(" 进行匹配（必须完全相同）。")]),s._v(" "),a("li",[s._v("cmdline ：对进程的启动命令，即 "),a("code",[s._v("/proc/<PID>/cmdline")]),s._v(" ， 进行正则匹配（只要匹配部分字符串即可）。\n"),a("ul",[a("li",[s._v("exe、comm 可以定义多行匹配条件，匹配任一条件的进程都会被监控。")]),s._v(" "),a("li",[s._v("cmdline 也可以定义多行匹配条件，只有同时匹配所有条件的进程才会被监控。")]),s._v(" "),a("li",[s._v("exe、comm 会自动使用匹配条件作为被监控进程的名称，即 groupname 。而 cmdline 需要手动定义 name 。")])])]),s._v(" "),a("li",[s._v("可以将 cmdline 与一个 exe 或 comm 组合使用，既要求进程的启动命令匹配，也要求可执行文件匹配。如下："),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" jenkins\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("comm")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" java\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cmdline")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" java .* "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("jar /usr/share/jenkins/jenkins.war\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])])])]),s._v(" "),a("li",[s._v("定义 cmdline 的 name 时，可调用以下模板变量："),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v(".Comm         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可执行文件的文件名，比如 ping")]),s._v("\n.ExeBase      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进程启动命令中的可执行文件的文件名，比如 ping")]),s._v("\n.ExeFull      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进程启动命令中的可执行文件路径，比如 /bin/ping")]),s._v("\n.Username     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动进程的用户名")]),s._v("\n.Matches      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 一个字典，存储 cmdline 正则匹配的结果")]),s._v("\n.PID          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进程的 PID")]),s._v("\n.StartTime    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进程的启动时刻，比如 2021-01-01 07:40:29.22 +0000 UTC")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])])])])]),s._v(" "),a("li",[a("p",[s._v("指标示例：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("process_exporter_build_info"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("branch"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(",goversion"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"go1.15.3"')]),s._v(",revision"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(",version"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.7.5"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 版本信息")]),s._v("\n\nnamedprocess_namegroup_num_procs                                                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进程数（统计属于同一个 groupname 的进程实例数量）")]),s._v("\ntimestamp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("namedprocess_namegroup_oldest_start_time_seconds"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("namedprocess_namegroup_oldest_start_time_seconds"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 运行时长。如果同一个 groupname 中存在多个进程，则考虑最老的那个进程")]),s._v("\nsum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("irate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("namedprocess_namegroup_cpu_seconds_total"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("5m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(" without "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进程占用的 CPU 核数")]),s._v("\nnamedprocess_namegroup_memory_bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("memtype"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"virtual"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("                          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进程申请的虚拟内存")]),s._v("\nnamedprocess_namegroup_memory_bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("memtype"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"resident"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("                         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进程占用的 RAM 内存")]),s._v("\nnamedprocess_namegroup_memory_bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("memtype"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"swapped"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("                          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进程占用的 Swap 内存")]),s._v("\nrate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("namedprocess_namegroup_read_bytes_total"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                               "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进程的磁盘每秒读取量")]),s._v("\nrate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("namedprocess_namegroup_write_bytes_total"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进程的磁盘每秒写入量")]),s._v("\n\nnamedprocess_namegroup_num_threads                                              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进程包含的线程数")]),s._v("\nnamedprocess_namegroup_states"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("state"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Sleeping"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("                                 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Sleeping 状态的线程数")]),s._v("\nnamedprocess_namegroup_open_filedesc                                            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打开的文件描述符数量")]),s._v("\n\nnamedprocess_namegroup_thread_count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("groupname"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"python"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("threadname")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"thread-1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定进程包含的，同一名称的线程数")]),s._v("\nsum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("irate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("namedprocess_namegroup_thread_cpu_seconds_total"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("5m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(" without "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 线程占用的 CPU 核数")]),s._v("\nrate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("namedprocess_namegroup_thread_io_bytes_total"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("iomode"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"read"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 线程的磁盘每秒读取量")]),s._v("\nrate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("namedprocess_namegroup_thread_io_bytes_total"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("iomode"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"write"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 线程的磁盘每秒写入量")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("ul",[a("li",[s._v("当 process-exporter 发现进程 A 之后，就会一直记录它的指标。即使进程 A 停止，也会记录它的 namedprocess_namegroup_num_procs 为 0 。\n"),a("ul",[a("li",[s._v("如果重启 process-exporter ，则只会发现此时存在的进程，不会再记录进程 A 。")]),s._v(" "),a("li",[s._v("如果主机重启之后，进程没有启动，则它不能发现进程没有恢复，不会发出警报。")])])]),s._v(" "),a("li",[s._v("xx_total 之类的指标是累计值，当 process-exporter 重启时会清零，重新累计。")]),s._v(" "),a("li",[s._v("不能监控进程的网络 IO 。")]),s._v(" "),a("li",[s._v("启动 process-exporter 之后，可尝试执行以下命令，查看当前监控的进程："),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:9256/metrics "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" num_procs\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])])])]),s._v(" "),a("h3",{attrs:{id:"windows-exporter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#windows-exporter"}},[s._v("#")]),s._v(" windows_exporter")]),s._v(" "),a("p",[s._v("：用于监控 Windows 主机，也可监控其进程。")]),s._v(" "),a("ul",[a("li",[a("p",[a("a",{attrs:{href:"https://github.com/prometheus-community/windows_exporter",target:"_blank",rel:"noopener noreferrer"}},[s._v("GitHub"),a("OutboundLink")],1)])]),s._v(" "),a("li",[a("p",[s._v("下载 exe 版后启动：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("windows_exporter.exe\n                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --telemetry.addr :9182")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --telemetry.path /metrics")]),s._v("\n                    --collectors.enabled cpu,cs,logical_disk,net,os,process,system  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启用指定的指标采集器")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# --collector.process.whitelist="firefox|chrome"                # 指定要监控的进程的白名单（对进程名进行正则匹配）')]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# --collector.process.blacklist=""                              # 指定要监控的进程的黑名单')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("或者下载 msi 版。执行它会安装 windows_exporter ，并作为后台服务运行、自动开通防火墙。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("windows_exporter.msi\n                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# LISTEN_ADDR 0.0.0.0")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# LISTEN_PORT 9182")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# METRICS_PATH /metrics")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ENABLED_COLLECTORS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("cpu,cs,logical_disk,net,os,process,system\n                    "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("EXTRA_FLAGS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--collector.process.whitelist=firefox|chrome"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("指标示例：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("windows_exporter_build_info"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("branch"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"master"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("goversion")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"go1.13.3"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("instance")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.0.0.1:9182"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("job")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"windows_exporter"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("revision")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"c62fe4477fb5072e569abb44144b77f1c6154016"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.13.0"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 版本信息")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# os collector")]),s._v("\nwindows_os_info"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("instance"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.0.0.1:9182"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("job")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"windows_exporter"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("product")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Microsoft Windows Server 2016 Standard"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.0.14393"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 主机信息")]),s._v("\nwindows_os_time                           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 主机的当前时间（Unix 时间戳）")]),s._v("\nwindows_os_timezone"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("timezone"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CST"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 采用的时区")]),s._v("\nwindows_os_visible_memory_bytes           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可见的物理内存的总量，可能小于实际容量")]),s._v("\nwindows_os_physical_memory_free_bytes     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 物理内存的可用量")]),s._v("\nwindows_os_virtual_memory_bytes           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 虚拟内存的总量")]),s._v("\nwindows_os_virtual_memory_free_bytes      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 虚拟内存的可用量")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cs collector")]),s._v("\nwindows_cs_logical_processors             "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# CPU 核数")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# system collector")]),s._v("\nwindows_system_system_up_time             "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 主机的启动时刻")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cpu collector")]),s._v("\nwindows_cpu_core_frequency_mhz                                                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# CPU 频率")]),s._v("\navg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("irate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("windows_cpu_time_total"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("5m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(" without"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" * "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# CPU 各模式占比（%）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" - avg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("irate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("windows_cpu_time_total"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("mode"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"idle"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("5m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(" without"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(" * "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# CPU 使用率（%）")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# logical_disk collector 的指标")]),s._v("\nsum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("windows_logical_disk_size_bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" without"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("volume"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 磁盘的总量")]),s._v("\nwindows_logical_disk_free_bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("volume"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("~"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'HarddiskVolume.*'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("             "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 磁盘的可用量，磁盘分区 HarddiskVolume 一般是系统保留分区")]),s._v("\nrate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("windows_logical_disk_read_bytes_total"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 磁盘每秒读取量")]),s._v("\nrate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("windows_logical_disk_write_bytes_total"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 磁盘每秒写入量")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# net collector")]),s._v("\nrate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("windows_net_bytes_received_total"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("nic"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xxx"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 网卡每秒接收量")]),s._v("\nrate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("windows_net_bytes_sent_total"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("nic"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xxx"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 网卡每秒发送量")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# process collector")]),s._v("\ntimestamp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("windows_process_start_time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("windows_process_start_time"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进程的运行时长")]),s._v("\nsum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("windows_process_cpu_time_total"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(" without "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进程占用的 CPU 核数")]),s._v("\nwindows_process_private_bytes                                           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进程独占的内存，即进程总共提交的内存，包括物理内存、虚拟内存")]),s._v("\nwindows_process_working_set                                             "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进程可用的内存，包括独占的内存、与其它进程的共享内存")]),s._v("\nwindows_process_thread_count                                            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进程的线程数")]),s._v("\nwindows_process_io_bytes_total                                          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进程的 handle 数量")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br")])]),a("ul",[a("li",[s._v("当 windows_exporter 发现进程 A 之后，就会一直记录它的指标。但是如果进程 A 停止，则不会再记录它的指标。")]),s._v(" "),a("li",[s._v("不能监控进程的网络 IO 。")]),s._v(" "),a("li",[s._v("不能通过启动命令区分相同名字的进程，只能通过 PID 区分。")])])])]),s._v(" "),a("h3",{attrs:{id:"cadvisor"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cadvisor"}},[s._v("#")]),s._v(" cAdvisor")]),s._v(" "),a("p",[s._v("：用于监控容器。")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/google/cadvisor",target:"_blank",rel:"noopener noreferrer"}},[s._v("GitHub"),a("OutboundLink")],1)]),s._v(" "),a("li",[s._v("该工具由 Google 公司开发，支持将监控数据输出到 Prometheus、InfluxDB、Kafka、ES 等存储服务。")]),s._v(" "),a("li",[s._v("下载后启动："),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("./cadvisor\n          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --listen_ip 0.0.0.0")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --port 8080")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --prometheus_endpoint  /metrics")]),s._v("\n          --docker_only"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 不输出 raw cgourp 的指标，除了 root gourp ，即 id="/"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("ul",[a("li",[s._v("它依赖版本较新的 glibc 库，因此建议运行官方 Docker 镜像。")])])]),s._v(" "),a("li",[s._v("它提供了 Web 监控页面，默认只允许从 localhost 访问，可以加上 HTTP Basic Auth 后公开："),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("htpasswd -cb "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("passwd")]),s._v(" admin "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v("\n./cadvisor --http_auth_file "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("passwd")]),s._v(" --http_auth_realm "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),s._v("访问地址为 "),a("code",[s._v("127.0.0.1:8080/containers/")]),s._v(" 。")]),s._v(" "),a("li",[s._v("指标示例："),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("container_start_time_seconds              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 容器的创建时刻（不是启动时刻），采用 Unix 时间戳")]),s._v("\ncontainer_last_seen                       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 最后一次监控该容器的时刻。cadvisor 不会监控已停止的容器，但会在容器停止之后的几分钟内依然记录该指标")]),s._v("\ncontainer_tasks_state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("state"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xx"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 容器是否处于某种状态")]),s._v("\ncontainer_processes                       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进程数")]),s._v("\ncontainer_threads                         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 线程数")]),s._v("\n\ncontainer_cpu_usage_seconds_total         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 容器占用 CPU 的累计时长")]),s._v("\ncontainer_cpu_user_seconds_total          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 占用用户态 CPU 的时长")]),s._v("\ncontainer_cpu_system_seconds_total\ncontainer_cpu_load_average_10s            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 容器占用 CPU 的 10 秒平均负载")]),s._v("\ncontainer_cpu_cfs_throttled_seconds_total "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 容器超出 cpu.cfs_quota_us 限额之后申请的 CPU 时长")]),s._v("\n\ncontainer_memory_usage_bytes              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 容器占用的全部内存，包括 RSS、swap、Page Cache 等")]),s._v("\ncontainer_memory_rss                      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 容器的 rss 内存。超过 Cgroup 限制时会被 OOM 杀死")]),s._v("\ncontainer_memory_swap                     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 容器占用的 swap 分区")]),s._v("\ncontainer_memory_cache                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 容器占用的 Page Cache")]),s._v("\ncontainer_memory_working_set_bytes        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 容器的工作集内存，即最近访问的内存，等于 container_memory_usage_bytes - inactive_page")]),s._v("\n\ncontainer_file_descriptors                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打开的文件数")]),s._v("\ncontainer_fs_usage_bytes                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 容器占用的磁盘，包括 rootfs、终端日志，不包括挂载的 volume")]),s._v("\ncontainer_fs_reads_total                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 磁盘读的累计次数")]),s._v("\ncontainer_fs_reads_bytes_total            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 磁盘读的累计字节量")]),s._v("\ncontainer_fs_read_seconds_total           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 磁盘读的累计耗时")]),s._v("\ncontainer_fs_writes_total"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("device"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xx"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 磁盘写的累计次数，按 device 划分，包括 rootfs、volume ，不包括终端日志，不包括 Page Cache 缓冲区的数据")]),s._v("\ncontainer_fs_write_seconds_total\ncontainer_fs_writes_bytes_total\n\ncontainer_sockets                                       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打开的 Socket 数")]),s._v("\ncontainer_network_receive_bytes_total"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("interface"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xx"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 网络收的累计字节量")]),s._v("\ncontainer_network_receive_packets_total                 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 网络收的累计数据包数")]),s._v("\ncontainer_network_transmit_bytes_total                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 网卡发")]),s._v("\ncontainer_network_transmit_packets_total\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br")])]),a("ul",[a("li",[s._v("假设容器启动之后不断增加内存，则当 container_memory_usage_bytes 达到 Cgroup 上限时，不会触发 OOM ，而是停止增长。\n"),a("ul",[a("li",[s._v("此时容器可以减少 Page Cache ，继续增加 container_memory_working_set_bytes 。")]),s._v(" "),a("li",[s._v("当 container_memory_working_set_bytes 达到 Cgroup 上限时，会触发 OOM ，杀死容器。")])])])])])]),s._v(" "),a("h3",{attrs:{id:"blackbox-exporter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#blackbox-exporter"}},[s._v("#")]),s._v(" blackbox_exporter")]),s._v(" "),a("p",[s._v("：提供探针（probe）的功能，可以通过 DNS、ICMP、TCP、HTTP 等通信监控服务的状态。")]),s._v(" "),a("ul",[a("li",[a("p",[a("a",{attrs:{href:"https://github.com/prometheus/blackbox_exporter",target:"_blank",rel:"noopener noreferrer"}},[s._v("GitHub"),a("OutboundLink")],1)])]),s._v(" "),a("li",[a("p",[s._v("用 docker-compose 部署：")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3'")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("blackbox_exporter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" blackbox_exporter\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" prom/blackbox"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("exporter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("v0.19.0\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" unless"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("stopped\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# command:")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   - --web.listen-address=:9115")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   - --config.file=/etc/blackbox_exporter/config.yml")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 9115"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9115")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /etc/localtime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/etc/localtime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("ro\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - ./config.yml:/etc/blackbox_exporter/config.yml")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("可以手动发出 HTTP 请求，调用探针：")]),s._v(" "),a("ul",[a("li",[s._v("使用 icmp 模块，检测目标主机能否 ping 通，也会检测出 DNS 耗时："),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://localhost:9115/probe?module=icmp&target=baidu.com'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[s._v("使用 tcp_connect 模块，检测目标主机的 TCP 端口能否连通："),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://localhost:9115/probe?module=tcp_connect&target=baidu.com:80'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[s._v("使用 http_2xx 模块，检测目标网站的 HTTP 状态码是否为 2xx ："),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://localhost:9115/probe?module=http_2xx&target=http://baidu.com'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])])]),s._v(" "),a("li",[a("p",[s._v("在 Prometheus 中加入 job 配置，调用探针：")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("job_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" blackbox_exporter\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metrics_path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /probe\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("params")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("module")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("http_2xx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用的模块")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("relabel_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("source_labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("__address__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("target_label")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" __param_target\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("source_labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("__param_target"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("target_label")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" instance\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("target_label")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" __address__\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replacement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'10.0.0.1:9115'")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# blackbox_exporter 的地址")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("static_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'10.0.0.2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("blackbox_exporter 的配置文件中默认定义了一些功能模块，可以在其中加入自定义的模块，如下：")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("modules")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http_2xx_example")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("                   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义一个功能模块")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("prober")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" http                      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 探针的类型，可以是 dns、icmp、tcp、http")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("timeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 2m                       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 每次探测的超时时间，超过则放弃。默认为 2 m")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("                             "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 对应 prober 类型的配置参数")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关于每次探测时发出的 HTTP 请求")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("method")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" GET                     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 请求方法，默认为 GET")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("headers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("<string>")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" <string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" <string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("basic_auth")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("username")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" <string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("password")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" <string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("proxy_url")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" <string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("preferred_ip_protocol")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ip6      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# DNS 解析时，优先采用的 IP 协议，默认为 IPv6")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ip_protocol_fallback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 当 preferred_ip_protocol 不可用时，是否允许另一种 IP 协议。默认为 true")]),s._v("\n\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关于 HTTPS")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("fail_if_ssl")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果采用 SSL ，是否探测失败")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("fail_if_not_ssl")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果不采用 SSL ，是否探测失败")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tls_config")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("insecure_skip_verify")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否跳过检验证书")]),s._v("\n\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关于每次探测时收到的 HTTP 响应")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("valid_status_codes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" <int"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("...")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 有效的状态码，默认为 2xx 。如果出现其它值，则探测失败")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("valid_http_versions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 有效的 HTTP 协议版本")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" HTTP/1.1\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" HTTP/2.0\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("compression")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'gzip'")]),s._v("             "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 响应 body 的解压算法，默认为 ''")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("follow_redirects")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否跟随重定向")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("fail_if_body_matches_regexp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果响应 body 与正则表达式匹配，则探测失败")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" <regex"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("fail_if_body_not_matches_regexp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" <regex"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("fail_if_header_matches")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果响应 header 与正则表达式匹配，则探测失败")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("header")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" <string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("regexp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" <regex"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("allow_missing")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("fail_if_header_not_matches")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - header: Set-Cookie")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   regexp: 'Test.*'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("指标示例：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("probe_success                   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否探测成功（取值 1、0 分别表示成功、失败）")]),s._v("\nprobe_duration_seconds          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 探测的耗时")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关于 DNS")]),s._v("\nprobe_dns_lookup_time_seconds   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# DNS 解析的耗时")]),s._v("\nprobe_ip_protocol               "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# IP 协议，取值为 4、6")]),s._v("\nprobe_ip_addr_hash              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# IP 地址的哈希值，用于判断 IP 是否变化")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关于 HTTP")]),s._v("\nprobe_http_status_code          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# HTTP 响应的状态码。如果发生重定向，则取决于最后一次响应")]),s._v("\nprobe_http_content_length       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# HTTP 响应的 body 长度，单位 bytes")]),s._v("\nprobe_http_version              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# HTTP 响应的协议版本，比如 1.1")]),s._v("\nprobe_http_ssl                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# HTTP 响应是否采用 SSL ，取值为 1、0")]),s._v("\nprobe_ssl_earliest_cert_expiry  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# SSL 证书的过期时间，为 Unix 时间戳")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])])])]),s._v(" "),a("h3",{attrs:{id:"jmx-exporter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jmx-exporter"}},[s._v("#")]),s._v(" jmx_exporter")]),s._v(" "),a("p",[s._v("：用于从 JMX 端口获取监控指标。")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/prometheus/jmx_exporter",target:"_blank",rel:"noopener noreferrer"}},[s._v("GitHub"),a("OutboundLink")],1)])]),s._v(" "),a("h2",{attrs:{id:"专用类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#专用类型"}},[s._v("#")]),s._v(" 专用类型")]),s._v(" "),a("h3",{attrs:{id:"consul-exporter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#consul-exporter"}},[s._v("#")]),s._v(" consul_exporter")]),s._v(" "),a("p",[s._v("：用于监控 Consul 服务器。")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/prometheus/consul_exporter",target:"_blank",rel:"noopener noreferrer"}},[s._v("GitHub"),a("OutboundLink")],1)]),s._v(" "),a("li",[s._v("用 docker-compose 部署："),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3'")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("consul_exporter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" consul_exporter\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" prom/consul"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("exporter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("v0.7.1\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("web.listen"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("address="),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9107")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("web.telemetry"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("path=/metrics\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("consul.server=http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//localhost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8500")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# - --kv.prefix=""  # 采集前缀匹配的 key 的 value')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" unless"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("stopped\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 9107"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9107")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /etc/localtime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/etc/localtime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("ro\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])])]),s._v(" "),a("li",[s._v("指标示例："),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关于节点")]),s._v("\nconsul_up                                       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 当前 agent 节点是否在线")]),s._v("\nconsul_raft_peers                               "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 集群的 server 节点数")]),s._v("\nconsul_serf_lan_members                         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 集群的节点数")]),s._v("\nconsul_serf_lan_member_status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("member"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 各个节点的 gossip 状态，取值 1、2、3、4 分别表示 Alive、Leaving、Left、Failed")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关于服务")]),s._v("\nconsul_catalog_services                                                                           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 已注册的 service 总数，不考虑 service_id 实例数量")]),s._v("\nconsul_catalog_service_node_healthy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("node"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node1"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("service_id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xx"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("service_name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xx"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("             "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 某个 node 上的某个 service_id 是否健康，取值为 1 或 0")]),s._v("\nconsul_health_node_status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("check"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"serfHealth"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("node")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node1"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("status")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"passing"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("                     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 某个 node 是否为 status 状态，取值为 1 或 0")]),s._v("\nconsul_health_service_status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("node"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node1"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("service_id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xx"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("service_name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xx"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("status")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"passing"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 某个 node 上的 service_id 是否为 status 状态，取值为 1 或 0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])])])]),s._v(" "),a("h3",{attrs:{id:"elasticsearch-exporter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#elasticsearch-exporter"}},[s._v("#")]),s._v(" elasticsearch_exporter")]),s._v(" "),a("p",[s._v("：用于监控 ES 服务器。")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/prometheus-community/elasticsearch_exporter",target:"_blank",rel:"noopener noreferrer"}},[s._v("GitHub"),a("OutboundLink")],1)]),s._v(" "),a("li",[s._v("用 docker-compose 部署："),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3'")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("elasticsearch_exporter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" elasticsearch_exporter\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" quay.io/prometheuscommunity/elasticsearch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("exporter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("v1.2.1\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - --web.listen-address=:9114")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - --web.telemetry-path=/metrics")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("es.uri=http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//<user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("<password"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("@elasticsearch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9200")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("es.all                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否监控集群的所有 node 。默认为 false ，只监控当前 node")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - --es.cluster_settings     # 是否监控集群的配置")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - --es.indices              # 是否监控所有 index")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - --es.indices_settings")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - --es.indices_mappings")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("es.shards\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - --es.snapshots")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - --es.timeout  5s          # 从 ES 采集信息的超时时间")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" unless"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("stopped\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 9114"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9114")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /etc/localtime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/etc/localtime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("ro\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])])]),s._v(" "),a("li",[s._v("指标示例："),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("elasticsearch_clusterinfo_version_info"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("build_date"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2018-10-30T23:17:19.084789Z"')]),s._v(",build_hash"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"fe40335"')]),s._v(",cluster"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cluster-1"')]),s._v(",lucene_version"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8.7.0"')]),s._v(",version"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"7.10.2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 版本信息")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关于集群")]),s._v("\nelasticsearch_clusterinfo_up                          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 服务器是否在线，可以采集监控指标")]),s._v("\nelasticsearch_cluster_health_status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("color"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"green"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 集群的状态是否为 green")]),s._v("\nelasticsearch_cluster_health_number_of_nodes          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# node 数量")]),s._v("\nelasticsearch_cluster_health_number_of_data_nodes     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# data node 数量")]),s._v("\nelasticsearch_cluster_health_number_of_pending_tasks  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 等待执行的 task 数量")]),s._v("\nelasticsearch_cluster_health_active_shards            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# shard 总数")]),s._v("\nelasticsearch_cluster_health_active_primary_shards    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# primary shard 数量")]),s._v("\nelasticsearch_cluster_health_unassigned_shards        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# unassigned shard 数量")]),s._v("\nelasticsearch_cluster_health_initializing_shards\nelasticsearch_cluster_health_relocating_shards\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关于 index")]),s._v("\nelasticsearch_indices_docs_total"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("index"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('".kibana"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# index 的可见文档数，包括主分片、副分片的文档，不包括 delete 文档")]),s._v("\nelasticsearch_indices_deleted_docs_total              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# index 的 deleted 文档数")]),s._v("\nelasticsearch_indices_store_size_bytes_total          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# index 占用的磁盘空间，累计所有 node")]),s._v("\nelasticsearch_index_stats_flush_total                         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# index flush 的次数")]),s._v("\nelasticsearch_index_stats_flush_time_seconds_total            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# index flush 的耗时")]),s._v("\nelasticsearch_index_stats_get_total                           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# index GET 的次数")]),s._v("\nelasticsearch_index_stats_get_time_seconds_total              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# index GET 的耗时")]),s._v("\nelasticsearch_index_stats_indexing_delete_total               "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# index delete 的次数")]),s._v("\nelasticsearch_index_stats_indexing_delete_time_seconds_total\nelasticsearch_index_stats_indexing_index_total                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# index 新增文档的次数")]),s._v("\nelasticsearch_index_stats_indexing_index_time_seconds_total\nelasticsearch_index_stats_merge_total                         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# index merge 的次数")]),s._v("\nelasticsearch_index_stats_merge_time_seconds_total\nelasticsearch_index_stats_refresh_total                       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# index refresh 的次数")]),s._v("\nelasticsearch_index_stats_refresh_time_seconds_total\nelasticsearch_index_stats_search_fetch_time_seconds_total     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# search fetch 的次数")]),s._v("\nelasticsearch_index_stats_search_fetch_total\nelasticsearch_index_stats_search_query_time_seconds_total     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# search query 的次数")]),s._v("\nelasticsearch_index_stats_search_query_total\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关于 shard")]),s._v("\nelasticsearch_indices_shards_docs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("index"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('".kibana"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("node")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"qA5eXtIwQU6kbVc-ly5IKg"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("primary")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("shard")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 某个 index 在某个 nodename 上，某个编号的 shard 的文档数")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关于 segment")]),s._v("\nelasticsearch_indices_segment_count_total             "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# index 的 segment 数量")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关于 Node")]),s._v("\nelasticsearch_os_cpu_percent\nelasticsearch_os_load1\nelasticsearch_filesystem_data_size_bytes                            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 磁盘总量")]),s._v("\nelasticsearch_filesystem_data_available_bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node-1"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("mount")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/share/elasticsearch/data (/dev/vdb)"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 磁盘可用大小")]),s._v("\nelasticsearch_filesystem_io_stats_device_read_size_kilobytes_sum    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 磁盘累计读，单位为 KB")]),s._v("\nelasticsearch_filesystem_io_stats_device_write_size_kilobytes_sum   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 磁盘累计写")]),s._v("\nelasticsearch_transport_rx_size_bytes_total                         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 网络累计读")]),s._v("\nelasticsearch_transport_tx_size_bytes_total\nelasticsearch_process_max_files_descriptors\nelasticsearch_process_open_files_count\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关于 JVM")]),s._v("\nelasticsearch_jvm_memory_max_bytes                              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# JVM 内存总量")]),s._v("\nelasticsearch_jvm_memory_used_bytes                             "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# JVM 已用内存")]),s._v("\nsum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("elasticsearch_jvm_gc_collection_seconds_count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" without"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("gc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# GC 累计次数")]),s._v("\nelasticsearch_jvm_gc_collection_seconds_sum                     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# GC 累计耗时")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br")])])])]),s._v(" "),a("h3",{attrs:{id:"kafka-exporter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kafka-exporter"}},[s._v("#")]),s._v(" kafka_exporter")]),s._v(" "),a("p",[s._v("：用于监控 Kafka 。")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/danielqsj/kafka_exporter",target:"_blank",rel:"noopener noreferrer"}},[s._v("GitHub"),a("OutboundLink")],1)]),s._v(" "),a("li",[s._v("用 docker-compose 部署："),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3'")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kafka_exporter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" kafka_exporter\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" danielqsj/kafka"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("exporter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("v1.4.2\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" unless"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("stopped\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - --web.listen-address=:9308")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - --web.telemetry-path=/metrics")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("kafka.server=10.0.0.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9092")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# broker 的地址，可以多次使用该选项")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("kafka.version=2.2.0\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - --sasl.enabled=false")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - --sasl.username=xx")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - --sasl.password=******")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - --topic.filter=.*             # 通过正则表达式筛选要监控的 topic ，例如 filter=^[^_].*")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - --group.filter=.*")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 9308"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9308")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /etc/localtime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/etc/localtime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("ro\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])])]),s._v(" "),a("li",[s._v("指标示例："),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("kafka_exporter_build_info"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("goversion"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"go1.16"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("instance")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.0.0.1:9308"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("job")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kafka_exporter"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 版本信息")]),s._v("\nkafka_brokers                                                              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Kafka 集群的 broker 数量")]),s._v("\n\nkafka_topic_partitions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("topic"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("                                          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 某个 topic 的 partition 数量")]),s._v("\nkafka_topic_partition_replicas"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("topic"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("partition")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("                   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# partition 的副本数")]),s._v("\nkafka_topic_partition_in_sync_replica"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("topic"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("partition")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# partition 的已经同步的副本数")]),s._v("\nkafka_topic_partition_under_replicated_partition"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("topic"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("partition")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# partition 是否存在未同步的副本")]),s._v("\n\nkafka_topic_partition_leader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("topic"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("partition")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("                     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# partition 的 leader 的 ID")]),s._v("\nkafka_topic_partition_leader_is_preferred"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("topic"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("partition")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# partition 的 leader 是否为 preferred replica")]),s._v("\nkafka_topic_partition_current_offset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("topic"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("partition")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("             "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# partition 的当前偏移量")]),s._v("\nkafka_topic_partition_oldest_offset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("topic"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("partition")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# partition 的最早偏移量")]),s._v("\n\nkafka_consumergroup_members"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("consumergroup"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("                                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 某个 consumergroup 的成员数")]),s._v("\nkafka_consumergroup_current_offset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("consumergroup"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("topic")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("partition")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 某个 consumergroup 在某个 partition 的偏移量")]),s._v("\nkafka_consumergroup_lag"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("consumergroup"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("topic")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("partition")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 某个 consumergroup 在某个 partition 的滞后量")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("ul",[a("li",[s._v("不支持监控 Topic 占用的磁盘空间。")])])])]),s._v(" "),a("h3",{attrs:{id:"mongodb-exporter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mongodb-exporter"}},[s._v("#")]),s._v(" mongodb_exporter")]),s._v(" "),a("p",[s._v("：用于监控 MongoDB 服务器。")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/percona/mongodb_exporter",target:"_blank",rel:"noopener noreferrer"}},[s._v("GitHub"),a("OutboundLink")],1)]),s._v(" "),a("li",[s._v("用 docker-compose 部署："),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3'")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mongodb_exporter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mongodb_exporter\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" bitnami/mongodb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("exporter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("0.20.7\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - --web.listen-address=:9216")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - --web.telemetry-path=/metrics")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("mongodb.uri=mongodb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//127.0.0.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("27017/admin\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("mongodb.collstats"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("colls=db1.col1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("db1.col2     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 监控指定集合，可以只指定库名")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - --mongodb.indexstats-colls=db1.col1,db1.col2  # 监控指定索引")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - --discovering-mode                            # 自动发现 collstats-colls、indexstats-colls 的数据库的其它集合")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" unless"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("stopped\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 9216"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9216")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /etc/localtime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/etc/localtime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("ro\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])])]),s._v(" "),a("li",[s._v("指标示例："),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关于 server status")]),s._v("\nmongodb_up                                              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 服务器是否在线")]),s._v("\nmongodb_ss_ok"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("cl_id"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("cl_role")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mongod"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rs_state")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 服务器是否正常运行，取值为 1、0 。标签中记录了 Cluster、ReplicaSet 的信息")]),s._v("\nmongodb_ss_uptime                                       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 服务器的运行时长，单位为秒")]),s._v("\nmongodb_ss_connections"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("conn_type"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"current"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("             "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 客户端连接数")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关于 collection")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("__name__"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=~")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mongodb_.*_storageStats_count'")]),s._v("         , "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("database")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xx"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("collection")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xx"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 文档数")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("__name__"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=~")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mongodb_.*_storageStats_size'")]),s._v("          , "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("database")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xx"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("collection")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xx"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 体积，单位 bytes")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("__name__"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=~")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mongodb_.*_storageStats_storageSize'")]),s._v("   , "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("database")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xx"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("collection")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xx"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 占用的磁盘空间")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("__name__"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=~")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mongodb_.*_storageStats_totalIndexSize'")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("database")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xx"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("collection")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xx"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 索引的体积")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关于操作")]),s._v("\ndelta"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mongodb_ss_opcounters"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行各种操作的数量")]),s._v("\ndelta"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mongodb_ss_opLatencies_latency"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("               "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行各种操作的延迟，单位为微秒")]),s._v("\ndelta"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mongodb_ss_metrics_document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 各种文档的变化数量")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关于锁")]),s._v("\ndelta"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mongodb_ss_locks_acquireCount"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("lock_mode"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"w"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 新加锁的数量。R 表示共享锁，W 表示独占锁，r 表示意向共享锁，w 表示意向独占锁")]),s._v("\nmongodb_ss_globalLock_currentQueue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("count_type"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"total"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 被锁阻塞的操作数")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关于主机的状态")]),s._v("\nmongodb_sys_cpu_num_cpus    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 主机的 CPU 核数")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])])])]),s._v(" "),a("h3",{attrs:{id:"mysqld-exporter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysqld-exporter"}},[s._v("#")]),s._v(" mysqld_exporter")]),s._v(" "),a("p",[s._v("：用于监控 MySQL 服务器。")]),s._v(" "),a("ul",[a("li",[a("p",[a("a",{attrs:{href:"https://github.com/prometheus/mysqld_exporter",target:"_blank",rel:"noopener noreferrer"}},[s._v("GitHub"),a("OutboundLink")],1)])]),s._v(" "),a("li",[a("p",[s._v("用 docker-compose 部署：")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3'")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mysqld_exporter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysqld_exporter\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" prom/mysqld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("exporter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("v0.13.0\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" unless"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("stopped\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# command:")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   - --web.listen-address=:9104")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   - --web.telemetry-path=/metrics")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("DATA_SOURCE_NAME")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user:password@(10.0.0.1:3306)/"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 9104"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9104")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /etc/localtime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/etc/localtime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("ro\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("ul",[a("li",[s._v("需要在 MySQL 中创建一个 exporter 用户："),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USER")]),s._v(" exporter"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'%'")]),s._v(" IDENTIFIED "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'******'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GRANT")]),s._v(" PROCESS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("REPLICATION")]),s._v(" CLIENT "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" exporter"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])])])]),s._v(" "),a("li",[a("p",[s._v("指标示例：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关于服务器")]),s._v("\nmysql_up                                              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 服务器是否在线")]),s._v("\nmysql_global_status_uptime                            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 运行时长，单位 s")]),s._v("\ndelta"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mysql_global_status_bytes_received"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 网络接收的 bytes")]),s._v("\ndelta"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mysql_global_status_bytes_sent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("             "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 网络发送的 bytes")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关于客户端")]),s._v("\nmysql_global_status_threads_connected                 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 当前的客户端连接数")]),s._v("\nmysql_global_status_threads_running                   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 正在执行命令的客户端连接数，即非 sleep 状态")]),s._v("\ndelta"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mysql_global_status_aborted_connects"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 客户端建立连接失败的连接数，比如登录失败")]),s._v("\ndelta"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mysql_global_status_aborted_clients"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 客户端连接之后，未正常关闭的连接数")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关于命令")]),s._v("\ndelta"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mysql_global_status_commands_total"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("command"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xx"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 各种命令的数量")]),s._v("\ndelta"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mysql_global_status_handlers_total"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("handler"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xx"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 各种操作的数量")]),s._v("\ndelta"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mysql_global_status_handlers_total"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("handler"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"commit"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# commit 的数量")]),s._v("\ndelta"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mysql_global_status_table_locks_immediate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 请求获取锁，且立即获得的请求数")]),s._v("\ndelta"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mysql_global_status_table_locks_waited"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 请求获取锁，但需要等待的请求数。该值越少越好")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关于查询")]),s._v("\ndelta"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mysql_global_status_queries"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 每分钟的查询数")]),s._v("\ndelta"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mysql_global_status_slow_queries"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 慢查询数。如果未启用慢查询日志，则为 0")]),s._v("\nmysql_global_status_innodb_page_size                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# innodb 数据页的大小，单位 bytes")]),s._v("\nmysql_global_variables_innodb_buffer_pool_size        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# innodb_buffer_pool 的限制体积")]),s._v("\nmysql_global_status_buffer_pool_pages"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("state"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"data"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 包含数据的数据页数，包括洁页、脏页")]),s._v("\nmysql_global_status_buffer_pool_dirty_pages           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 脏页数")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br")])]),a("ul",[a("li",[s._v("这些监控指标主要从 MySQL 的 "),a("code",[s._v("SHOW GLOBAL STATUS")]),s._v(" 和 "),a("code",[s._v("SHOW GLOBAL VARIABLES")]),s._v(" 获得。")])])])])])}),[],!1,null,null,null);t.default=e.exports}}]);