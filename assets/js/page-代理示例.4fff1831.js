(window.webpackJsonp=window.webpackJsonp||[]).push([[234],{1076:function(s,t,a){"use strict";a.r(t);var n=a(1),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("在本文档中，"),a("code",[s._v("<SERVER>")]),s._v(" 是指您访问 Vaultwarden 的 IP 或域。如果反向代理和 Vaultwarden 都在同一个系统上运行，只需使用 "),a("code",[s._v("localhost")]),s._v("。")]),s._v(" "),a("p",[s._v("默认情况下，Vaultwarden 在端口 "),a("code",[s._v("80")]),s._v(" 上侦听 Web (REST API) 流量，在端口 3012 上侦听 WebSocket 流量(如果 "),a("RouterLink",{attrs:{to:"/vaultwarden/Configuration/Enabling-WebSocket-notifications.html"}},[s._v("启用WebSocket通知")]),s._v(" 已启用)。")],1),s._v(" "),a("p",[s._v("反向代理应配置为终止 SSL/TLS 连接(最好在端口 443，HTTPS 的标准端口上)。然后，反向代理根据需要将传入的客户端请求传递到端口 80 或 3012 上的 vaultwarden，并在收到来自 vaultwarden 的响应后，将该响应传递回客户端。")]),s._v(" "),a("p",[s._v("请注意，当您将 vaultwarden 置于反向代理之后时，反向代理和 vaultwarden 之间的连接通常被假定为通过安全的专用网络，因此不需要加密。")]),s._v(" "),a("p",[s._v("下面的示例假设您在此配置中运行，在这种情况下，您不应启用 vaultwarden 内置的 HTTPS 功能(即，不应设置 "),a("code",[s._v("ROCKET_TLS")]),s._v(" 环境变量)。如果这样做，连接将失败，因为反向代理使用 HTTP 连接到 vaultwarden，但您将 vaultwarden 配置为期望使用 HTTPS。")]),s._v(" "),a("p",[s._v("通常使用 "),a("a",{attrs:{href:"https://docs.docker.com/compose/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Docker Compose"),a("OutboundLink")],1),s._v(" 将容器化服务链接在一起(例如，Vaultwarden 和反向代理)。有关此示例，请参阅 "),a("RouterLink",{attrs:{to:"/vaultwarden/Container/Using-Docker-Compose.html"}},[s._v("使用Docker Compose")])],1),s._v(" "),a("p",[s._v("可以使用 Mozilla 的 "),a("a",{attrs:{href:"https://ssl-config.mozilla.org",target:"_blank",rel:"noopener noreferrer"}},[s._v("SSL 配置生成器"),a("OutboundLink")],1),s._v(" 生成网络服务器的安全 TLS 协议和密码配置。已知所有支持的浏览器和移动应用程序都可以使用"),a("code",[s._v("现代")]),s._v("配置。")]),s._v(" "),a("h2",{attrs:{id:"caddy-2-x"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#caddy-2-x"}},[s._v("#")]),s._v(" Caddy 2.x")]),s._v(" "),a("p",[s._v("Caddy 2 可以在某些情况下自动启用 HTTPS，检查"),a("a",{attrs:{href:"https://caddyserver.com/docs/automatic-https",target:"_blank",rel:"noopener noreferrer"}},[s._v("docs"),a("OutboundLink")],1),s._v(".")]),s._v(" "),a("p",[s._v("在 Caddyfile 语法中，"),a("code",[s._v("{$VAR}")]),s._v(" 表示环境变量 "),a("code",[s._v("VAR")]),s._v(" 的值。 如果您愿意，也可以直接指定一个值而不是替换一个 env var 值。")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("$DOMAIN"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("443 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  log "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    level INFO\n    output file "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("$LOG_FILE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      roll_size 10MB\n      roll_keep 10\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果您想通过 ACME(Let's Encrypt 或 ZeroSSL)获得证书，请取消注释。")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tls {$EMAIL}")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 或者，如果您提供自己的证书，则取消注释。你也可以使用这个选项")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果您在 Cloudflare 后面运行。")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tls {$SSL_CERT_PATH} {$SSL_KEY_PATH}")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 此设置可能与某些浏览器存在兼容性问题")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#(例如，在 Firefox 上下载附件)。尝试禁用此功能")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果你遇到问题。")]),s._v("\n  encode gzip\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 取消注释以提高安全性(警告：仅在您了解含义时才使用！)")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# header {")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#      # 启用 HTTP 严格传输安全 (HSTS)")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#      Strict-Transport-Security "max-age=31536000;"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#      # 启用跨站点过滤器 (XSS) 并告诉浏览器阻止检测到的攻击")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#      X-XSS-Protection "1; mode=block"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#      # 禁止在框架内渲染站点(点击劫持保护)")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#      X-Frame-Options "DENY"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#      # 防止搜索引擎索引(可选)")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#      X-Robots-Tag "none"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#      # 删除服务器名称")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#      -Server")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# }")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 取消注释以仅允许从本地网络访问管理界面")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @insecureadmin {")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   not remote_ip 192.168.0.0/16 172.16.0.0/12 10.0.0.0/8")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   path /admin*")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# }")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# redir @insecureadmin /")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通知重定向到 websockets 服务器")]),s._v("\n  reverse_proxy /notifications/hub <SERVER"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3012")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将其他所有内容代理给 Rocket")]),s._v("\n  reverse_proxy <SERVER"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("80 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将真正的远程IP发送给Rocket，以便Vaultwarden可以将其放入")]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 日志，以便fail2ban 可以禁止正确的IP")]),s._v("\n       header_up X"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("Real"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("IP "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("remote_host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br")])]),a("h2",{attrs:{id:"lighttpd-by-forkbomb9"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#lighttpd-by-forkbomb9"}},[s._v("#")]),s._v(" lighttpd (by forkbomb9)")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v('server.modules += ( "mod_proxy" )\n\n$HTTP'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"host"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(' == "vault.example.net" '),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    $HTTP"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"url"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(' == "/notifications/hub" '),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# WebSocket 代理")]),s._v('\n       proxy.server  = ( "" ='),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(' ("vaultwarden" ='),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(' ( "host" ='),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(' "<SERVER'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v('"'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(' "port" ='),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(' 3012 )))\n       proxy.forwarded = ( "for" ='),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(' 1 )\n       proxy.header = (\n           "https'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('remap" ='),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(' "enable"'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v('\n           "upgrade" ='),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(' "enable"'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v('\n           "connect" ='),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(' "enable"\n       )\n    '),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" else "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v('\n       proxy.server  = ( "" ='),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(' ("vaultwarden" ='),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(' ( "host" ='),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(' "<SERVER'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v('"'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(' "port" ='),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(' 4567 )))\n       proxy.forwarded = ( "for" ='),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(' 1 )\n       proxy.header = ( "https'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('remap" ='),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(' "enable" )\n    '),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("p",[s._v("在 Vaultwarden 环境中，您必须将"),a("code",[s._v("IP_HEADER")]),s._v("设置为"),a("code",[s._v("X-Forwarded-For")]),s._v("而不是"),a("code",[s._v("X-Real-IP")]),s._v("。")]),s._v(" "),a("h2",{attrs:{id:"nginx-by-shauder"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-by-shauder"}},[s._v("#")]),s._v(" Nginx (by shauder)")]),s._v(" "),a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v(" ssl http2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v(" vault.*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Specify SSL config if using a shared one.")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#include conf.d/ssl/ssl.conf;")]),s._v("\n  \n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Allow large attachments")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("client_max_body_size")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("128M")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" http://<SERVER>:80")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Host "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X-Real-IP "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X-Forwarded-For "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$proxy_add_x_forwarded_for")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X-Forwarded-Proto "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$scheme")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  \n  "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /notifications/hub")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" http://<SERVER>:3012")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Upgrade "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_upgrade")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Connection "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"upgrade"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  \n  "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /notifications/hub/negotiate")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" http://<SERVER>:80")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Optionally add extra authentication besides the ADMIN_TOKEN")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# If you don't want this, leave this part out")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /admin")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# See: https://docs.nginx.com/nginx/admin-guide/security-controls/configuring-http-basic-authentication/")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("auth_basic")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Private"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("auth_basic_user_file")]),s._v(" /path/to/htpasswd_file")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Host "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X-Real-IP "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X-Forwarded-For "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$proxy_add_x_forwarded_for")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X-Forwarded-Proto "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$scheme")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" http://<SERVER>:80")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br")])]),a("p",[s._v("如果您遇到 504 Gateway Timeout 问题，请通过向 "),a("code",[s._v("server {")]),s._v(" 部分添加更长的超时时间来告诉 nginx 等待更长时间的密码管理，例如：")]),s._v(" "),a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[s._v("  "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_connect_timeout")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("777")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_send_timeout")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("777")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_read_timeout")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("777")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("send_timeout")]),s._v("                "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("777")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h2",{attrs:{id:"nginx-with-sub-path-by-blackdex"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-with-sub-path-by-blackdex"}},[s._v("#")]),s._v(" Nginx with sub-path (by BlackDex)")]),s._v(" "),a("p",[s._v("在此示例中，Vaultwarden 将通过 "),a("a",{attrs:{href:"https://bitwarden.example.tld/vault/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://bitwarden.example.tld/vault/"),a("OutboundLink")],1),s._v("\n提供 如果你想使用任何其他子路径，比如 "),a("code",[s._v("bitwarden")]),s._v(" 或 "),a("code",[s._v("secret-vault")]),s._v("，你应该在下面的例子中更改 "),a("code",[s._v("/vault/")]),s._v(" 以匹配。")]),s._v(" "),a("p",[s._v("为此，您需要配置您的"),a("code",[s._v("DOMAIN")]),s._v("变量以使其匹配，因此它应该如下所示：")]),s._v(" "),a("div",{staticClass:"language-ini line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 添加子路径！否则这是行不通的！")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("DOMAIN")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("https://bitwarden.example.tld/vault/")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在这里定义服务器IP和端口。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" vaultwarden-default")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 127.0.0.1:8080")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" vaultwarden-ws")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 127.0.0.1:3012")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将 HTTP 重定向到 HTTPS")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" [::]:80")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v(" vaultwarden.example.tld")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("301")]),s._v(" https://"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request_uri")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v(" ssl http2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" [::]:443 ssl http2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v(" vaultwarden.example.tld")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Specify SSL Config when needed")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ssl_certificate /path/to/certificate/letsencrypt/live/vaultwarden.example.tld/fullchain.pem;")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ssl_certificate_key /path/to/certificate/letsencrypt/live/vaultwarden.example.tld/privkey.pem;")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ssl_trusted_certificate /path/to/certificate/letsencrypt/live/vaultwarden.example.tld/fullchain.pem;")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("client_max_body_size")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("128M")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Using a Sub Path Config")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Path to the root of your installation")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /vault/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Host "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X-Real-IP "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X-Forwarded-For "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$proxy_add_x_forwarded_for")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X-Forwarded-Proto "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$scheme")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n      "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" http://vaultwarden-default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /vault/notifications/hub/negotiate")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Host "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X-Real-IP "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X-Forwarded-For "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$proxy_add_x_forwarded_for")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X-Forwarded-Proto "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$scheme")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n      "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" http://vaultwarden-default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /vault/notifications/hub")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Upgrade "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_upgrade")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Connection "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_connection")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X-Real-IP "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n      "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" http://vaultwarden-ws")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Optionally add extra authentication besides the ADMIN_TOKEN")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# If you don't want this, leave this part out")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" ^~ /vault/admin")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# See: https://docs.nginx.com/nginx/admin-guide/security-controls/configuring-http-basic-authentication/")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("auth_basic")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Private"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("auth_basic_user_file")]),s._v(" /path/to/htpasswd_file")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n      "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Host "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X-Real-IP "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X-Forwarded-For "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$proxy_add_x_forwarded_for")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X-Forwarded-Proto "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$scheme")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n      "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" http://vaultwarden-default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br")])]),a("h2",{attrs:{id:"nginx-by-ypid"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-by-ypid"}},[s._v("#")]),s._v(" Nginx (by ypid)")]),s._v(" "),a("p",[s._v("Ansible 库存示例，使用 DebOps 将 nginx 配置为 Vaultwarden 的反向代理。我选择在 URL 中使用 PSK 以提高安全性，以免将 API 暴露给 Internet 上的每个人，因为客户端应用程序尚不支持客户端证书(我已对其进行了测试)。")]),s._v(" "),a("p",[s._v("注意：使用subpath/PSK需要对源代码打补丁重新编译，参考："),a("a",{attrs:{href:"https://github.com/dani-garcia/vaultwarden/issues/241#issuecomment-436376497",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/dani-garcia/vaultwarden/issues/241#issuecomment-436376497"),a("OutboundLink")],1),s._v("。")]),s._v(" "),a("p",[a("code",[s._v("/admin")]),s._v(" 未经测试。有关安全的子路径托管的一般讨论，请参阅："),a("a",{attrs:{href:"https://github.com/debops/debops/issues/1233",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/debops/debops/issues/1233"),a("OutboundLink")],1)]),s._v(" "),a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("bitwarden__fqdn:")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'vault.example.org'")]),s._v("\n\nnginx__upstreams:\n\n  - name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'bitwarden'")]),s._v("\n    type: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'default'")]),s._v("\n    enabled: True\n    server: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost:8000'")]),s._v("\n\nnginx__servers:\n\n  - name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{{ bitwarden__fqdn }}'")]),s._v("\n    filename: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'debops.bitwarden'")]),s._v("\n    by_role: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'debops.bitwarden'")]),s._v("\n    favicon: False\n    root: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/usr/share/vaultwarden/web-vault'")]),s._v("\n\n    location_list:\n\n      - pattern: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/'")]),s._v("\n        options: |-\n          deny all")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n      - "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pattern:")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'= /ekkP9wtJ_psk_changeme_Hr9CCTud'")]),s._v("\n        options: |-\n          return "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("307")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$scheme")]),s._v("://"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request_uri/")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 然后，nginx 也需要设置所有安全 HTTP 标头。")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - pattern: '/ekkP9wtJ_psk_changeme_Hr9CCTud/'")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   options: |-")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     alias /usr/share/vaultwarden/web-vault/;")]),s._v("\n\n      - "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pattern:")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/ekkP9wtJ_psk_changeme_Hr9CCTud/'")]),s._v("\n        options: |-\n          proxy_set_header Host              "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# proxy_set_header X-Real-IP         $remote_addr;")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X-Forwarded-Proto "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$scheme")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X-Forwarded-Port  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n          "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" http://bitwarden")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##不要使用图标功能，只要它显示来自域")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 我们对服务器的凭据。")]),s._v("\n      - "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pattern:")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/ekkP9wtJ_psk_changeme_Hr9CCTud/icons/'")]),s._v("\n        options: |-\n          access_log "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("off")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("log_not_found")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("off")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("deny")]),s._v(" all")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br")])]),a("h2",{attrs:{id:"nginx-nixos-by-tklitschi"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-nixos-by-tklitschi"}},[s._v("#")]),s._v(" Nginx (NixOS)(by tklitschi)")]),s._v(" "),a("p",[s._v("NixOS nginx 配置示例。有关 NixOS 部署的更多信息，请参阅 "),a("RouterLink",{attrs:{to:"/vaultwarden/Deployment/Deployment-examples.html#nixos-由-tklitschi-提供"}},[s._v("部署 Wiki 页面")]),s._v("。")],1),s._v(" "),a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" config, ... "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(":\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("security.acme.acceptTerms")]),s._v(" = true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("security.acme.email")]),s._v(" = "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"me@example.com"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("security.acme.certs")]),s._v(" =")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v('\n\n    "vw.example.com" = '),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("group")]),s._v(" = "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vaultwarden"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("keyType")]),s._v(" = "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rsa2048"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("allowKeysForGroup")]),s._v(" = true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("services.nginx")]),s._v(" =")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("enable")]),s._v(" = true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("recommendedGzipSettings")]),s._v(" = true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("recommendedOptimisation")]),s._v(" = true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("recommendedProxySettings")]),s._v(" = true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("recommendedTlsSettings")]),s._v(" = true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("virtualHosts")]),s._v(" =")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v('\n      "vw.example.com" = '),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("forceSSL")]),s._v(" = true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("enableACME")]),s._v(" = true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v('locations."/"')]),s._v(" =")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxyPass")]),s._v(" = "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://localhost:8812"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#changed the default rocket port due to some conflict")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxyWebsockets")]),s._v(" = true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v('locations."/notifications/hub"')]),s._v(" =")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxyPass")]),s._v(" = "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://localhost:3012"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxyWebsockets")]),s._v(" = true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v('locations."/notifications/hub/negotiate"')]),s._v(" =")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxyPass")]),s._v(" = "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://localhost:8812"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxyWebsockets")]),s._v(" = true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br")])]),a("h2",{attrs:{id:"apache-by-fbartels"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#apache-by-fbartels"}},[s._v("#")]),s._v(" Apache (by fbartels)")]),s._v(" "),a("p",[s._v("请记住启用 "),a("code",[s._v("mod_proxy_wstunnel")]),s._v(" 和 "),a("code",[s._v("mod_proxy_http")]),s._v("，例如："),a("code",[s._v("a2enmod proxy_wstunnel")]),s._v(" 和 "),a("code",[s._v("a2enmod proxy_http")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language-ini line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[s._v("<VirtualHost *:443>\n    SSLEngine on\n    ServerName bitwarden.$hostname.$domainname\n\n    SSLCertificateFile ${SSLCERTIFICATE}\n    SSLCertificateKeyFile ${SSLKEY}\n    SSLCACertificateFile ${SSLCA}\n    ${SSLCHAIN}\n\n    ErrorLog ${APACHE_LOG_DIR}/bitwarden-error.log\n    CustomLog ${APACHE_LOG_DIR}/bitwarden-access.log combined\n\n    RewriteEngine On\n    "),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("RewriteCond %{HTTP:Upgrade}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("websocket [NC]")]),s._v("\n    RewriteRule /notifications/hub(.*) ws://<SERVER>:3012/$1 [P,L]\n    ProxyPass / http://<SERVER>:80/\n\n    ProxyPreserveHost On\n    ProxyRequests Off\n    RequestHeader set X-Real-IP %{REMOTE_ADDR}s\n</VirtualHost>\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("h2",{attrs:{id:"apache-in-a-sub-location-by-ss89"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#apache-in-a-sub-location-by-ss89"}},[s._v("#")]),s._v(" Apache in a sub-location (by ss89)")]),s._v(" "),a("p",[s._v("修改您的 docker 启动以包含子位置。")]),s._v(" "),a("div",{staticClass:"language-ini line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 添加子位置！否则这是行不通的！")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("DOMAIN")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("https://$hostname.$domainname/$sublocation/")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("确保您在 apache 配置中的某处加载了 websocket 代理模块。 它看起来像：")]),s._v(" "),a("div",{staticClass:"language-ini line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[s._v("LoadModule proxy_wstunnel_module modules/mod_proxy_wstunnel.so`\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("在某些操作系统上，您可以使用 a2enmod，例如："),a("code",[s._v("a2enmod proxy_wstunnel")]),s._v(" 和 "),a("code",[s._v("a2enmod proxy_http")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language-ini line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[s._v("<VirtualHost *:443>\n    SSLEngine on\n    ServerName $hostname.$domainname\n\n    SSLCertificateFile ${SSLCERTIFICATE}\n    SSLCertificateKeyFile ${SSLKEY}\n    SSLCACertificateFile ${SSLCA}\n    ${SSLCHAIN}\n\n    ErrorLog ${APACHE_LOG_DIR}/error.log\n    CustomLog ${APACHE_LOG_DIR}/access.log combined\n\n    <Location /$sublocation/> #如有必要，请在此处调整\n        RewriteEngine On\n        "),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("RewriteCond %{HTTP:Upgrade}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("websocket [NC]")]),s._v("\n        RewriteRule /notifications/hub(.*) ws://<SERVER>:3012/$1 [P,L]\n        ProxyPass http://<SERVER>:80/$sublocation/\n\n        ProxyPreserveHost On\n        RequestHeader set X-Real-IP %{REMOTE_ADDR}s\n    </Location>\n</VirtualHost>\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("h2",{attrs:{id:"traefik-v1-docker-compose-example"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#traefik-v1-docker-compose-example"}},[s._v("#")]),s._v(" Traefik v1 (docker-compose example)")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" traefik.enable=true\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" traefik.docker.network=traefik\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" traefik.web.frontend.rule=Host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("bitwarden.domain.tld\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" traefik.web.port=80\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" traefik.hub.frontend.rule=Host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("bitwarden.domain.tld;Path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/notifications/hub\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" traefik.hub.port=3012\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" traefik.hub.protocol=ws\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h2",{attrs:{id:"traefik-v2-docker-compose-example-by-hwwilliams"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#traefik-v2-docker-compose-example-by-hwwilliams"}},[s._v("#")]),s._v(" Traefik v2 (docker-compose example by hwwilliams)")]),s._v(" "),a("p",[a("strong",[s._v("Traefik v1 labels migrated to Traefik v2")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" traefik.enable=true\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" traefik.docker.network=traefik\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" traefik.http.routers.bitwarden"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ui.rule=Host(`bitwarden.domain.tld`)\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" traefik.http.routers.bitwarden"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ui.service=bitwarden"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ui\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" traefik.http.services.bitwarden"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ui.loadbalancer.server.port=80\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" traefik.http.routers.bitwarden"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("websocket.rule=Host(`bitwarden.domain.tld`) "),a("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" Path(`/notifications/hub`)\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" traefik.http.routers.bitwarden"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("websocket.service=bitwarden"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("websocket\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" traefik.http.services.bitwarden"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("websocket.loadbalancer.server.port=3012\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[a("strong",[s._v("迁移标签加上 HTTP 到 HTTPS 重定向")])]),s._v(" "),a("p",[s._v("这些标签假设 Traefik 中为端口 80 和 443 定义的入口点分别是"),a("code",[s._v("web")]),s._v("和"),a("code",[s._v("websecure")]),s._v("。")]),s._v(" "),a("p",[s._v("这些标签还假设您已经在 Traefik 中定义了一个默认的证书解析器。")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" traefik.enable=true\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" traefik.docker.network=traefik\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" traefik.http.middlewares.redirect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("https.redirectScheme.scheme=https\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" traefik.http.middlewares.redirect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("https.redirectScheme.permanent=true\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" traefik.http.routers.bitwarden"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ui"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("https.rule=Host(`bitwarden.domain.tld`)\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" traefik.http.routers.bitwarden"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ui"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("https.entrypoints=websecure\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" traefik.http.routers.bitwarden"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ui"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("https.tls=true\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" traefik.http.routers.bitwarden"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ui"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("https.service=bitwarden"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ui\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" traefik.http.routers.bitwarden"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ui"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("http.rule=Host(`bitwarden.domain.tld`)\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" traefik.http.routers.bitwarden"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ui"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("http.entrypoints=web\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" traefik.http.routers.bitwarden"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ui"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("http.middlewares=redirect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("https\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" traefik.http.routers.bitwarden"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ui"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("http.service=bitwarden"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ui\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" traefik.http.services.bitwarden"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ui.loadbalancer.server.port=80\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" traefik.http.routers.bitwarden"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("websocket"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("https.rule=Host(`bitwarden.domain.tld`) "),a("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" Path(`/notifications/hub`)\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" traefik.http.routers.bitwarden"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("websocket"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("https.entrypoints=websecure\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" traefik.http.routers.bitwarden"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("websocket"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("https.tls=true\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" traefik.http.routers.bitwarden"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("websocket"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("https.service=bitwarden"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("websocket\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" traefik.http.routers.bitwarden"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("websocket"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("http.rule=Host(`bitwarden.domain.tld`) "),a("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" Path(`/notifications/hub`)\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" traefik.http.routers.bitwarden"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("websocket"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("http.entrypoints=web\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" traefik.http.routers.bitwarden"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("websocket"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("http.middlewares=redirect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("https\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" traefik.http.routers.bitwarden"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("websocket"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("http.service=bitwarden"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("websocket\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" traefik.http.services.bitwarden"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("websocket.loadbalancer.server.port=3012\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])]),a("h2",{attrs:{id:"haproxy-by-blackdex"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#haproxy-by-blackdex"}},[s._v("#")]),s._v(" HAproxy (by BlackDex)")]),s._v(" "),a("p",[s._v("将这些行添加到您的 haproxy 配置中。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("frontend vaultwarden\n    bind 0.0.0.0:80\n    option forwardfor header X-Real-IP\n    http-request set-header X-Real-IP %[src]\n    default_backend vaultwarden_http\n    use_backend vaultwarden_ws if { path_beg /notifications/hub } !{ path_beg /notifications/hub/negotiate }\n\nbackend vaultwarden_http\n    # Enable compression if you want\n    # compression algo gzip\n    # compression type text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript\n    server vwhttp 0.0.0.0:8080\n\nbackend vaultwarden_ws\n    server vwws 0.0.0.0:3012\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("h2",{attrs:{id:"haproxy-by-williamdes"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#haproxy-by-williamdes"}},[s._v("#")]),s._v(" HAproxy (by "),a("a",{attrs:{href:"https://github.com/williamdes",target:"_blank",rel:"noopener noreferrer"}},[s._v("@williamdes"),a("OutboundLink")],1),s._v(")")]),s._v(" "),a("p",[s._v("将这些行添加到您的 HAproxy 配置中。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("backend static-success-default\n  mode http\n  errorfile 503 /usr/local/etc/haproxy/static/index.static.default.html\n  errorfile 200 /usr/local/etc/haproxy/static/index.static.default.html\n\nfrontend http-in\n    bind *:80\n    bind *:443 ssl crt /acme.sh/domain.tld/domain.tld.pem\n    option forwardfor header X-Real-IP\n    http-request set-header X-Real-IP %[src]\n    default_backend static-success-default\n\n    # Define hosts\n    acl host_bitwarden_domain_tld hdr(Host) -i bitwarden.domain.tld\n\n    ## 找出使用哪个\n    use_backend vaultwarden_http if host_bitwarden_domain_tld !{ path_beg /notifications/hub } or { path_beg /notifications/hub/negotiate }\n    use_backend vaultwarden_ws if host_bitwarden_domain_tld { path_beg /notifications/hub } !{ path_beg /notifications/hub/negotiate }\n\nbackend vaultwarden_http\n    # 如果需要，启用压缩\n    # 压缩算法 gzip\n    # 压缩类型 text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript\n    # 如果您在 docker-compose 中使用 haproxy，则可以使用容器主机名\n    server vw_http 0.0.0.0:8080\n\nbackend vaultwarden_ws\n    # 如果您在 docker-compose 中使用 haproxy，则可以使用容器主机名\n    server vw_ws 0.0.0.0:3012\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br")])]),a("h2",{attrs:{id:"haproxy-inside-pfsense-by-richardmawdsley"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#haproxy-inside-pfsense-by-richardmawdsley"}},[s._v("#")]),s._v(" HAproxy inside PfSense (by "),a("a",{attrs:{href:"https://github.com/RichardMawdsley",target:"_blank",rel:"noopener noreferrer"}},[s._v("@RichardMawdsley"),a("OutboundLink")],1),s._v(")")]),s._v(" "),a("p",[s._v("作为 GUI 设置，下面的详细信息说明供您在需要的地方添加。")]),s._v(" "),a("ul",[a("li",[s._v("假设您已经有基本的 HTTP>HTTPS 重定向设置 "),a("a",{attrs:{href:"https://blog.devita.co/pfsense-to-proxy-traffic-for-websites-using-pfsense/",target:"_blank",rel:"noopener noreferrer"}},[s._v("基本设置"),a("OutboundLink")],1)])]),s._v(" "),a("h3",{attrs:{id:"后端创建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#后端创建"}},[s._v("#")]),s._v(" 后端创建")]),s._v(" "),a("p",[s._v("Backend 1:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("Mode\tName\t                   Forwardto\t     Address\t     Port\t Encrypt(SSL)\tSSL checks\tWeight\tActions\nactive \tVaultwarden                Address+Port:     IPADDRESSHERE   80          no             no\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("Backend 2:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("Mode\tName\t                   Forwardto\t     Address\t     Port\t Encrypt(SSL)\tSSL checks\tWeight\tActions\nactive \tVaultwarden-Notifications  Address+Port:     IPADDRESSHERE   3012        no             no\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"前端创建-1-域"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前端创建-1-域"}},[s._v("#")]),s._v(" 前端创建 - 1 - 域")]),s._v(" "),a("p",[a("strong",[s._v("ACCESS CONTROL LIST")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("ACL00\nHost matches:\nno\nno\nFQDN.com     -  NOTE:  This needs to be your root domain.  \n\nACL00\nPath starts with:\nno\nyes\n/big-ass-randomised-test-that-really-no-one-is-ever-going-to-type-DONT-USE-THIS-LINE-THOUGH-make-your-own-up\n\nACL01\nHost matches:\nno\nno\nVAULTWARDEN.MYDOMAIN.COM\n\nACL01\nHost matches:\nno\nno\nEXAMPLE-OTHER-SUB-DOMAIN-1.MYDOMAIN.COM\n\nACL01\nHost matches:\nno\nno\nEXAMPLE-OTHER-SUB-DOMAIN-2.MYDOMAIN.COM\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br")])]),a("p",[a("strong",[s._v("ACTIONS - 1 - Domain")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("http-request allow\nSee below\nACL01\n\nhttp-request deny\nSee below\nACL00\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h3",{attrs:{id:"前端创建-2-vaultwarden"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前端创建-2-vaultwarden"}},[s._v("#")]),s._v(" 前端创建 - 2 - VaultWarden")]),s._v(" "),a("p",[a("strong",[s._v("ACCESS CONTROL LIST")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("ACL1\nPath starts with:\nno\nyes\n/notifications/hub  \n\nACL2\nPath starts with:\nno\nno\n/notifications/hub/negotiate  \n\nACL3\nPath starts with:\nno\nno\n/notifications/hub  \n\nACL4\nPath starts with:\nno\nyes\n/notifications/hub/negotiate\n\nACL5\nPath starts with:\nno\nno\n/admin\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br")])]),a("p",[a("strong",[s._v("ACTIONS - 2 - VaultWarden")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("Use Backend\nSee below\nACL1  \nbackend: VaultWarden\n\nUse Backend\nSee below\nACL2  \nbackend: VaultWarden\n\nUse Backend\nSee below\nACL3  \nbackend: VaultWarden-Notifications\n\nUse Backend\nSee below\nACL4\nbackend: VaultWarden-Notifications\n\nhttp-request deny\nSee below\nACL5\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])]),a("p",[a("strong",[s._v("Updates")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("在 30/07 以上更新 - 我在第一个配置之后意识到，因为 ACL1-4 有`Not`，他们正在将任何东西与他们的行动相匹配。所以 BlahBlahMcGee.FQDN.com 正在通过。这不是故意的，所以上面添加了 ACL5 来解决这个问题，它还消除了对默认后端的需要。\n30/07 再次更新 - ^ 是的，没用。这一切都源于 HaProxy 不允许在 ACL 中使用`AND`。叹。现在有了上面的内容，您就可以为根域配置一个前端。这有一个否认本身，以及任何未指定的内容。因此，如果您要通过多个其他子域，则需要将它们全部添加到 ACL01 下。现在一切正常！\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("strong",[s._v("Important Notes")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("1) 您必须使域前端与允许列表中的任何其他子域保持同步\n2) 在域前端，ACL01 必须位于 Actions 表的顶部 - 或至少高于 ACL00\n3) ACL 名称的重复使用是有意的。不，我没有打错它们。 ACL00、ACL01 等\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("strong",[s._v("OPTIONAL")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("上述 ACL5 拒绝访问 /admin 门户。我不是特别喜欢没有任何形式的 2FA 且只有密码的管理门户。因此，当我不使用它时，我只是拒绝访问。如果我需要它，请取消阻止，完成所需的工作并重新阻止。\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("完成！ - 去测试！")]),s._v(" "),a("p",[s._v("This in turn will add the equivilent of below to your config (note this is an extract for example).")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("acl\t\t\tACL00\tvar(txn.txnhost) -m str -i VAULTWARDEN.MYDOMAIN.COM\nacl\t\t\tACL00\tvar(txn.txnpath) -m beg -i /big-ass-randomised-test-that-really-no-one-is-ever-going-to-type-DONT-USE-THIS-LINE-THOUGH-make-your-own-up\nacl\t\t\tACL01\tvar(txn.txnhost) -m str -i EXAMPLE-OTHER-SUB-DOMAIN-1.MYDOMAIN.COM\nacl\t\t\tACL01\tvar(txn.txnhost) -m str -i EXAMPLE-OTHER-SUB-DOMAIN-2.MYDOMAIN.COM\nacl\t\t\tACL1\tvar(txn.txnpath) -m beg -i /notifications/hub\nacl\t\t\tACL2\tvar(txn.txnpath) -m beg -i /notifications/hub/negotiate\nacl\t\t\tACL3\tvar(txn.txnpath) -m beg -i /notifications/hub\nacl\t\t\tACL4\tvar(txn.txnpath) -m beg -i /notifications/hub/negotiate\nacl\t\t\tACL5\tvar(txn.txnpath) -m beg -i /admin\n\nhttp-request allow  if  ACL01 \nhttp-request deny   if  !ACL00 \nhttp-request deny   if  !ACL5 \nhttp-request deny   if  ACL5 \nuse_backend VaultWarden_ipvANY  if  !ACL1 \nuse_backend VaultWarden_ipvANY  if  ACL2 \nuse_backend VaultWarden-Notifications_ipvANY  if  ACL3 \nuse_backend VaultWarden-Notifications_ipvANY  if  !ACL4 \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("p",[s._v("为了进行测试，如果您在浏览器中导航到 /notifications/hub，那么您应该会看到一个页面，上面写着"),a("code",[s._v("WebSocket 协议错误：无法解析 WebSocket 密钥。")]),s._v("……这意味着它可以正常工作！ - 所有其他子页面都应该出现 Rocket 错误。")])])}),[],!1,null,null,null);t.default=e.exports}}]);