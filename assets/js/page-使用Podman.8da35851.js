(window.webpackJsonp=window.webpackJsonp||[]).push([[241],{1067:function(s,a,t){"use strict";t.r(a);var e=t(1),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[t("a",{attrs:{href:"https://podman.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Podman"),t("OutboundLink")],1),s._v(" 是 Docker 的无守护进程替代品，主要兼容 Docker 容器。")]),s._v(" "),t("h2",{attrs:{id:"创建systemd服务文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建systemd服务文件"}},[s._v("#")]),s._v(" 创建systemd服务文件")]),s._v(" "),t("p",[s._v("由于其无守护进程的架构，Podman 比 Docker 更容易在 systemd 中运行。它带有一个方便的"),t("a",{attrs:{href:"http://docs.podman.io/en/latest/markdown/podman-generate-systemd.1.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("生成 systemd 命令"),t("OutboundLink")],1),s._v("，可以生成 systemd 文件。")]),s._v(" "),t("p",[s._v("这是一篇"),t("a",{attrs:{href:"https://www.redhat.com/sysadmin/podman-shareable-systemd-services",target:"_blank",rel:"noopener noreferrer"}},[s._v("详细介绍的好文章"),t("OutboundLink")],1),s._v(" 以及"),t("a",{attrs:{href:"https://www.redhat.com/sysadmin/improved-systemd-podman",target:"_blank",rel:"noopener noreferrer"}},[s._v("这篇文章详细介绍了一些最近的更新"),t("OutboundLink")],1),s._v("。")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("podman")]),s._v(" run -d --name vaultwarden -v /vw-data/:/data/:Z -e "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ROCKET_PORT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(" -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(":8080 vaultwarden/server:latest\n54502f309f3092d32b4c496ef3d099b270b2af7b5464e7cb4887bc16a4d38597\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("podman")]),s._v(" generate systemd --name vaultwarden\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# container-vaultwarden.service")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# autogenerated by Podman 1.6.2")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Tue Nov 19 15:49:15 CET 2019")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Unit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Description")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Podman container-vaultwarden.service\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Documentation")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("man:podman-generate-systemd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Restart")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("on-failure\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/bin/podman start vaultwarden\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStop")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/bin/podman stop -t "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" vaultwarden\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KillMode")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("none\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Type")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("forking\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PIDFile")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/run/user/1000/overlay-containers/54502f309f3092d32b4c496ef3d099b270b2af7b5464e7cb4887bc16a4d38597/userdata/conmon.pid\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("WantedBy")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("multi-user.target default.target\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])]),t("p",[s._v("您可以提供一个 "),t("code",[s._v("--files")]),s._v(" 标志来告诉 podman 将 systemd 服务放入一个文件中。有了这个，我们可以像任何普通的服务文件一样启用和启动容器。")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("$ systemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" /etc/systemd/system/container-vaultwarden.service\n$ systemctl start container-vaultwarden.service\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h2",{attrs:{id:"每次重启都会新建一个容器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#每次重启都会新建一个容器"}},[s._v("#")]),s._v(" 每次重启都会新建一个容器")]),s._v(" "),t("p",[s._v("如果我们想在每次服务启动时创建一个新的容器，我们可以使用 "),t("code",[s._v("podman generate systemd --new")]),s._v(" 命令来生成一个重新创建容器的服务文件")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("podman")]),s._v(" generate systemd --new --name vaultwarden\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("如果您使用的是旧版 Podman，则可以编辑服务文件以包含以下内容：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Unit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Description")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Podman container-vaultwarden.service\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Restart")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("on-failure\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStartPre")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/bin/rm -f /%t/%n-pid /%t/%n-cid\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/bin/podman run --conmon-pidfile /%t/%n-pid --cidfile /%t/%n-cid --env-file"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/home/spytec/Vaultwarden/vaultwarden.conf -d -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(":8080 -v /home/spytec/Vaultwarden/vw-data:/data/:Z vaultwarden/server:latest\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStop")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/bin/podman stop -t "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"15"')]),s._v(" --cidfile /%t/%n-cid\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStop")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/bin/podman "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -f --cidfile /%t/%n-cid\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KillMode")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("none\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Type")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("forking\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PIDFile")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/%t/%n-pid\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("WantedBy")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("multi-user.target default.target\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("p",[s._v("其中 "),t("code",[s._v("vaultwarden.conf")]),s._v(" 环境文件可以包含您需要的所有容器环境值")]),s._v(" "),t("div",{staticClass:"language-conf line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("ROCKET_PORT=8080\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("如果您希望容器具有特定名称，并且进程未正确清理，则可能需要添加 "),t("code",[s._v("ExecStartPre=/usr/bin/podman rm -i -f vaultwarden")]),s._v("。请注意，此方法目前不适用于 "),t("code",[s._v("User=")]),s._v(" 选项用户(请参阅 "),t("a",{attrs:{href:"https://github.com/containers/podman/issues/5572",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/containers/podman/issues/5572"),t("OutboundLink")],1),s._v(")。")]),s._v(" "),t("h2",{attrs:{id:"故障排除"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#故障排除"}},[s._v("#")]),s._v(" 故障排除")]),s._v(" "),t("h3",{attrs:{id:"调试systemd服务文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#调试systemd服务文件"}},[s._v("#")]),s._v(" 调试systemd服务文件")]),s._v(" "),t("p",[s._v("如果主机宕机或容器崩溃，systemd 服务文件应该自动停止现有容器并再次启动它。我们可以通过"),t("code",[s._v("journalctl -u container-vaultwarden -t 100")]),s._v("找到错误。")]),s._v(" "),t("p",[s._v("大多数情况下，我们看到的错误可以通过简单地增加服务文件中 Podman 命令的超时时间来修复。")])])}),[],!1,null,null,null);a.default=n.exports}}]);