(window.webpackJsonp=window.webpackJsonp||[]).push([[242],{1063:function(t,s,e){"use strict";e.r(s);var a=e(1),r=Object(a.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("p",[t._v("要使用 PostgreSQL 后端，您可以使用 "),e("a",{attrs:{href:"https://hub.docker.com/r/vaultwarden/server",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方 Docker 映像"),e("OutboundLink")],1),t._v(" 或构建您自己的二进制文件 "),e("RouterLink",{attrs:{to:"/vaultwarden/Deployment/Building-binary.html#postgresql-后端"}},[t._v("启用 PostgreSQL")]),t._v("。")],1),t._v(" "),e("p",[t._v("要运行二进制文件或容器，请确保设置了 "),e("code",[t._v("DATABASE_URL")]),t._v(" 环境变量(即 "),e("code",[t._v("DATABASE_URL='postgresql://<user>:<password>@postgresql/bitwarden'")]),t._v(")")]),t._v(" "),e("p",[e("strong",[t._v("连接字符串语法：")])]),t._v(" "),e("div",{staticClass:"language-ini line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-ini"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("DATABASE_URL")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("postgresql://[[user]:[password]@]host[:port][/database]")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("p",[t._v("一个示例 docker run 环境变量是：")]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("-e 'DATABASE_URL=postgresql://postgresadmin:strongpassword@postgres:5432/vaultwarden'\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("p",[t._v("如果您的密码包含特殊字符，则需要使用百分比编码。")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("!")]),t._v(" "),e("th",[t._v("#")]),t._v(" "),e("th",[t._v("$")]),t._v(" "),e("th",[t._v("%")]),t._v(" "),e("th",[t._v("&")]),t._v(" "),e("th",[t._v("'")]),t._v(" "),e("th",[t._v("(")]),t._v(" "),e("th",[t._v(")")]),t._v(" "),e("th",[t._v("*")]),t._v(" "),e("th",[t._v("+")]),t._v(" "),e("th",[t._v(",")]),t._v(" "),e("th",[t._v("/")]),t._v(" "),e("th",[t._v(":")]),t._v(" "),e("th",[t._v(";")]),t._v(" "),e("th",[t._v("=")]),t._v(" "),e("th",[t._v("?")]),t._v(" "),e("th",[t._v("@")]),t._v(" "),e("th",[t._v("[")]),t._v(" "),e("th",[t._v("]")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("%21")]),t._v(" "),e("td",[t._v("%23")]),t._v(" "),e("td",[t._v("%24")]),t._v(" "),e("td",[t._v("%25")]),t._v(" "),e("td",[t._v("%26")]),t._v(" "),e("td",[t._v("%27")]),t._v(" "),e("td",[t._v("%28")]),t._v(" "),e("td",[t._v("%29")]),t._v(" "),e("td",[t._v("%2A")]),t._v(" "),e("td",[t._v("%2B")]),t._v(" "),e("td",[t._v("%2C")]),t._v(" "),e("td",[t._v("%2F")]),t._v(" "),e("td",[t._v("%3A")]),t._v(" "),e("td",[t._v("%3B")]),t._v(" "),e("td",[t._v("%3D")]),t._v(" "),e("td",[t._v("%3F")]),t._v(" "),e("td",[t._v("%40")]),t._v(" "),e("td",[t._v("%5B")]),t._v(" "),e("td",[t._v("%5D")])])])]),t._v(" "),e("p",[t._v("完整的代码列表可以在"),e("a",{attrs:{href:"https://en.wikipedia.org/wiki/Percent-encoding#Percent-encoding_reserved_characters",target:"_blank",rel:"noopener noreferrer"}},[t._v("百分比编码的维基百科页面"),e("OutboundLink")],1),t._v("上找到")]),t._v(" "),e("p",[e("strong",[t._v("从 SQLite 迁移到 PostgreSQL")])]),t._v(" "),e("p",[t._v("有一种从 SQLite 迁移到 PostgreSQL 或 MySQL 的简单方法，但请注意，您 "),e("strong",[t._v("使用它的风险由您自己承担，强烈建议您备份安装和数据！")]),t._v("。这是"),e("strong",[t._v("不受支持的")]),t._v("，尚未经过稳健测试。")]),t._v(" "),e("ol",[e("li",[t._v("为 Vaultwarden 创建一个新的(空)数据库：")])]),t._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DATABASE")]),t._v(" vaultwarden"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("p",[t._v("2.新建数据库用户并授予数据库权限：")]),t._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("USER")]),t._v(" vaultwarden "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WITH")]),t._v(" ENCRYPTED PASSWORD "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'yourpassword'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("GRANT")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("all")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("privileges")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("database")]),t._v(" vaultwarden "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TO")]),t._v(" vaultwarden"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br")])]),e("ol",{attrs:{start:"3"}},[e("li",[t._v("配置 Vaultwarden 并启动它，以便diesel 可以运行迁移并正确设置架构。不要做别的。")]),t._v(" "),e("li",[t._v("停止保管员。")]),t._v(" "),e("li",[t._v("安装"),e("a",{attrs:{href:"http://pgloader.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("pgloader"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("RouterLink",{attrs:{to:"/vaultwarden/Configuration/Running-without-WAL-enabled.html#_1-在旧数据库上禁用-wal"}},[t._v("禁用WAL")]),t._v(" SQLite 数据库。")],1),t._v(" "),e("li",[t._v("创建文件bitwarden.load，内容如下：")])]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("load database\n     from sqlite:///where/you/keep/your/vaultwarden/db.sqlite3 \n     into postgresql://yourpgsqluser:yourpgsqlpassword@yourpgsqlserver:yourpgsqlport/yourpgsqldatabase\n     WITH data only, include no drop, reset sequences\n     EXCLUDING TABLE NAMES LIKE '__diesel_schema_migrations'\n     ALTER SCHEMA 'bitwarden' RENAME TO 'public'\n;\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br")])]),e("ol",{attrs:{start:"8"}},[e("li",[t._v("运行命令")])]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("pgloader bitwarden.load\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("p",[t._v("你可能会看到一些警告，但迁移应该成功完成\n9. 再次启动 Vaultwarden。")])])}),[],!1,null,null,null);s.default=r.exports}}]);