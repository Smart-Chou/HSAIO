(window.webpackJsonp=window.webpackJsonp||[]).push([[258],{1059:function(s,a,e){"use strict";e.r(a);var t=e(1),n=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("p",[s._v("这些说明要求您具有 "),e("a",{attrs:{href:"Pre-built-binaries"}},[s._v("预建二进制文件")]),s._v("。如果您生成了 docker 镜像，您可能需要查看 "),e("RouterLink",{attrs:{to:"/vaultwarden/Configuration/Running-with-systemd-docker.html"}},[s._v("*使用 systemd docker 运行")])],1),s._v(" "),e("h2",{attrs:{id:"设置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#设置"}},[s._v("#")]),s._v(" 设置")]),s._v(" "),e("p",[s._v("使 Vaultwarden 在系统启动时启动并使用 systemd 的其他功能(例如隔离、日志记录等)需要一个 "),e("code",[s._v(".service")]),s._v(" 文件。以下是一个可用的起点：")]),s._v(" "),e("div",{staticClass:"language-ini line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-ini"}},[e("code",[e("span",{pre:!0,attrs:{class:"token section"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("Unit")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("Description")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("Bitwarden Server (Rust Edition)")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("Documentation")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("https://github.com/dani-garcia/vaultwarden")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果你使用像 mariadb、mysql 或 postgresql 这样的数据库，")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 你必须像下面这样添加它们并取消它们的注释")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通过删除它之前的 `#`。这可确保您的")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 数据库服务器在 Vaultwarden 之前("After")启动并且已经')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 在启动 Vaultwarden 之前成功启动("Requires")。')]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 只有sqlite")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("After")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("network.target")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# MariaDB")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# After=network.target mariadb.service")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Requires=mariadb.service")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Mysql")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# After=network.target mysqld.service")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Requires=mysqld.service")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# PostgreSQL")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# After=network.target postgresql.service")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Requires=postgresql.service")]),s._v("\n\n\n"),e("span",{pre:!0,attrs:{class:"token section"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("Service")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用户/组 Vaultwarden 在其下运行。工作目录(见下文)应该允许对该用户/组的读写访问")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("User")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("vaultwarden")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("Group")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("vaultwarden")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用于配置的.env 文件的位置")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("EnvironmentFile")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/etc/vaultwarden.env")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编译后的二进制文件的位置")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("ExecStart")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/usr/bin/Vaultwarden")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置合理的连接和进程限制")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("LimitNOFILE")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("1048576")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("LimitNPROC")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("64")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将 Vaultwarden 与系统的其余部分隔离")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("PrivateTmp")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("true")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("PrivateDevices")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("true")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("ProtectHome")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("true")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("ProtectSystem")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("strict")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 只允许写入以下目录，并设置为工作目录(用户和密码数据存放在这里)")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("WorkingDirectory")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/var/lib/vaultwarden")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("ReadWriteDirectories")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/var/lib/vaultwarden")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许Vaultwarden绑定0-1024范围内的端口")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("AmbientCapabilities")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("CAP_NET_BIND_SERVICE")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token section"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("Install")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("WantedBy")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("multi-user.target")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br")])]),e("p",[s._v("更改所有路径以匹配您的安装("),e("code",[s._v("WorkingDirectory")]),s._v(" 和 "),e("code",[s._v("ReadWriteDirectory")]),s._v(" 应该相同)，\n将此文件命名为"),e("code",[s._v("Vaultwarden.service")]),s._v("并将其放入"),e("code",[s._v("/etc/systemd/system")]),s._v("。")]),s._v(" "),e("p",[s._v("如果您必须更改现有的 systemd 文件(由您安装的软件包提供给您)，您可以使用")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("$ sudo systemctl edit vaultwarden.service\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("要让 systemd 知道您的新文件或您所做的任何更改，请运行")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("$ sudo systemctl daemon-reload\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"用法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#用法"}},[s._v("#")]),s._v(" 用法")]),s._v(" "),e("p",[s._v("要启动这个"),e("code",[s._v("服务")]),s._v("，运行")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("$ sudo systemctl start vaultwarden.service\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("要启用自动启动，请运行")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("$ sudo systemctl enable vaultwarden.service\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("以同样的方式，您可以"),e("code",[s._v("停止")]),s._v("、"),e("code",[s._v("重新启动")]),s._v("和"),e("code",[s._v("禁用")]),s._v("服务。")]),s._v(" "),e("h3",{attrs:{id:"更新-vaultwarden"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#更新-vaultwarden"}},[s._v("#")]),s._v(" 更新 Vaultwarden")]),s._v(" "),e("p",[s._v("编译新版本的 vaultwarden 后，您可以复制编译后的(新)二进制文件并替换现有(旧)二进制文件，然后重新启动服务：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("$ sudo systemctl restart vaultwarden.service\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"卸载vaultwarden"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#卸载vaultwarden"}},[s._v("#")]),s._v(" 卸载Vaultwarden")]),s._v(" "),e("p",[s._v("在做任何其他事情之前，您应该停止并禁用该服务：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("$ sudo systemctl disable --now vaultwarden.service\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("然后您可以删除二进制文件、"),e("code",[s._v(".env")]),s._v(" 文件、web-vault 文件夹(如果已安装)和用户数据(如果需要)。记住还要删除专门创建的用户、组和防火墙规则(如果需要)和 systemd 文件。")]),s._v(" "),e("p",[s._v("删除 systemd 文件后，您应该通过以下方式让 systemd 知道它：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("$ sudo systemctl daemon-reload\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"日志和状态视图"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#日志和状态视图"}},[s._v("#")]),s._v(" 日志和状态视图")]),s._v(" "),e("p",[s._v("如果要查看日志输出，请运行")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("$ journalctl -u vaultwarden.service\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("或者要查看更简洁的服务状态，请运行")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("$ systemctl status vaultwarden.service\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"故障排除"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#故障排除"}},[s._v("#")]),s._v(" 故障排除")]),s._v(" "),e("h3",{attrs:{id:"旧-systemd-版本的沙盒选项"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#旧-systemd-版本的沙盒选项"}},[s._v("#")]),s._v(" 旧 systemd 版本的沙盒选项")]),s._v(" "),e("p",[s._v("在 RHEL 7(和 debian 8)中，使用的 systemd 不支持某些使用的隔离选项。 ("),e("a",{attrs:{href:"https://github.com/dani-garcia/vaultwarden/issues/445",target:"_blank",rel:"noopener noreferrer"}},[s._v("#445"),e("OutboundLink")],1),s._v(","),e("a",{attrs:{href:"https://github.com/dani-garcia/vaultwarden/issues/363",target:"_blank",rel:"noopener noreferrer"}},[s._v("#363"),e("OutboundLink")],1),s._v(")\n这可能会导致以下错误之一：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("Failed at step NAMESPACE spawning /home/vaultwarden/vaultwarden: Permission denied\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("or")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("Failed to parse protect system value\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("要解决此问题，您可以通过在包含\n"),e("code",[s._v("PrivateTmp")]),s._v("、"),e("code",[s._v("PrivateDevices")]),s._v("、"),e("code",[s._v("ProtectHome")]),s._v("、"),e("code",[s._v("ProtectSystem")]),s._v(" 和"),e("code",[s._v("ReadWriteDirectories")]),s._v("。虽然注释掉所有这些可能会起作用，但不建议这样做，因为这些是很好的安全措施。要查看您的 systemd 支持哪些选项，请查看以下输出")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("$ systemctl --version\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("确定您的 systemd 版本并与 "),e("a",{attrs:{href:"https://github.com/systemd/systemd/blob/master/NEWS",target:"_blank",rel:"noopener noreferrer"}},[s._v("systemd/NEWS.md"),e("OutboundLink")],1),s._v(" 进行比较。")]),s._v(" "),e("p",[s._v("编辑完你的 "),e("code",[s._v(".service")]),s._v(" 文件后，不要忘记")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("$ sudo systemctl daemon-reload\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("在(重新)开始您的服务之前。")]),s._v(" "),e("h3",{attrs:{id:"服务无法启动"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#服务无法启动"}},[s._v("#")]),s._v(" 服务无法启动")]),s._v(" "),e("p",[s._v("systemd 日志("),e("code",[s._v("journalctl -eu vaultwarden.service")]),s._v(")中显示以下错误：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("Feb 18 05:29:10 staging-bitwarden systemd[1]: Started Bitwarden Server (Rust Edition).\nFeb 18 05:29:10 staging-bitwarden systemd[49506]: vaultwarden.service: Failed to execute command: Resource temporarily unavailable\nFeb 18 05:29:10 staging-bitwarden systemd[49506]: vaultwarden.service: Failed at step EXEC spawning /usr/bin/vaultwarden: Resource temporarily unavailable\nFeb 18 05:29:10 staging-bitwarden systemd[1]: vaultwarden.service: Main process exited, code=exited, status=203/EXEC\nFeb 18 05:29:10 staging-bitwarden systemd[1]: vaultwarden.service: Failed with result 'exit-code'.\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("众所周知，当 vaultwarden 在容器(LXC 等)或本地运行时会发生这种情况。服务文件中的参数"),e("code",[s._v("LimitNPROC=64")]),s._v("阻止服务启动。注释掉该特定参数会导致服务正确启动。")]),s._v(" "),e("p",[e("strong",[s._v("注意")]),s._v("：systemd 覆盖文件将不起作用，该行必须被注释掉/删除。最简单的方法是通过")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# systemctl edit --full vaultwarden.service\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("然后重新加载守护进程并重新启动。")]),s._v(" "),e("h3",{attrs:{id:"环境变量未加载"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#环境变量未加载"}},[s._v("#")]),s._v(" 环境变量未加载")]),s._v(" "),e("p",[s._v("请注意，systemd 不支持与 "),e("code",[s._v("EnvironmentFile")]),s._v(" 文件中的变量在同一行中的注释。在这个 "),e("code",[s._v(".env")]),s._v(" 文件示例中，变量"),e("code",[s._v("WEBSOCKET_ENABLED")]),s._v("不会被加载。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("ROCKET_PORT=XXXX\nWEBSOCKET_ENABLED=true # enable websocket\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("来源："),e("a",{attrs:{href:"https://github.com/dani-garcia/vaultwarden/issues/1607",target:"_blank",rel:"noopener noreferrer"}},[s._v("#1607"),e("OutboundLink")],1)]),s._v(" "),e("h2",{attrs:{id:"更多信息"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#更多信息"}},[s._v("#")]),s._v(" 更多信息")]),s._v(" "),e("p",[s._v("有关 .service 文件的更多信息，请参阅 "),e("a",{attrs:{href:"https://www.freedesktop.org/software/systemd/man/systemd.service.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("systemd.service"),e("OutboundLink")],1),s._v(" 和"),e("a",{attrs:{href:"https://www.freedesktop.org/software/systemd/man/systemd.exec.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("systemd.exec"),e("OutboundLink")],1),s._v("（用于安全性配置）的联机帮助页。")])])}),[],!1,null,null,null);a.default=n.exports}}]);