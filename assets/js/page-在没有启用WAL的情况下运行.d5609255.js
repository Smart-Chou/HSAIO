(window.webpackJsonp=window.webpackJsonp||[]).push([[279],{1057:function(a,t,e){"use strict";e.r(t);var s=e(1),r=Object(s.a)({},(function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("blockquote",[e("p",[a._v("WAL 是 SQLite 特定的设置。不适用于 MySQL 或 PostgreSQL；如果您使用这些后端之一，则"),e("code",[a._v("ENABLE_DB_WAL")]),a._v("配置选项无效。")])]),a._v(" "),e("p",[a._v("默认情况下，在启动期间"),e("code",[a._v("vaultwarden")]),a._v(" 将尝试为数据库启用 "),e("a",{attrs:{href:"https://sqlite.org/wal.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("WAL"),e("OutboundLink")],1),a._v("。添加它可以提高性能，并且在过去有助于防止在某些情况下失败的请求。")]),a._v(" "),e("h2",{attrs:{id:"关闭-wal-的原因"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#关闭-wal-的原因"}},[a._v("#")]),a._v(" 关闭 WAL 的原因")]),a._v(" "),e("p",[a._v("一般来说，除非您绝对确定需要关闭 WAL，否则您应该启用它。但是，可能有一些有效的情况可以将其关闭。例如：")]),a._v(" "),e("ul",[e("li",[a._v("一些文件系统不支持 WAL - 这对于网络文件系统尤其如此。如果您使用这样的文件系统，该服务将无法启动并显示"),e("code",[a._v("Failed to turn on WAL")]),a._v("错误消息。")]),a._v(" "),e("li",[a._v("数据库需要 sqlite 版本 "),e("code",[a._v("3.7.0")]),a._v(" 或更新版本，因此如果您出于任何原因(例如备份)需要使用其他无法更新的工具直接访问数据库，您可能需要禁用 WAL。")]),a._v(" "),e("li",[e("a",{attrs:{href:"https://sqlite.org/wal.html#advantages",target:"_blank",rel:"noopener noreferrer"}},[a._v("此处描述的缺点"),e("OutboundLink")],1),a._v(" 之一会影响您")])]),a._v(" "),e("h2",{attrs:{id:"如何关闭-wal"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#如何关闭-wal"}},[a._v("#")]),a._v(" 如何关闭 WAL")]),a._v(" "),e("h3",{attrs:{id:"_0-进行备份"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_0-进行备份"}},[a._v("#")]),a._v(" 0. 进行备份")]),a._v(" "),e("p",[a._v("这些更改通常是安全的并且可以在不丢失数据的情况下完成，但是在任何更改之前"),e("RouterLink",{attrs:{to:"/vaultwarden/Other/Backing-up-your-vault.html"}},[a._v("备份您的数据")]),a._v(" 是强烈建议。")],1),a._v(" "),e("h3",{attrs:{id:"_1-在旧数据库上禁用-wal"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-在旧数据库上禁用-wal"}},[a._v("#")]),a._v(" 1. 在旧数据库上禁用 WAL")]),a._v(" "),e("p",[a._v("如果你有旧的 DB，它是在启用 WAL 的情况下使用的，你需要使用 sqlite 禁用它：")]),a._v(" "),e("ol",[e("li",[a._v("停止"),e("code",[a._v("Vaultwarden")])]),a._v(" "),e("li",[a._v("找到您的 "),e("RouterLink",{attrs:{to:"/vaultwarden/Configuration/Changing-persistent-data-location.html"}},[a._v("数据文件夹")]),a._v("。通常那里会有 "),e("code",[a._v("db.sqlite3")]),a._v(" 文件，除非你指定了一些其他的名称来使用。")],1),a._v(" "),e("li",[a._v("使用 sqlite 打开文件：")])]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("sqlite3 db.sqlite3\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("ol",{attrs:{start:"4"}},[e("li",[a._v("通过输入"),e("code",[a._v("PRAGMA journal_mode=delete;")]),a._v("并按回车键来禁用WAL：")])]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("sqlite> PRAGMA journal_mode=delete;\ndelete\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br")])]),e("ol",{attrs:{start:"5"}},[e("li",[a._v("输入"),e("code",[a._v(".quit")]),a._v(" 并按回车键退出sqlite 实用程序。 (注意开头的点)")])]),a._v(" "),e("h3",{attrs:{id:"_2-在-vaultwarden-中禁用-wal"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-在-vaultwarden-中禁用-wal"}},[a._v("#")]),a._v(" 2. 在 "),e("code",[a._v("Vaultwarden")]),a._v(" 中禁用 WAL")]),a._v(" "),e("p",[a._v("要关闭 WAL，您需要将"),e("code",[a._v("ENABLE_DB_WAL")]),a._v("变量设置为"),e("code",[a._v("false")]),a._v("来启动"),e("code",[a._v("Vaultwarden")]),a._v("：")]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run -d --name vaultwarden "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  -e "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("ENABLE_DB_WAL")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("false "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  -v /vw-data/:/data/ "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  -p "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("80")]),a._v(":80 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  vaultwarden/server:latest\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br")])]),e("p",[a._v("确保始终以这个变量存在作为启动，即使没有它也会再次启用 WAL。 (如果发生这种情况，请从 "),e("a",{attrs:{href:"#_1-%E5%9C%A8%E6%97%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8A%E7%A6%81%E7%94%A8-wal"}},[a._v("第一步")]),a._v(" 再次禁用它)")]),a._v(" "),e("h2",{attrs:{id:"如何开启-wal"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#如何开启-wal"}},[a._v("#")]),a._v(" 如何开启 WAL")]),a._v(" "),e("p",[a._v("一般来说，你只需启动 "),e("code",[a._v("vaultwarden")]),a._v(" 而不将 "),e("code",[a._v("ENABLE_DB_WAL")]),a._v(" 设置为 false，服务器会自动为你启用 WAL。您可以通过运行来验证这一点：")]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("sqlite3 db.sqlite3 "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v("'PRAGMA journal_mode'")]),a._v("\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("其中"),e("code",[a._v("db.sqlite3")]),a._v(" 是"),e("code",[a._v("vaultwarden")]),a._v(" 使用的数据库文件。它应该返回当前使用的模式，所以在我们的例子中它是 "),e("code",[a._v("wal")]),a._v("。禁用的 WAL 通常会报告"),e("code",[a._v("删除")]),a._v("，因为这是默认设置。")])])}),[],!1,null,null,null);t.default=r.exports}}]);