(window.webpackJsonp=window.webpackJsonp||[]).push([[294],{725:function(s,a,t){"use strict";t.r(a);var n=t(1),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"定时任务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#定时任务"}},[s._v("#")]),s._v(" 定时任务")]),s._v(" "),t("h2",{attrs:{id:"at"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#at"}},[s._v("#")]),s._v(" at")]),s._v(" "),t("p",[s._v("：用于设置一次性的定时任务。")]),s._v(" "),t("ul",[t("li",[s._v("定时任务是指在某些时刻执行某些命令。")])]),s._v(" "),t("h3",{attrs:{id:"用法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#用法"}},[s._v("#")]),s._v(" 用法")]),s._v(" "),t("ul",[t("li",[s._v("命令："),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("$ at\n    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":30 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("-08-16 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" run.sh  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将.sh 脚本的内容设置成定时任务")]),s._v("\n    -l                         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示所有尚未执行的任务")]),s._v("\n    -c "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("任务序号"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("               "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示某个任务的内容")]),s._v("\n    -r "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("任务序号"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("               "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除一个任务")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("ul",[t("li",[s._v("当一次性的定时任务被执行或超时之后，就会被从任务表删除。")])])]),s._v(" "),t("li",[s._v("例：将要执行的命令通过管道符传给 at"),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"systemctl restart docker"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" at "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":00\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])]),s._v(" "),t("li",[s._v("at 指定的时间可以是多种格式："),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("at "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":00           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在今天的指定时刻（如果已超过该时刻，则定位到明天的该时刻）")]),s._v("\nat now + "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" minutes "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在 3 分钟之后")]),s._v("\nat now + "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" hours   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在 3 小时之后")]),s._v("\nat "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":00 + "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" days  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在 3 天之后的 23:00")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])])])]),s._v(" "),t("h2",{attrs:{id:"crontab"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#crontab"}},[s._v("#")]),s._v(" crontab")]),s._v(" "),t("p",[s._v("：用于设置定时执行的任务。")]),s._v(" "),t("ul",[t("li",[s._v("在 Linux 主机上，默认会启动 crond 服务，没有的话就执行 "),t("code",[s._v("systemctl start crond")]),s._v(" 启动。\n"),t("ul",[t("li",[s._v("在容器中，建议执行 "),t("code",[s._v("/usr/sbin/crond -i")]),s._v(" ，作为 daemon 进程启动。")])])]),s._v(" "),t("li",[s._v("每过一分钟，crond 就会检查一次配置文件中的所有定时任务。如果某个任务的定时时间与当前时刻匹配，则创建一个子进程去执行它。")])]),s._v(" "),t("h3",{attrs:{id:"命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#命令"}},[s._v("#")]),s._v(" 命令")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("crontab")]),s._v("\n          -e        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编辑当前用户的任务")]),s._v("\n          -u "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("user"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编辑指定用户的任务")]),s._v("\n          -l        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示任务内容")]),s._v("\n          -r        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除任务内容")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[s._v("#")]),s._v(" 配置")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("crond 会读取以下路径的配置文件：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("/var/spool/cron/    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 该目录下存在与各个用户同名的文件，用于保存用户用 crontab -e 命令编辑的定时任务")]),s._v("\n/etc/crontab        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 保存系统的定时任务，默认为空")]),s._v("\n/etc/cron.d/        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 保存系统的定时任务")]),s._v("\n\n/etc/cron.hourly/   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 被 /etc/cron.d/ 调用，每小时执行一次")]),s._v("\n/etc/cron.daily/    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 老版本的 daily、monthly、weekly 是被 /etc/cron.d/ 调用，现在是被 anacron 进程调用")]),s._v("\n/etc/cron.monthly/\n/etc/cron.weekly/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("用户可以用 "),t("code",[s._v("crontab -e")]),s._v(" 命令编辑自己的定时任务，格式如下：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("*/1 * * * *  "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" hello "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&>>")]),s._v(" /var/log/cron   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 每分钟执行一次，并记录输出内容")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" * * "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6,0")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" hello "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&>")]),s._v(" /dev/null        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在周六、周日的 00:00 时刻执行任务，并丢弃输出")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" * * * "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("-5  "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" hello                     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在周一至周五，每小时执行一次任务")]),s._v("\n@reboot      /root/init.sh                  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 每次重启时执行一次")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("ul",[t("li",[s._v("用 # 声明单行注释。")]),s._v(" "),t("li",[s._v("每行定义一条定时任务，格式为 "),t("code",[s._v("time command")]),s._v(" 。")]),s._v(" "),t("li",[s._v("定时任务的 time 包含五个参数："),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("min       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 分钟，取值为 0~59")]),s._v("\nhour      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 小时，取值为 0~23")]),s._v("\nday       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 日期，取值为 1~31")]),s._v("\nmonth     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 月份，取值为 1~12")]),s._v("\nweekday   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 周几，取值为 0~7 ，其中 0、7 都表示周日")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("ul",[t("li",[s._v("将参数填写为 * 代表没有限制，只要符合其它条件就行。")]),s._v(" "),t("li",[s._v("如果同时填写了 day、weekday ，则只要符合其中一个参数就算匹配。")]),s._v(" "),t("li",[s._v("例：\n"),t("ul",[t("li",[t("code",[s._v("0 * * * *")]),s._v(" 表示到 **:00 时刻执行一次，即每小时的第一分钟执行一次，相当于 "),t("code",[s._v("0 */1 * * *")]),s._v(" 。")]),s._v(" "),t("li",[t("code",[s._v("* */1 * * *")]),s._v(" 表示每小时的每分钟执行一次。")]),s._v(" "),t("li",[t("code",[s._v("*/1")]),s._v(" 表示每 1 个单位时间一次，等价于 "),t("code",[s._v("*")]),s._v(" 。")])])])])]),s._v(" "),t("li",[s._v("crond 在执行任务时：\n"),t("ul",[t("li",[s._v("会切换到用户的家目录。")]),s._v(" "),t("li",[s._v("只会加载很少的环境变量，比如 "),t("code",[s._v("PATH=/usr/bin:/bin")]),s._v(" 。"),t("br"),s._v("\n因此，填写待执行的命令时，应该尽量使用绝对路径，避免找不到文件。或者先执行 "),t("code",[s._v("source /etc/profile")]),s._v(" 。")])])])])]),s._v(" "),t("li",[t("p",[t("code",[s._v("/etc/cron.d/")]),s._v(" 目录下保存了系统的定时任务。格式如下：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("SHELL")])]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/bin/bash                       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 声明少量的环境变量")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/sbin:/bin:/usr/sbin:/usr/bin\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MAILTO")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root                           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将命令输出的 stdout、stderr 发送到邮箱 /var/mail/root")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" * * * *   root    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" hello        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 每行的格式为：执行时间 + 执行用户 + 待执行的命令")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("crond 会在 "),t("code",[s._v("/var/log/cron")]),s._v(" 文件中记录执行的每个任务、执行时刻，如下：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("Jul  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":01:01 localhost CROND"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4701")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" CMD "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("run-parts /etc/cron.hourly"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行 /etc/cron.hourly")]),s._v("\nJul  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":01:01 localhost CROND"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4699")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" CMD "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("echo hello "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&>")]),s._v(" /dev/null"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行用户自定义的任务")]),s._v("\nJul  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":01:01 localhost run-parts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/etc/cron.hourly"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4701")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": starting 0anacron\nJul  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":01:01 localhost run-parts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/etc/cron.hourly"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4712")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": finished 0anacron\nJul  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":01:14 localhost crontab"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4749")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" BEGIN EDIT "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# root 用户执行了 crontab -e 命令")]),s._v("\nJul  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":01:16 localhost crontab"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4749")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" END EDIT "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("ul",[t("li",[s._v("该文件不会记录定时任务输出的 stdout、stderr 。")]),s._v(" "),t("li",[s._v("该文件每过 7 天就会归档一次，最多保存最近一个月的记录。如下："),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@CentOS ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls -lh /var/log/cron*")]),s._v("\n-rw------- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root 148K "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" 月   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":45 /var/log/cron\n-rw------- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root 192K "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" 月   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" 03:21 /var/log/cron-20200607\n-rw------- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root 192K "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" 月  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(" 03:30 /var/log/cron-20200614\n-rw------- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root 192K "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" 月  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(" 03:49 /var/log/cron-20200621\n-rw------- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root 192K "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" 月  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),s._v(" 03:35 /var/log/cron-20200628\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])])])])])]),s._v(" "),t("h2",{attrs:{id:"登录时执行脚本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#登录时执行脚本"}},[s._v("#")]),s._v(" 登录时执行脚本")]),s._v(" "),t("ul",[t("li",[t("p",[t("code",[s._v("/etc/profile")])]),s._v(" "),t("ul",[t("li",[s._v("主要包含 PATH 等环境变量的定义语句，还会调用脚本 /etc/profile.d/*.sh 。")])])]),s._v(" "),t("li",[t("p",[t("code",[s._v("/etc/bashrc")])]),s._v(" "),t("ul",[t("li",[s._v("不会自动执行，只会被 ~/.bashrc 调用。")]),s._v(" "),t("li",[s._v("主要包含一些函数、 alias 的定义语句。")]),s._v(" "),t("li",[s._v("/etc/profile、/etc/bashrc 两个脚本是 Linux 自带的。\n"),t("ul",[t("li",[s._v("新建一个用户时，默认会给它创建 "),t("sub",[s._v("/.bashrc、")]),s._v("/.bash_profile、~/.bash_logout 三个脚本。")])])])])]),s._v(" "),t("li",[t("p",[t("code",[s._v("~/.bashrc")])]),s._v(" "),t("ul",[t("li",[s._v("当用户创建交互模式的 shell 时自动执行。")]),s._v(" "),t("li",[s._v("其默认内容如下，会调用 /etc/bashrc ："),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -f /etc/bashrc "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" /etc/bashrc\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])])]),s._v(" "),t("li",[s._v("例："),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@CentOS ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# bash            # 交互模式，执行顺序如下")]),s._v("\n/root/.bashrc start\n/etc/bashrc start\n/etc/bashrc end\n/root/.bashrc end\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@CentOS ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# bash -c pwd     # 非交互模式，一个也不会执行")]),s._v("\n/root\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])])])]),s._v(" "),t("li",[t("p",[t("code",[s._v("~/.bash_profile")])]),s._v(" "),t("ul",[t("li",[s._v("当用户创建 login shell 时自动执行。")]),s._v(" "),t("li",[s._v("其默认内容如下，会调用 ~/.bashrc ："),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -f ~/.bashrc "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" ~/.bashrc\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.local/bin:"),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/bin\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])])])])]),s._v(" "),t("li",[t("p",[t("code",[s._v("~/.bash_logout")])]),s._v(" "),t("ul",[t("li",[s._v("：当用户退出 login shell 时自动执行。")]),s._v(" "),t("li",[s._v("默认内容为空。")])])]),s._v(" "),t("li",[t("p",[s._v("例：")]),s._v(" "),t("ul",[t("li",[s._v("通过 "),t("code",[s._v("su")]),s._v(" 切换用户时，没有创建 login shell ，所以只会执行 ~/.bashrc 。相当于直接执行 bash 创建一个普通 shell 。")]),s._v(" "),t("li",[s._v("通过 "),t("code",[s._v("su -")]),s._v(" 切换到当前用户时，创建了 login shell ，所以会执行 /etc/profile、~/.bash_profile 。")]),s._v(" "),t("li",[s._v("当用户退出一个普通 shell 时不会执行上述任何脚本。")])])])])])}),[],!1,null,null,null);a.default=e.exports}}]);