(window.webpackJsonp=window.webpackJsonp||[]).push([[75],{619:function(s,a,t){"use strict";t.r(a);var e=t(1),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"插件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#插件"}},[s._v("#")]),s._v(" 插件")]),s._v(" "),t("h2",{attrs:{id:"api"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#api"}},[s._v("#")]),s._v(" API")]),s._v(" "),t("p",[s._v("k8s 为一些底层组件定义了 API 规范，如果一个插件实现了这些 API ，则可以替换默认组件。比如：")]),s._v(" "),t("ul",[t("li",[s._v("容器运行时接口（Container Runtime Interface，CRI）：供 k8s 调用容器运行时，从而管理容器、镜像。\n"),t("ul",[t("li",[s._v("大部分容器运行时并不兼容 CRI ，因此 k8s 还开发了一些 shim 模块，用于将各种容器运行时对接到 CRI 。\n"),t("ul",[t("li",[s._v("后来改为通过 containerd 或 CRI-O 来调用底层的容器运行时。")])])]),s._v(" "),t("li",[s._v("CRI 使得 k8s 与容器运行时解耦，允许 k8s 同时使用多种容器运行时。")])])]),s._v(" "),t("li",[s._v("容器网络接口（Container Network Interface，CNI）：供 k8s 管理容器的网络。")]),s._v(" "),t("li",[s._v("容器存储接口（Container Storage Interface，CSI）：供 k8s 管理容器的存储层。")])]),s._v(" "),t("p",[s._v("常见插件：")]),s._v(" "),t("ul",[t("li",[s._v("kube-dns ：为 k8s 集群提供 DNS 服务。")]),s._v(" "),t("li",[s._v("Kube-router")]),s._v(" "),t("li",[s._v("Flannel ：一个 CNI 插件，比较简单。")]),s._v(" "),t("li",[s._v("Calico ：一个 CNI 插件，比较复杂，功能更多。")]),s._v(" "),t("li",[s._v("Dashboard ：提供 Web UI 。")]),s._v(" "),t("li",[s._v("Federation ：提供跨可用区的集群。\n"),t("ul",[t("li",[s._v("k8s 原本是部署在同一局域网内的主机上，如果部署在跨地域（Region）的不同主机上，则网络延迟会比较大。")])])]),s._v(" "),t("li",[s._v("Fluentd-elasticsearch ：采集、管理 k8s 集群的日志。")])]),s._v(" "),t("h2",{attrs:{id:"helm"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#helm"}},[s._v("#")]),s._v(" Helm")]),s._v(" "),t("p",[s._v("：一个命令行工具，用于管理 k8s 中的应用，相当于高层的包管理工具。")]),s._v(" "),t("ul",[t("li",[s._v("将 k8s 中一个应用的相关配置文件打包成一个 .tgz 文件，称为 Chart 。\n"),t("ul",[t("li",[s._v("charts 可以存储在本机，或者存储到远端仓库。")])])]),s._v(" "),t("li",[s._v("Helm 2.0 采用 C/S 架构。\n"),t("ul",[t("li",[s._v("客户端名为 Helm ，负责管理 charts 。")]),s._v(" "),t("li",[s._v("服务器名为 Tiller ，会将客户端发来的 chart 渲染成 release 文件，然后传给 k8s 的 apiserver 。")])])]),s._v(" "),t("li",[s._v("Helm 3.0 于 2019 年 11 月发布，与 Helm2 不兼容，移除了 Tiller ，成为了一个纯客户端工具。")])]),s._v(" "),t("p",[s._v("命令：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("helm\n    init            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 初始化 Helm（这会创建 Helm 的配置文件、安装 Tiller）")]),s._v("\n    reset           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 卸载 Tiller")]),s._v("\n\n    create "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("dir"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建一个 Chart 目录（会包含一些模板文件）")]),s._v("\n    inspect "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("dir"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看一个 Chart 的详细信息")]),s._v("\n    lint "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("dir"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检查 Chart 的语法")]),s._v("\n    package "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("dir"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将一个 Chart 目录打包，这会生成一个 .tgz 文件")]),s._v("\n    template "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("dir"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("                       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 渲染 Chart 目录中的所有模板")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" release.yml                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将渲染结果保存到一个文件中")]),s._v("\n            -x templates/configmap.yaml  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 只渲染指定模板文件")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将一个 Chart 部署到 k8s")]),s._v("\n    delete "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除 k8s 中的一个 release")]),s._v("\n    status "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示 k8s 中的一个 release 的状态")]),s._v("\n    list            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示 k8s 中的所有 release")]),s._v("\n\n    search "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在 Helm Hub 中查找 Chart")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("h3",{attrs:{id:"制作-chart"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#制作-chart"}},[s._v("#")]),s._v(" 制作 Chart")]),s._v(" "),t("p",[s._v("Chart 的目录结构：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("app/\n├── Chart.yaml          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 描述该 Chart 的信息")]),s._v("\n├── templates/          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 存放该应用的配置文件")]),s._v("\n│   ├── deployment.yaml\n│   └── service.yaml\n├── values.yaml         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用于给 templates 中的变量赋值")]),s._v("\n├── requirements.yaml   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 描述当前 Chart 依赖的其它 Chart")]),s._v("\n├── charts/             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 存放当前 Chart 依赖的其它 Chart")]),s._v("\n├── .helmignore         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 描述打包 Chart 时要忽略的文件")]),s._v("\n├── LICENSE\n└── README.md\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[s._v("Chart.yaml 的示例：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("appVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.0"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("description")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" A Helm chart for Kubernetes\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" redis\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 0.1.0\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("values.yaml 的示例：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("repository")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" myharbor.com/test/redis\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tag")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 5.0.6\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("在 deployment.yaml 中使用 values 的示例：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("template")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ .Values.image.repository }}:{{ .Values.image.tag }}"')]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("...")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])])])}),[],!1,null,null,null);a.default=n.exports}}]);