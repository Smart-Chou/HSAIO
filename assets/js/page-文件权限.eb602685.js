(window.webpackJsonp=window.webpackJsonp||[]).push([[325],{731:function(s,a,t){"use strict";t.r(a);var e=t(1),r=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"文件权限"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#文件权限"}},[s._v("#")]),s._v(" 文件权限")]),s._v(" "),t("p",[s._v("Linux 系统中，文件的访问权限用九个字符表示，例如："),t("code",[s._v("rw- r-- r--")])]),s._v(" "),t("ul",[t("li",[s._v("每三个字符为一组，三组字符分别表示 user（文件所有者）、group（与文件所有者同组的用户）、others（其他用户）对该文件的访问权限。")]),s._v(" "),t("li",[s._v("每组的三个字符分别表示 r、w、x 三种权限。\n"),t("ul",[t("li",[s._v("r ：可读。可以读取文件内容，或查看目录列表。")]),s._v(" "),t("li",[s._v("w ：可写。可以更改文件内容，或在目录下增加、删除、重命名文件。")]),s._v(" "),t("li",[s._v("x ：可执行。可以执行文件，或进入目录。")]),s._v(" "),t("li",[s._v("-：无权限。")])])]),s._v(" "),t("li",[s._v("文件权限也可以用数字表示：将每组的三个字符转换成数字并相加（r、w、x、- 分别对应数字 4、2、1、0），三组权限就可以表示成三个数字。\n"),t("ul",[t("li",[s._v("对应关系如下："),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    ---\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("    --x\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("    -w-\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("    -wx\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("    r--\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("    r-x\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("    rw-\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("    rwx \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])])])])]),s._v(" "),t("li",[s._v("访问权限只能限制普通用户，root 用户有权访问任何文件和目录。")])]),s._v(" "),t("h2",{attrs:{id:"相关命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#相关命令"}},[s._v("#")]),s._v(" 相关命令")]),s._v(" "),t("h3",{attrs:{id:"chmod"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#chmod"}},[s._v("#")]),s._v(" chmod")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("权限"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("path"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改文件的访问权限")]),s._v("\n        -R            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 递归处理（用于处理目录）")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ul",[t("li",[s._v("例："),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("755")]),s._v(" f1      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 相当于 chmod u=rwx,go=rx f1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x f1       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 相当于 chmod a+x f1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" u-w,g+r f1  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# user 去掉 w 权限，group 加上 r 权限")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("a")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("rwx f1    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# a 相当于 ugo")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])])])]),s._v(" "),t("h3",{attrs:{id:"chown"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#chown"}},[s._v("#")]),s._v(" chown")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("user"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("path"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 改变文件所属的用户")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("user"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("group"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("path"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 改变文件所属的用户和用户组")]),s._v("\n        -R                     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 递归处理（用于处理目录）")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"chgrp"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#chgrp"}},[s._v("#")]),s._v(" chgrp")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chgrp")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("group"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("path"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改文件所属的用户组")]),s._v("\n        -R                     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 递归处理（用于处理目录）")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"umask"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#umask"}},[s._v("#")]),s._v(" umask")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("umask")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示 umask 值")]),s._v("\n        027    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置 umask 值")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ul",[t("li",[s._v("当用户新建或拷贝一个文件时，都是该文件的所有者，而该文件的权限 = 初始权限 - umask 。\n"),t("ul",[t("li",[s._v("文件的初始权限为 666 ，目录的初始权限为 777 ，不能修改。")]),s._v(" "),t("li",[s._v("root 用户的 umask 默认为 0022 ，其他用户默认为 0002 。")]),s._v(" "),t("li",[s._v("可以通过修改 umask 的值，改变新建文件、目录时的默认权限。也可以在文件、目录创建之后再修改其权限。")])])]),s._v(" "),t("li",[s._v("例：\n"),t("ul",[t("li",[s._v("umask 为 0022 时，第一位 0 表示特殊权限，后三位 022 表示对默认权限 chmod g-2,o-2 。")]),s._v(" "),t("li",[s._v("假设新建文件时，umask 为 0002 ，则默认权限为 664 ，即 "),t("code",[s._v("rw- rw- r--")]),s._v(" 。")]),s._v(" "),t("li",[s._v("假设新建目录时，umask 为 0002 ，则默认权限为 775 ，即 "),t("code",[s._v("rwx rwx r-x")]),s._v(" 。")])])])]),s._v(" "),t("h2",{attrs:{id:"特殊的文件权限"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#特殊的文件权限"}},[s._v("#")]),s._v(" 特殊的文件权限")]),s._v(" "),t("ul",[t("li",[s._v("SUID ：只能作用于二进制程序，让执行该程序的其它用户临时拥有该程序的 user 权限。\n"),t("ul",[t("li",[s._v("用命令 "),t("code",[s._v("chmod u+s f1")]),s._v(" 可设置 SBIT ，这会将其 user 权限的第三位从 x 改为 s ，或从-改为 S 。")]),s._v(" "),t("li",[s._v("例如：/usr/bin/passwd 文件设置了 SUID ，权限为 rwsr-xr-x ，普通用户在执行 passwd 的过程中，会临时拥有 root 的权限，从而能修改密码。")])])]),s._v(" "),t("li",[s._v("SGID ：作用于二进制程序时，会让执行程序的用户临时拥有该程序的 group 权限；作用于目录时，会让该目录下新增的文件自动继承该目录的 GID 。\n"),t("ul",[t("li",[s._v("用命令 "),t("code",[s._v("chmod g+s f1")]),s._v(" 可设置 SGID ，这会将其 group 权限的第三位从 x 改为 s ，或从-改为 S 。")])])]),s._v(" "),t("li",[s._v("SBIT ：只能作用于目录，让除了目录所有者和 root 用户以外的其它用户都不能删除该目录下的文件。（即使目录权限为 777）\n"),t("ul",[t("li",[s._v("用命令 "),t("code",[s._v("chmod o+t dir1")]),s._v(" 可设置 SBIT ，这会将其 others 权限的第三位从 x 改为 t ，或从-改为 T 。")]),s._v(" "),t("li",[s._v("例如：/tmp 目录设置了 SBIT ，权限为 rwxrwxrwt 。所有用户都可以在这里读、写、创建文件，但非 root 用户只能删除自己的文件。")])])])]),s._v(" "),t("h2",{attrs:{id:"acl"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#acl"}},[s._v("#")]),s._v(" ACL")]),s._v(" "),t("p",[s._v("标准的文件权限只有三种角色，通过访问控制列表（ACL）可以分别控制多个用户的访问权限。")]),s._v(" "),t("h3",{attrs:{id:"setfacl"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#setfacl"}},[s._v("#")]),s._v(" setfacl")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("$ setfacl "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("file"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". \n    -m u:leo:rwx     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改文件的 ACL ，针对某个用户")]),s._v("\n    -m g:root:rwx    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改文件的 ACL ，针对某个用户组")]),s._v("\n    -Rm u:leo:rwx    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 递归修改")]),s._v("\n    -b               "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除文件的 ACL")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"getfacl"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#getfacl"}},[s._v("#")]),s._v(" getfacl")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("$ getfacl "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("file"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示文件的 ACL")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"selinux"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#selinux"}},[s._v("#")]),s._v(" SELinux")]),s._v(" "),t("p",[s._v("：安全增强型 Linux（Security Enhanced Linux），又称为安全上下文（Security Context）")]),s._v(" "),t("ul",[t("li",[s._v("一个内核模块，用于限制各种服务程序的访问权限，可以显著地提升 Linux 系统的安全性。")]),s._v(" "),t("li",[s._v("传统 Linux 系统中，一个进程能否访问某个文件，取决于这个进程是被哪个用户启动的。而使用了 SELinux 之后，即使这个进程是被 root 用户启动的，SELinux 也可以限制它的访问权限。")]),s._v(" "),t("li",[s._v("SELinux 有三种运行模式。\n"),t("ul",[t("li",[s._v("Enforcing ：当服务程序发生越权行为时，强制拦截。")]),s._v(" "),t("li",[s._v("Permissive ：只发出警告，不拦截。")]),s._v(" "),t("li",[s._v("Disabled ：关闭 SELinux 。")])])]),s._v(" "),t("li",[s._v("修改 /etc/selinux/config 文件（重启后生效）中的如下内容，启用 SELinux ："),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("SELINUX=enforcing\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])])]),s._v(" "),t("h3",{attrs:{id:"sestatus"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sestatus"}},[s._v("#")]),s._v(" sestatus")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("$ sestatus      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示 SELinux 的状态")]),s._v("\n        -v      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示进程、目录的安全上下文")]),s._v("\n        -b      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示所有限制策略（Policy booleans）")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"setenforce"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#setenforce"}},[s._v("#")]),s._v(" setenforce")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("$ setenforce         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置 SELinux 的状态（重启后会复原）")]),s._v("\n        Enforcing    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启用")]),s._v("\n        Permissive\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"setsebool"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#setsebool"}},[s._v("#")]),s._v(" setsebool")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("$ setsebool "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" on"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("off  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启或关闭一个服务的 SELinux")]),s._v("\n        -P                 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 永久性地设置（重启后不会复原）")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ul",[t("li",[s._v("例："),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("setsebool httpd_anon_write off\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])])]),s._v(" "),t("h3",{attrs:{id:"semanage"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#semanage"}},[s._v("#")]),s._v(" semanage")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("$ semanage    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 管理一些文件、目录默认的安全上下文")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("进程的违规行为会被记录在日志文件 /var/log/audit/audit.log 中，可以直接查看，也可以安装 setroubleshoot 工具来分析：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("$ sealert -a /var/log/audit/audit.log    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 分析 SELinux 的日志")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])])}),[],!1,null,null,null);a.default=r.exports}}]);