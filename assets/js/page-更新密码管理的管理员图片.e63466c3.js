(window.webpackJsonp=window.webpackJsonp||[]).push([[332],{1065:function(s,n,a){"use strict";a.r(n);var t=a(1),e=Object(t.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("更新很简单，您只需确保保留已安装的卷。如果你在例子中使用了绑定挂载的路径 "),a("RouterLink",{attrs:{to:"/vaultwarden/Container/Starting-a-Container.html"}},[s._v("here")]),s._v("，你只需要"),a("code",[s._v("pull")]),s._v("最新的镜像，"),a("code",[s._v("stop")]),s._v("和"),a("code",[s._v("rm")]),s._v("当前容器，然后启动一个新的一个和以前一样的方式：")],1),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拉取最新版本")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull Vaultwarden/server:latest\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 停止并移除旧容器")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" stop vaultwarden\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" vaultwarden\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动一个挂载数据的新容器")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d --name vaultwarden -v /vw-data/:/data/ -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":80 vaultwarden/server:latest\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("然后访问 "),a("a",{attrs:{href:"http://localhost:80",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://localhost:80"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("如果您没有为持久数据绑定挂载卷，则需要一个中间步骤，使用中间容器保存数据：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拉取最新版本")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull Vaultwarden/server:latest\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建中间容器来保存数据")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run --volumes-from vaultwarden --name vaultwarden_data busybox "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 停止并移除旧容器")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" stop vaultwarden\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" vaultwarden\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动一个挂载数据的新容器")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d --volumes-from vaultwarden_data --name vaultwarden -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":80 vaultwarden/server:latest\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可选地删除中间容器")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" vaultwarden_data\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 或者，您可以保留数据容器以备将来更新，在这种情况下，您可以跳过最后一步。")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("p",[s._v("您还可以使用 "),a("a",{attrs:{href:"https://containrrr.dev/watchtower/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Watchtower"),a("OutboundLink")],1),s._v(" 之类的工具来自动执行更新过程。 Watchtower 可以定期检查 Docker 镜像的更新，拉取更新的镜像，并使用更新的镜像重新创建容器。")]),s._v(" "),a("h2",{attrs:{id:"使用-docker-compose-时更新"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-docker-compose-时更新"}},[s._v("#")]),s._v(" 使用 docker-compose 时更新")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" stop\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" pull\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" start\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h2",{attrs:{id:"使用-systemd-服务时更新-在本例中为-debian-raspbian"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-systemd-服务时更新-在本例中为-debian-raspbian"}},[s._v("#")]),s._v(" 使用 systemd 服务时更新(在本例中为 Debian/Raspbian)")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl restart vaultwarden.service\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" system prune -f\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# WARNING 这可能会删除与 Vaultwarden 无关的已停止或未使用的容器等")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 小心，看看你需要哪些容器")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -a\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#显示停止的容器")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 警告！这将删除：")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   - 所有停止的#容器")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   - 至少一个容器未使用的所有网络")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   - 所有悬空镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   - 所有悬空构建缓存")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#你可以列出docker镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" images\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#在那里你会看到所有未使用的镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("p",[s._v("restart 命令将停止容器，拉取最新的镜像，再次运行容器。\nprune 命令将删除现在的旧容器(-f 代表：不要求确认)。")]),s._v(" "),a("p",[s._v("如果需要，将这些放入 cronjob 中(时间可以更改)：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("crontab")]),s._v(" -e\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" * * * "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl restart vaultwarden.service\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" * * * "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" /usr/bin/docker system prune -f\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("使用命令")]),s._v(" "),a("p",[a("code",[s._v("which docker")]),s._v("：如果"),a("code",[s._v("/usr/bin/docker")]),s._v(" 不是docker的正确路径")])])}),[],!1,null,null,null);n.default=e.exports}}]);