(window.webpackJsonp=window.webpackJsonp||[]).push([[337],{1069:function(s,e,t){"use strict";t.r(e);var a=t(1),r=Object(a.a)({},(function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("此页面主要面向对 Vaultwarden 开发感兴趣或有特定原因想要构建自己的二进制文件的人。")]),s._v(" "),t("p",[s._v("典型用户应该从基于 Alpine 的 Docker 镜像中"),t("RouterLink",{attrs:{to:"/vaultwarden/Container/Which-container-image-to-use.html"}},[s._v("使用哪个容器镜像")]),s._v("、"),t("RouterLink",{attrs:{to:"/vaultwarden/Deployment/Pre-built-binaries.html"}},[s._v("预建二进制文件")]),s._v("，或者寻找 "),t("RouterLink",{attrs:{to:"/vaultwarden/Deployment/Third-party-packages.html"}},[s._v("第三方包")]),s._v("。")],1),s._v(" "),t("h2",{attrs:{id:"依赖"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#依赖"}},[s._v("#")]),s._v(" 依赖")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("Rust nightly")]),s._v("(强烈推荐使用 "),t("a",{attrs:{href:"https://rustup.rs",target:"_blank",rel:"noopener noreferrer"}},[s._v("rustup"),t("OutboundLink")],1),s._v(")")]),s._v(" "),t("li",[s._v("在基于 Debian 的发行版上，一些通用软件包可确保构建正常进行，请安装以下内容："),t("code",[s._v("build-essential")]),s._v("、"),t("code",[s._v("git")])]),s._v(" "),t("li",[t("code",[s._v("OpenSSL")]),s._v("(应该在路径中可用，参见 "),t("a",{attrs:{href:"https://docs.rs/openssl/0.10.16/openssl/#automatic",target:"_blank",rel:"noopener noreferrer"}},[s._v("openssl crate docs"),t("OutboundLink")],1),s._v(") 在基于 Debian 的发行版上，您需要安装 "),t("code",[s._v("pkg-config")]),s._v(" 和 "),t("code",[s._v("libssl-dev")])]),s._v(" "),t("li",[s._v("对于基于 Debian 的发行版上的 SQlite3 后端，您需要安装 "),t("code",[s._v("libsqlite3-dev")])]),s._v(" "),t("li",[s._v("对于基于 Debian 的发行版上的 MySQL 后端，您需要安装 "),t("code",[s._v("libmariadb-dev-compat")]),s._v(" 和 "),t("code",[s._v("libmariadb-dev")])]),s._v(" "),t("li",[s._v("对于基于 Debian 的发行版上的 PostgreSQL，您需要安装 "),t("code",[s._v("libpq-dev")]),s._v(" 和 "),t("code",[s._v("pkg-config")])]),s._v(" "),t("li",[t("code",[s._v("NodeJS")]),s._v("(仅在编译 web-vault 时，通过系统的包管理器安装，使用 "),t("a",{attrs:{href:"https://nodejs.org/en/download/",target:"_blank",rel:"noopener noreferrer"}},[s._v("预构建的二进制文件"),t("OutboundLink")],1),s._v(")或 "),t("a",{attrs:{href:"https://github.com/nodesource/distributions",target:"_blank",rel:"noopener noreferrer"}},[s._v("nodesource binary distribution"),t("OutboundLink")],1),s._v(" "),t("em",[s._v("注意：web-vault 当前使用需要 NodeJS v11")]),s._v(" 的软件包基础(例如 node-sass < v4.12)")])]),s._v(" "),t("h2",{attrs:{id:"运行-编译"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#运行-编译"}},[s._v("#")]),s._v(" 运行/编译")]),s._v(" "),t("h3",{attrs:{id:"所有后端"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#所有后端"}},[s._v("#")]),s._v(" 所有后端")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编译所有后端并运行")]),s._v("\ncargo run --features sqlite,mysql,postgresql --release\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 或者只编译所有后端(二进制文件位于 target/release/vaultwarden)")]),s._v("\ncargo build --features sqlite,mysql,postgresql --release\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"sqlite-后端"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sqlite-后端"}},[s._v("#")]),s._v(" SQlite 后端")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用sqlite后端编译并运行")]),s._v("\ncargo run --features sqlite --release\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 或者直接用 sqlite 编译(二进制文件位于 target/release/vaultwarden)")]),s._v("\ncargo build --features sqlite --release\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"mysql-后端"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysql-后端"}},[s._v("#")]),s._v(" MySQL 后端")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用mysql后端编译并运行")]),s._v("\ncargo run --features mysql --release\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 或者直接用 mysql 编译(二进制文件位于 target/release/vaultwarden)")]),s._v("\ncargo build --features mysql --release\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"postgresql-后端"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#postgresql-后端"}},[s._v("#")]),s._v(" PostgreSQL 后端")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用 postgresql 后端编译并运行")]),s._v("\ncargo run --features postgresql --release\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 或者只用 postgresql 编译(二进制文件位于 target/release/vaultwarden)")]),s._v("\ncargo build --features postgresql --release\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("运行时，服务器可以在 "),t("a",{attrs:{href:"http://localhost:8000",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://localhost:8000"),t("OutboundLink")],1),s._v(" 中访问。")]),s._v(" "),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),t("p",[s._v("之前的"),t("a",{attrs:{href:"https://github.com/rust-lang/rust/issues/62896",target:"_blank",rel:"noopener noreferrer"}},[s._v("issue"),t("OutboundLink")],1),s._v("意味着由于 Rust 编译器和 LLVM 之间的不兼容，编译可能会因段错误而失败。可以使用旧版本的编译器作为解决方法，例如")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("cargo +nightly-2019-08-27 build --features yourbackend --release\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])]),s._v(" "),t("h3",{attrs:{id:"安装网络密码管理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装网络密码管理"}},[s._v("#")]),s._v(" 安装网络密码管理")]),s._v(" "),t("p",[s._v("Web Vault 的编译版本可以从 "),t("a",{attrs:{href:"https://github.com/dani-garcia/bw_web_builds/releases",target:"_blank",rel:"noopener noreferrer"}},[s._v("dani-garcia/bw_web_builds"),t("OutboundLink")],1),s._v(" 下载。")]),s._v(" "),t("p",[s._v("如果您更喜欢手动编译它，请按照下列步骤操作：")]),s._v(" "),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),t("p",[s._v("构建 Vault 需要 1.5GB 的 RAM。在 RaspberryPI 等 1GB 或更少的系统上，请"),t("a",{attrs:{href:"https://www.tecmint.com/create-a-linux-swap-file/",target:"_blank",rel:"noopener noreferrer"}},[s._v("启用交换"),t("OutboundLink")],1),s._v("或在更强大的机器上构建它并从那里。如此多的内存仅用于构建它，使用 Vault 运行 Vaultwarden 只需要大约 10MB 的 RAM。")])]),s._v(" "),t("ul",[t("li",[s._v("在 "),t("a",{attrs:{href:"https://github.com/bitwarden/web",target:"_blank",rel:"noopener noreferrer"}},[s._v("bitwarden/web"),t("OutboundLink")],1),s._v(" 克隆 git 存储库并签出最新的发布标签(例如 v2.1.1)：")])]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 克隆存储库")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://github.com/bitwarden/web.git web-vault\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" web-vault\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 切换到最新的标签")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" checkout "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" tag --sort"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("v:refname "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" -n1"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v('"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用匹配的 jslib 提交")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" submodule update --init --recursive\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("ul",[t("li",[s._v("从 "),t("a",{attrs:{href:"https://github.com/dani-garcia/bw_web_builds/tree/master/patches",target:"_blank",rel:"noopener noreferrer"}},[s._v("dani-garcia/bw_web_builds"),t("OutboundLink")],1),s._v(" 下载补丁文件并将其复制到"),t("code",[s._v("web-vault")]),s._v(" 文件夹。 要选择要使用的版本，假设 Web Vault 是版本 "),t("code",[s._v("vX.Y.Z")]),s._v("：\n"),t("ul",[t("li",[s._v("如果有版本为 "),t("code",[s._v("vX.Y.Z")]),s._v(" 的补丁，请使用那个补丁")]),s._v(" "),t("li",[s._v("否则，选择版本最大但仍然小于 "),t("code",[s._v("vX.Y.Z")]),s._v(" 的那个")])])]),s._v(" "),t("li",[s._v("应用补丁")])]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在`网络密码管理`目录中")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" apply vX.Y.Z.patch\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ul",[t("li",[s._v("然后，构建 Vault：")])]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 阅读下面的注释(我们确实将它用于我们的 docker 构建)。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# npm 审计修复")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" run dist\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),t("p",[s._v("您可能会被要求运行 "),t("code",[s._v("npm audit fix")]),s._v(" 来修复漏洞。这将自动尝试将软件包升级到较新版本，这可能不兼容并破坏网络密码管理功能。 如果您知道自己在做什么，请自担风险使用它。顺便说一句，我们确实在我们自己的版本中使用了它！")])]),s._v(" "),t("p",[s._v("最后将"),t("code",[s._v("build")]),s._v("文件夹的内容复制到目标文件夹中：")]),s._v(" "),t("ul",[t("li",[s._v("如果你用 "),t("code",[s._v("cargo run --release")]),s._v(" 运行，它是 "),t("code",[s._v("vaultwarden/web-vault")]),s._v("。")]),s._v(" "),t("li",[s._v("如果你直接运行编译好的二进制文件，它就在二进制文件的旁边，在 "),t("code",[s._v("vaultwarden/target/release/web-vault")]),s._v(" 中。")])]),s._v(" "),t("h2",{attrs:{id:"配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[s._v("#")]),s._v(" 配置")]),s._v(" "),t("p",[s._v("可用的配置选项记录在默认的 "),t("code",[s._v(".env")]),s._v(" 文件中，可以通过取消对该文件中所需选项的注释或设置它们各自的环境变量来修改它们。有关可用的主要配置选项，请参阅此 wiki 的配置部分。")]),s._v(" "),t("p",[s._v("注意：环境变量会覆盖在 "),t("code",[s._v(".env")]),s._v(" 文件中设置的值。")]),s._v(" "),t("h2",{attrs:{id:"更多部署信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#更多部署信息"}},[s._v("#")]),s._v(" 更多部署信息")]),s._v(" "),t("ul",[t("li",[t("RouterLink",{attrs:{to:"/vaultwarden/Deployment/Proxy-examples.html"}},[s._v("配置你的反向代理")])],1),s._v(" "),t("li",[t("RouterLink",{attrs:{to:"/vaultwarden/Configuration/Setup-as-a-systemd-service.html"}},[s._v("通过 systemd 设置自动启动")])],1)]),s._v(" "),t("h2",{attrs:{id:"如何为-sqlite-后端重新创建数据库模式-对于开发人员"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#如何为-sqlite-后端重新创建数据库模式-对于开发人员"}},[s._v("#")]),s._v(" 如何为 sqlite 后端重新创建数据库模式(对于开发人员)")]),s._v(" "),t("p",[s._v("安装带有货物的diesel-cli：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("cargo "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" diesel_cli --no-default-features --features sqlite-bundled\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("确保数据库的正确路径在 "),t("code",[s._v(".env")]),s._v(" 文件中。")]),s._v(" "),t("p",[s._v("如果要修改架构，请使用以下命令创建新迁移：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("diesel migration generate "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("修改 *.sql 文件，确保在 down.sql 文件中恢复任何更改。")]),s._v(" "),t("p",[s._v("应用迁移并保存生成的模式，如下所示：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("diesel migration redo\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这一步应该在使用diesel-cli > 1.3.0 时自动完成")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 柴油打印模式> src/db/sqlite/schema.rs")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h2",{attrs:{id:"如何从-sqlite-后端迁移到-mysql-后端-针对开发人员"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#如何从-sqlite-后端迁移到-mysql-后端-针对开发人员"}},[s._v("#")]),s._v(" 如何从 SQLite 后端迁移到 MySQL 后端(针对开发人员)")]),s._v(" "),t("p",[s._v("如果您想从 SQLite 迁移，请参阅"),t("RouterLink",{attrs:{to:"/vaultwarden/Configuration/Using-the-MariaDB-Backend.html"}},[s._v("使用 MySQL 后端")]),s._v("。")],1),s._v(" "),t("h2",{attrs:{id:"如何从-sqlite-后端迁移到-postgresql-后端-针对开发人员"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#如何从-sqlite-后端迁移到-postgresql-后端-针对开发人员"}},[s._v("#")]),s._v(" 如何从 SQLite 后端迁移到 PostgreSQL 后端(针对开发人员)")]),s._v(" "),t("p",[s._v("如果要从 SQLite 迁移，请参阅"),t("RouterLink",{attrs:{to:"/vaultwarden/Configuration/Using-the-PostgreSQL-Backend.html"}},[s._v("使用 PostgreSQL 后端")]),s._v("。")],1)])}),[],!1,null,null,null);e.default=r.exports}}]);