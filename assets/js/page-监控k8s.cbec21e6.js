(window.webpackJsonp=window.webpackJsonp||[]).push([[354],{687:function(s,t,a){"use strict";a.r(t);var e=a(1),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"监控-k8s"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#监控-k8s"}},[s._v("#")]),s._v(" 监控 k8s")]),s._v(" "),a("ul",[a("li",[s._v("k8s 的 apiserver、kubelet 等组件本身集成了 exporter 格式的 API 。")]),s._v(" "),a("li",[s._v("用户也可部署额外的 exporter 服务：\n"),a("ul",[a("li",[s._v("cAdvisor ：kubelet 已经集成了 cadvisor ，可通过 /metrics/cadvisor 路径访问。")]),s._v(" "),a("li",[s._v("Heapster ：已淘汰。")]),s._v(" "),a("li",[s._v("metrics-server ：借鉴了 Heapster ，从 apiserver 获取 CPU、内存使用率等指标，供 HPA 调用。")]),s._v(" "),a("li",[s._v("kube-state-metrics ：从 apiserver 获取 node、pod 等资源的状态，生成 Metrics 。")])])]),s._v(" "),a("li",[s._v("相关工具：\n"),a("ul",[a("li",[s._v("Prometheus Operator ：用于在 k8s 中自动安装 Prometheus、Alertmanager、node_exporter 堆栈。")]),s._v(" "),a("li",[s._v("kube-prometheus ：调用 Prometheus Operator ，还会安装 kube-state-metrics、Grafana 。")])])])]),s._v(" "),a("h2",{attrs:{id:"集成指标"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#集成指标"}},[s._v("#")]),s._v(" 集成指标")]),s._v(" "),a("h3",{attrs:{id:"配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[s._v("#")]),s._v(" 配置")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("用 Prometheus 监控 k8s 时，需要在 k8s 中创建一个 RBAC 角色，参考 "),a("a",{attrs:{href:"https://github.com/prometheus/prometheus/blob/main/documentation/examples/rbac-setup.yml",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方配置"),a("OutboundLink")],1),s._v(" 。")]),s._v(" "),a("ul",[a("li",[s._v("建议采用 "),a("code",[s._v("namespace: kube-system")]),s._v(" 。")]),s._v(" "),a("li",[s._v("然后获取 ServiceAccount 对应的 secret 中的 ca.crt 和 token ："),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("secret")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("kubectl get secrets -n kube-system "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" prometheus-token "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print $1}'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\nkubectl get secrets -n kube-system "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$secret")]),s._v(" -o yaml "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" yq "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'.data.token'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" base64 -d "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" token\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),s._v("尝试访问 API ："),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" https://apiserver/metrics -H "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Authorization: Bearer '),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" token"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v('"')]),s._v(" -k\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])])]),s._v(" "),a("li",[a("p",[s._v("在 prometheus.yml 中添加配置：")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("scrape_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("job_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" k8s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("apiserver\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kubernetes_sd_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从 k8s 的 HTTP API 发现配置")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("role")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" endpoints             "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将每个 service endpoints 作为 target")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("api_server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" https"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//apiserver\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("authorization")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("credentials_file")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /var/run/secrets/kubernetes.io/serviceaccount/token\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tls_config")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("insecure_skip_verify")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# namespaces:               # 要监控的 namespace ，默认监控所有 namespace")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   names:")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   - default")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - role: pod                 # 将 pod_ip:expose_port 作为 target")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - role: service             # 将 service_ip:expose_port 作为 target")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - role: ingress             # 将每个 ingress path 作为 target")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通过 kubernetes_sd_configs 获取 target 之后，以下配置用于采集这些 target")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("scheme")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" https\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("authorization")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("credentials_file")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /var/run/secrets/kubernetes.io/serviceaccount/token\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tls_config")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("insecure_skip_verify")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("relabel_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 每个 target 有一些元数据标签 __meta* ，Prometheus 采集之后不会保存")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("action")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" keep                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 根据标签筛选 target ，保留匹配的 target ，丢弃其它 target")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("source_labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        __meta_kubernetes_namespace"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        __meta_kubernetes_service_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        __meta_kubernetes_endpoint_port_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("regex")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" default;kubernetes;https\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - action: replace             # 将 __meta* 标签重命名，从而被 Prometheus 保存")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   source_labels: [__meta_kubernetes_pod_ip]")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   target_label: pod_ip")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("job_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" k8s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("node\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kubernetes_sd_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("role")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" node                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将 node_ip:kubelet_port 作为 target")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("api_server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" https"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//apiserver\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("authorization")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("credentials_file")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /var/run/secrets/kubernetes.io/serviceaccount/token\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tls_config")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("insecure_skip_verify")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("scheme")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" https\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("authorization")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("credentials_file")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /var/run/secrets/kubernetes.io/serviceaccount/token\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tls_config")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("insecure_skip_verify")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("job_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" k8s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cadvisor\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kubernetes_sd_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("role")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" node                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将 node_ip:kubelet_port 作为 target")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("api_server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" https"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//apiserver\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("authorization")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("credentials_file")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /var/run/secrets/kubernetes.io/serviceaccount/token\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tls_config")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("insecure_skip_verify")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("scheme")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" https\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metrics_path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /metrics/cadvisor\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("authorization")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("credentials_file")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /var/run/secrets/kubernetes.io/serviceaccount/token\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tls_config")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("insecure_skip_verify")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br")])])])]),s._v(" "),a("h3",{attrs:{id:"指标"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#指标"}},[s._v("#")]),s._v(" 指标")]),s._v(" "),a("ul",[a("li",[s._v("指标示例："),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关于 apiserver")]),s._v("\napiserver_request_duration_seconds_count      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 各种 HTTP 请求的次数")]),s._v("\napiserver_request_duration_seconds_sum        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 各种 HTTP 请求的耗时")]),s._v("\netcd_request_duration_seconds_count\netcd_request_duration_seconds_sum\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关于 kubelet")]),s._v("\nkubernetes_build_info                                                     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# k8s 版本信息")]),s._v("\nkubelet_node_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("job"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k8s-node"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("instance")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.0.0.1"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("node")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.0.0.1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通过 node 标签记录该 kubelet 所在的 node ip")]),s._v("\nkubelet_evictions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("eviction_signal"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xx"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("                                   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发出的各种驱逐 pod 信号的次数")]),s._v("\nkubelet_http_requests_total                                               "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 各种 HTTP 请求的次数")]),s._v("\nkubelet_http_requests_duration_seconds_sum\nkubelet_pleg_relist_duration_seconds_count                                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# PLEG relist 的次数")]),s._v("\nkubelet_pleg_relist_duration_seconds_sum\nkubelet_runtime_operations_duration_seconds_count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("operation_type"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xx"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 各种操作的次数")]),s._v("\nkubelet_runtime_operations_duration_seconds_sum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("operation_type"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xx"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nkubelet_runtime_operations_errors_total"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("operation_type"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xx"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 各种操作出错的次数")]),s._v("\nkubelet_running_pod_count\nkubelet_running_container_count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("container_state"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xx"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nkubelet_container_log_filesystem_used_bytes                               "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 每个 container 的日志占用的磁盘空间")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关于 cadvisor 的指标略")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])])])]),s._v(" "),a("h2",{attrs:{id:"kube-state-metrics"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kube-state-metrics"}},[s._v("#")]),s._v(" kube-state-metrics")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/kubernetes/kube-state-metrics",target:"_blank",rel:"noopener noreferrer"}},[s._v("GitHub"),a("OutboundLink")],1)])]),s._v(" "),a("h3",{attrs:{id:"部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署"}},[s._v("#")]),s._v(" 部署")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("用官方配置文件部署：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.2")]),s._v(".4\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://github.com/kubernetes/kube-state-metrics/archive/refs/tags/v"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${version}")]),s._v(".tar.gz\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -xf "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("v")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${version}")]),s._v(".tar.gz\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" kube-state-metrics-"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${version}")]),s._v("/examples/standard\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s#image: .*#image: bitnami/kube-state-metrics:'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${version}")]),s._v('#g"')]),s._v(" deployment.yaml\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s#clusterIP: None##g'")]),s._v(" service.yaml\nkubectl apply -f "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("启动命令：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("kube-state-metrics\n    --host"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("::\n    --port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("                   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# metrics 端口")]),s._v("\n    --telemetry-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8081")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在该端口暴露 kube-state-metrics 自身的指标")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --namespaces ''             # 监控的命名空间，默认监控所有")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --namespaces-denylist ''    # 不监控的命名空间")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --resources configmaps,cronjobs,daemonsets,deployments,...  # 监控哪几种资源，默认监控所有")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --metric-annotations-allowlist namespaces=[kubernetes.io/*,...],pods=[*]  # 将哪些资源的哪些 annotations 加入监控指标，默认禁用")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --metric-labels-allowlist pods=[k8s-app,...] # 将哪些资源的哪些 labels 加入监控指标，默认禁用")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("在 prometheus.yml 中添加配置：")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("job_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" kube"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("metrics\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("static_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" kube"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("metrics"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])])])]),s._v(" "),a("h3",{attrs:{id:"指标-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#指标-2"}},[s._v("#")]),s._v(" 指标")]),s._v(" "),a("ul",[a("li",[s._v("指标示例："),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 几种资源都存在的指标")]),s._v("\n*_created                       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 资源的创建时间，取值为 Unix 时间戳")]),s._v("\n*_metadata_resource_version     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 资源的 resourceVersion")]),s._v("\n*_annotations\n*_labels\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 各种资源")]),s._v("\nkube_node_spec_unschedulable    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Node 是否不可调度")]),s._v("\nkube_node_status_condition"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("condition"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xx"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("status")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否处于某种状态")]),s._v("\nkube_node_status_allocatable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("resource"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cpu"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("unit")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"core"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# node 各种资源的容量")]),s._v("\n\nkube_pod_info\nkube_pod_owner"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("owner_kind"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ReplicaSet"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("owner_name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xx"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 父资源")]),s._v("\nkube_pod_status_scheduled"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("condition"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Pod 是否已被调度")]),s._v("\nkube_pod_status_scheduled_time              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Pod 被调度的时刻")]),s._v("\nkube_pod_start_time\nkube_pod_completion_time\nkube_pod_status_phase"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("phase"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xx"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Pod 是否处于某个生命周期")]),s._v("\nkube_pod_status_ready"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("condition"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Pod 是否就绪")]),s._v("\nkube_pod_status_reason"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("reason"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xx"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Pod 处于当前状态的原因")]),s._v("\n\nkube_pod_container_info"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("pod"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xx"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("container")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xx"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xx"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Pod 中容器信息")]),s._v("\nkube_pod_container_resource_requests"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("resource"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cpu"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("unit")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"core"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Pod 中容器的资源需求")]),s._v("\nkube_pod_container_resource_limits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("resource"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cpu"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("unit")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"core"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Pod 中容器的资源限制")]),s._v("\nkube_pod_container_state_started            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Pod 中容器的启动时刻")]),s._v("\nkube_pod_container_status_running           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Pod 中容器是否处于 Running 状态")]),s._v("\nkube_pod_container_status_ready             "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Pod 中容器是否就绪，即通过 readinessProbe 探针")]),s._v("\nkube_pod_container_status_restarts_total    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Pod 中容器的重启次数")]),s._v("\n\nkube_deployment_spec_replicas               "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 期待运行的实例数")]),s._v("\nkube_deployment_status_replicas_available   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 实际可用的实例数")]),s._v("\nkube_deployment_status_replicas_updated     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 最新版本的实例数")]),s._v("\nkube_deployment_status_condition"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("condition"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xx"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("status")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否处于某种状态")]),s._v("\n\nkube_statefulset_replicas                   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 期待运行的实例数")]),s._v("\nkube_statefulset_status_replicas_available  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 实际可用的实例数")]),s._v("\nkube_statefulset_status_replicas_updated    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 最新版本的实例数")]),s._v("\n\nkube_daemonset_status_desired_number_scheduled    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 期待运行的实例数")]),s._v("\nkube_daemonset_status_number_available            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 实际可用的实例数")]),s._v("\n\nkube_job_owner"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("owner_kind"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CronJob"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("owner_name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xx"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 父资源")]),s._v("\nkube_job_complete"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("condition"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否结束执行")]),s._v("\nkube_job_failed"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("condition"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 结果是否失败")]),s._v("\nkube_job_status_start_time                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开始时刻")]),s._v("\nkube_job_status_completion_time             "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 结束时刻")]),s._v("\nkube_job_status_active                      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 正在运行的 Pod 实例数")]),s._v("\n\nkube_cronjob_status_last_schedule_time      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 上次触发的时刻")]),s._v("\nkube_cronjob_status_active                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 正在运行的 Pod 实例数")]),s._v("\n\nkube_endpoint_address_available             "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可用的 endpoint 数量")]),s._v("\nkube_endpoint_address_not_ready             "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 不可用的 endpoint 数量")]),s._v("\n\nkube_service_info\nkube_service_spec_type\nkube_service_status_load_balancer_ingress\n\nkube_horizontalpodautoscaler_status_current_replicas\nkube_horizontalpodautoscaler_status_desired_replicas\nkube_horizontalpodautoscaler_spec_min_replicas\nkube_horizontalpodautoscaler_spec_max_replicas\nkube_horizontalpodautoscaler_status_condition\nkube_horizontalpodautoscaler_spec_target_metric"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("metric_name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k8s_pod_mem_usage_bytes"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("metric_target_type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"average"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br")])])])])])}),[],!1,null,null,null);t.default=n.exports}}]);