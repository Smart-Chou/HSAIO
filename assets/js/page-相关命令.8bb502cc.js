(window.webpackJsonp=window.webpackJsonp||[]).push([[356],{861:function(s,a,t){"use strict";t.r(a);var n=t(1),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"相关命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#相关命令"}},[s._v("#")]),s._v(" 相关命令")]),s._v(" "),t("h2",{attrs:{id:"htpasswd"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#htpasswd"}},[s._v("#")]),s._v(" htpasswd")]),s._v(" "),t("p",[s._v("：Apache 提供的一个命令行工具，用于生成密码的哈希值。")]),s._v(" "),t("ul",[t("li",[s._v("安装："),t("code",[s._v("yum install httpd-tools")])]),s._v(" "),t("li",[s._v("用法："),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("htpasswd "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("file"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("username"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("password"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        -d                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 采用 CRYPT 算法")]),s._v("\n        -B                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 采用 BCRYPT 算法")]),s._v("\n        -m                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 采用 MD5 算法（默认）")]),s._v("\n        -s                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 采用 SHA-1 算法")]),s._v("\n        -2                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 采用 SHA-256 算法")]),s._v("\n        -5                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 采用 SHA-512 算法")]),s._v("\n\n        -c                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建加密文件，如果该文件已存在则会被覆盖")]),s._v("\n        -D  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("username"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从文件中删除一个用户")]),s._v("\n        -v  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("username"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 验证一个用户的密码")]),s._v("\n\n        -b "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("password"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通过命令参数输入明文密码")]),s._v("\n        -i                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从 stdin 读取密码")]),s._v("\n        -n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将加密结果输出到 stdout ，而不是文件")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])])]),s._v(" "),t("li",[s._v("例："),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@CentOS ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# htpasswd -nb leo 123456            # 生成密码的哈希值")]),s._v("\nleo:"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$apr1")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$mUtPb9mo")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$xCZajWWbJ3v42Bxu3WKFi")]),s._v("/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@CentOS ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# htpasswd -cb  ./passwd leo 123456  # 创建密码文件，添加一个用户及其密码")]),s._v("\nAdding password "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" user leo\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@CentOS ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# htpasswd -b   ./passwd leo 1234    # 再添加一个用户及其密码。如果该用户名已存在，则会覆盖其密码")]),s._v("\nUpdating password "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" user leo\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@CentOS ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# htpasswd      ./passwd admin       # 再添加一个用户，默认通过终端提示输入密码")]),s._v("\nNew password:\nRe-type new password:\nAdding password "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" user admin\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@CentOS ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat passwd                         # 查看密码文件")]),s._v("\nleo:"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$apr1")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$UjGpt1b7")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$aEIT6s")]),s._v(".Kh/KMyjJ/z.men0\nadmin:"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$apr1")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$cF7RBJdh")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$FGmchgxnb0gXV6GeY8PGH")]),s._v("/\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@CentOS ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# htpasswd -D   ./passwd leo         # 删除一个用户")]),s._v("\nDeleting password "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" user leo\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])])])]),s._v(" "),t("h2",{attrs:{id:"openssl"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#openssl"}},[s._v("#")]),s._v(" OpenSSL")]),s._v(" "),t("p",[s._v("：一个关于 SSL 的开源工具包。")]),s._v(" "),t("ul",[t("li",[s._v("常用于生成 SSL 证书，或被客户端、服务器用于 SSL 握手。")]),s._v(" "),t("li",[s._v("例：生成 SSL 私钥和自签名证书"),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("openssl\n        req -x509           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 生成自签名的数字证书，采用 X.509 标准")]),s._v("\n        -days "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("365")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 证书的有效期")]),s._v("\n        -newkey rsa:2048    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用新生成的密钥")]),s._v("\n        -nodes              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# no DES ，生成 key 文件时不加密")]),s._v("\n        -keyout cert.key    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 保存私钥到指定文件")]),s._v("\n        -out cert.crt       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 保存证书到指定文件")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("ul",[t("li",[s._v("浏览器通常不会承认自签名证书，会警告该网站不安全。")])])])]),s._v(" "),t("h2",{attrs:{id:"acme"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#acme"}},[s._v("#")]),s._v(" ACME")]),s._v(" "),t("ul",[t("li",[s._v("letsencrypt.org ：一个 CA 网站，可以免费申请数字证书。")]),s._v(" "),t("li",[s._v("ACME（Automatic Certificate Management Environment）：一个网络协议，用于向 CA 申请、续订、撤销证书。\n"),t("ul",[t("li",[s._v("最初是为 letsencrypt.org 设计的，后来也支持其它 CA 。")]),s._v(" "),t("li",[s._v("2016 年发布 API v1 。")]),s._v(" "),t("li",[s._v("2018 年发布 API v2 ，支持通配符域名。")])])])]),s._v(" "),t("h3",{attrs:{id:"certbot"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#certbot"}},[s._v("#")]),s._v(" Certbot")]),s._v(" "),t("p",[s._v("：一个命令行工具，作为 ACME 客户端。")]),s._v(" "),t("ul",[t("li",[t("p",[t("a",{attrs:{href:"https://github.com/certbot/certbot",target:"_blank",rel:"noopener noreferrer"}},[s._v("GitHub"),t("OutboundLink")],1)])]),s._v(" "),t("li",[t("p",[s._v("用户需要证明自己对域名拥有控制权，该过程称为 challenge ，主要有两种方式：")]),s._v(" "),t("ul",[t("li",[s._v("HTTP ：将域名绑定到一个网站，监听 80 端口，并在 URL "),t("code",[s._v("/.well-known/acme-challenge/")]),s._v(" 下提供一个指定文件。")]),s._v(" "),t("li",[s._v("DNS ：添加一个 TXT 类型的 DNS 记录，将子域名 "),t("code",[s._v("_acme-challenge.<domain>")]),s._v(" 解析到指定字符串。\n"),t("ul",[t("li",[s._v("使用 DNS 插件时，会调用 DNS 服务器的 API ，从而自动进行验证。")]),s._v(" "),t("li",[s._v("通配符域名只能通过 DNS 方式申请证书。")])])])])]),s._v(" "),t("li",[t("p",[s._v("证书的有效期默认为 90 天。")]),s._v(" "),t("ul",[t("li",[s._v("为了刷新有效期，可以重新创建证书，或续订。")]),s._v(" "),t("li",[s._v("通过 --manual 方式申请的证书，不能自动续订，需要重新申请。")])])]),s._v(" "),t("li",[t("p",[s._v("命令：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("certbot\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 申请证书")]),s._v("\n        run                 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认执行该操作，会自动申请证书并安装")]),s._v("\n        certonly            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 只是获取证书，保存到本机，不会安装")]),s._v("\n        -d "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("domain"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定要申请证书的域名。可以多次使用该选项，指定多个域名")]),s._v("\n        --email "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("xx"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 填写申请人的 email")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 证明域名控制权的几种方式")]),s._v("\n        --nginx             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发现本机的 Nginx 服务器，自动修改配置文件，进行验证")]),s._v("\n        --standalone        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 运行一个简单的 HTTP 服务器。这需要暂时停止原网站")]),s._v("\n        --webroot -w /www/  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定网站的静态目录，自动创建验证文件")]),s._v("\n        --manual --preferred-challenges"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("dns  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 手动添加 DNS 记录")]),s._v("\n        --dns-goole         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 调用 Goole 云平台的 DNS 插件")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关于 certbot 的配置")]),s._v("\n        --dry-run           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 向 CA 测试服务器发出请求，从而模拟执行命令")]),s._v("\n        --config-dir  /etc/letsencrypt\n\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 其它操作")]),s._v("\n        certificates        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出本机存放的证书")]),s._v("\n        renew               "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 续订有效期不足 30 天的所有证书")]),s._v("\n        revoke              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 撤销证书")]),s._v("\n        delete              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除本机存放的证书")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("例：")]),s._v(" "),t("ol",[t("li",[s._v("使用 Nginx 部署网站，在配置文件中加入一个路由："),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("location /.well-known/acme-challenge/ "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    root  /certbot/www"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])])]),s._v(" "),t("li",[s._v("运行 Certbot 的 Docker 镜像："),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -it --rm "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -v "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PWD")]),s._v("/certbot/www:/www "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -v "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PWD")]),s._v("/certbot/etc:/etc/letsencrypt "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    certbot/certbot:v1.20.0 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    certonly --webroot -w /www -d test.com --email xxx\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("ul",[t("li",[s._v("申请的证书会保存在配置目录下。")])])]),s._v(" "),t("li",[s._v("修改 Nginx 配置，使用证书，提供 HTTPS 服务："),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("server "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    listen    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("  ssl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    ssl_certificate /certbot/etc/fullchain.pem"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    ssl_certificate_key /certbot/etc/privkey.pem"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("ul",[t("li",[s._v("当证书文件变化时，需要执行 nginx -s reload 。")])])]),s._v(" "),t("li",[s._v("增加一个 crontab 定时任务，定期续订证书："),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" * *  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". renew\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])])])])]),s._v(" "),t("h3",{attrs:{id:"acme-sh"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#acme-sh"}},[s._v("#")]),s._v(" acme.sh")]),s._v(" "),t("p",[s._v("：一个 shell 脚本，作为 ACME 客户端，与 Certbot 类似。")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://github.com/acmesh-official/acme.sh",target:"_blank",rel:"noopener noreferrer"}},[s._v("GitHub"),t("OutboundLink")],1)]),s._v(" "),t("li",[s._v("为很多种 DNS 服务商提供了对接插件。")]),s._v(" "),t("li",[s._v("例：通过 HTTP 方式申请证书"),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -it --rm "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -v "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PWD")]),s._v("/acme:/acme "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    neilpang/acme.sh:3.0.1 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    --issue -d test.com --webroot /www/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])])]),s._v(" "),t("li",[s._v("例：通过阿里云 DNS 申请证书\n"),t("ol",[t("li",[s._v("到阿里云插件 API 密钥，声明为环境变量："),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Ali_Key")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"******"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Ali_Secret")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"******"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])]),s._v(" "),t("li",[s._v("申请证书："),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -it --rm "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -v "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PWD")]),s._v("/acme:/acme "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    neilpang/acme.sh:3.0.1 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    --issue --dns dns_ali -d test.com -d *.test.com\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])])])])])])])}),[],!1,null,null,null);a.default=e.exports}}]);