(window.webpackJsonp=window.webpackJsonp||[]).push([[358],{758:function(s,a,t){"use strict";t.r(a);var e=t(1),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"磁盘管理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#磁盘管理"}},[s._v("#")]),s._v(" 磁盘管理")]),s._v(" "),t("h2",{attrs:{id:"磁盘分区"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#磁盘分区"}},[s._v("#")]),s._v(" 磁盘分区")]),s._v(" "),t("ul",[t("li",[s._v("磁盘设备中默认没有划分磁盘分区，可选创建多个磁盘分区，适合处理复杂任务：\n"),t("ul",[t("li",[s._v("磁盘分区之间相互独立，可采用不同的文件系统。")]),s._v(" "),t("li",[s._v("磁盘分区之间相互隔离，一个分区发生故障时不会影响到其它分区。")])])]),s._v(" "),t("li",[s._v("给 Linux 主机添加磁盘的步骤：\n"),t("ol",[t("li",[s._v("接入一个磁盘设备。")]),s._v(" "),t("li",[s._v("用 mkfs 命令将磁盘或磁盘分区格式化为某种文件系统。")]),s._v(" "),t("li",[s._v("用 mount 命令将文件系统挂载到主机的某个目录，供用户读写。")])])])]),s._v(" "),t("h3",{attrs:{id:"fdisk"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#fdisk"}},[s._v("#")]),s._v(" fdisk")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("fdisk")]),s._v("\n      -l          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示系统所有的磁盘及其磁盘分区")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("disk"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打开一个终端，对指定磁盘进行配置")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("ul",[t("li",[s._v("进入 fdisk 终端之后，可输入以下命令："),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("p      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示已有的磁盘分区")]),s._v("\nn      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建一个分区")]),s._v("\np      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 接着输入 p 会创建主分区，输入 e 会创建扩展分区")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 然后设置分区编号")]),s._v("\nEnter  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置起始扇区（按回车会使用默认值）")]),s._v("\n+20G   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置结束扇区（可指定扇区大小）")]),s._v("\nd      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除一个分区")]),s._v("\nw      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将设置内容保存")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])])])]),s._v(" "),t("h2",{attrs:{id:"swap-分区"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#swap-分区"}},[s._v("#")]),s._v(" Swap 分区")]),s._v(" "),t("p",[s._v("：交换分区，一种特殊的磁盘分区，用于临时存储内存中的数据。类似于 Windows 系统的磁盘虚拟内存。")]),s._v(" "),t("ul",[t("li",[s._v("Linux 会运行一个内核进程 kswapd0 ，负责管理 Swap 分区。\n"),t("ul",[t("li",[s._v("当物理内存 page 数不足时，会将某些暂时不用的 page 数据移到 Swap 分区中存储，该过程称为 swap out 。")]),s._v(" "),t("li",[s._v("当 CPU 在内存中找不到这些数据而报出主缺页异常时，会将数据从 Swap 分区载入内存，该过程称为 swap in 。")])])]),s._v(" "),t("li",[s._v("启用 Swap 分区可以缓解系统内存不足的问题，避免进程被 OOM 杀死。\n"),t("ul",[t("li",[s._v("但是 CPU 从磁盘 Swap 分区读写数据，比从物理内存读写数据慢得多，导致磁盘 IO 量变多、CPU 使用率增高（因为 iowait ）。\n"),t("ul",[t("li",[s._v("物理内存严重不足时，会反复进行 swap out 和 swap in ，导致 CPU 使用率为 100% 。")])])]),s._v(" "),t("li",[s._v("因此：\n"),t("ul",[t("li",[s._v("如果系统内存长期不足，应该增加物理内存。")]),s._v(" "),t("li",[s._v("如果系统内存长期足够，应该禁用 Swap 。")]),s._v(" "),t("li",[s._v("如果系统内存偶尔不足，才应该启用 Swap ，并调整内核参数 vm.swappiness 。")])])])])])]),s._v(" "),t("h3",{attrs:{id:"mkswap"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mkswap"}},[s._v("#")]),s._v(" mkswap")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkswap")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("device"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将一个 device 格式化成 swap 分区。device 可以是磁盘设备、磁盘分区或文件")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ul",[t("li",[s._v("例："),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@CentOS ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# dd if=/dev/zero of=/swapfile count=1024 bs=1M")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v("+0 records "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v("+0 records out\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1073741824")]),s._v(" bytes "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),s._v(" GB"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" copied, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.73547")]),s._v(" s, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("393")]),s._v(" MB/s\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@CentOS ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkswap /swapfile")]),s._v("\nSetting up swapspace version "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", size "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1048572")]),s._v(" KiB\nno label, "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("UUID")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("32de6480-099b-4ff1-b4f2-ea44b75ae430\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@CentOS ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# chmod 600 /swapfile")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@CentOS ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# swapon /swapfile")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])])]),s._v(" "),t("li",[s._v("编辑 /etc/fstab 文件，可以让系统开机时自动挂载 swap 分区："),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("/swapfile    swap    swap    defaults     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])])]),s._v(" "),t("h3",{attrs:{id:"swapon"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#swapon"}},[s._v("#")]),s._v(" swapon")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("swapon")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("device"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启用指定的 swap 分区")]),s._v("\n      -a          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启用 /etc/fstab 中定义的所有 swap 分区")]),s._v("\n      -s          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示已启用的所有 swap 分区")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"swapoff"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#swapoff"}},[s._v("#")]),s._v(" swapoff")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("swapoff\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("device"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 停用指定的 swap 分区")]),s._v("\n      -a          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 停用所有 swap 分区")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h2",{attrs:{id:"lvm"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#lvm"}},[s._v("#")]),s._v(" LVM")]),s._v(" "),t("p",[s._v("：逻辑卷管理器（Logical Volume Manager ，LVM），用于创建逻辑卷。")]),s._v(" "),t("ul",[t("li",[s._v("安装："),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" lvm2\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("目前常用的是 LVM v2 版本，向下兼容 v1 版本。")])])]),s._v(" "),t("li",[s._v("优点：\n"),t("ul",[t("li",[s._v("可以创建跨越多个存储设备的逻辑卷。")]),s._v(" "),t("li",[s._v("逻辑卷在创建之后可以改变容量，而传统的磁盘分区不支持。")])])]),s._v(" "),t("li",[s._v("使用步骤：\n"),t("ol",[t("li",[s._v("将单个块设备（比如磁盘、磁盘分区）格式化为物理卷（Physical Volume，PV）。\n"),t("ul",[t("li",[s._v("默认在物理卷开头的第二个扇区中存储 LVM Label 标签，包括 UUID、容量等信息。")]),s._v(" "),t("li",[s._v("物理卷划以物理盘区（Physical Extents，PE）为单位划分存储空间，默认为 4MB 。")])])]),s._v(" "),t("li",[s._v("将多个物理卷组成一个卷组（Volume Group，VG），提供一个存储资源池。")]),s._v(" "),t("li",[s._v("在卷组中创建逻辑卷（Logical Volume，LV）。\n"),t("ul",[t("li",[s._v("执行 fdisk -l 可看到逻辑卷，可格式化为文件系统，挂载后供用户读写。")])])])])]),s._v(" "),t("li",[s._v("逻辑卷的分类：\n"),t("ul",[t("li",[s._v("线性卷（linear volume）：将多个 pv 串联，从实际地址映射到逻辑卷的连续地址。")]),s._v(" "),t("li",[s._v("条状卷（striped volume）：将多个 pv 并联，数据轮流写入各个 pv 。")]),s._v(" "),t("li",[s._v("镜像卷（mirrored volume）：数据只写入一个 pv ，其它 pv 会同步拷贝，作为备份。")]),s._v(" "),t("li",[s._v("快照卷（snapshot volume）：对相同 VG 中的另一个逻辑卷进行快照备份。\n"),t("ul",[t("li",[s._v("采用写时复制（Copy On Write，COW）：快照卷内先保存指向数据 inode 的硬链接，当数据变化时才拷贝到快照卷。因此不会中断服务，支持增量备份。")])])])])])]),s._v(" "),t("h3",{attrs:{id:"pv"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pv"}},[s._v("#")]),s._v(" pv")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("lvmdiskscan           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 扫描本机的块设备，找出可格式化为 pv 的")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("pvcreate "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("device"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将块设备格式化为 pv")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("pvscan                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出本机已有的 pv")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("pvremove "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("pv"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除 pv")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("这会擦除块设备中的 LVM label 。")])]),s._v(" "),t("h3",{attrs:{id:"vg"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#vg"}},[s._v("#")]),s._v(" vg")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("vgcreate "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("vg"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("pv"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建一个 vg ，包含指定的 pv")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("vgdisplay             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出已有的 vg")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("vgrename "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("vg"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("vg"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重命名 vg")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("vgchange "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("vg"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改 vg 的配置")]),s._v("\n        -a "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("y"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --active ，是否启用")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("vgextend "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("vg"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("pv"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 给 vg 添加 pv")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("vgreduce "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("vg"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("pv"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从 vg 移除 pv")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("vg 只包含一个 pv 时，不能移除 pv ，只能删除整个 vg 。")])]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("vgremove "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("vg"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除 vg")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"lv"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#lv"}},[s._v("#")]),s._v(" lv")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("lvcreate "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("vg"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在 vg 中创建一个 lv ，默认为 linear 类型")]),s._v("\n        -L 50MB       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定容量，单位可以为 KB、MB、GB 等")]),s._v("\n        -i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建 striped 类型的 lv ，并指定 pv 的数量")]),s._v("\n\n        -v            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示详细的日志")]),s._v("\n        -vv           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示更详细的日志")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("ul",[t("li",[s._v("例："),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@CentOS ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# lvcreate vg1 -L 50MB")]),s._v("\n  Rounding up size to full physical extent "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("52.00")]),s._v(" MiB    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 自动将容量调整为 PE 的整数倍")]),s._v("\n  Logical volume "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lvol0"')]),s._v(" created.\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("ul",[t("li",[s._v("创建的 lv 会自动命名，编号从 0 递增。例如 lvol0 对应的设备路径为 /dev/vg1/lvol0 。")])])])]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("lvdisplay "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("lv"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出已有的 lv")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("lvrename "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("lv"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("lv"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重命名 lv")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("lvchange "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("lv"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改 lv 的配置")]),s._v("\n        -a "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("y"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --active ，是否启用")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("lvextend "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("lv"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 增加 lv 的容量")]),s._v("\n        -L 10MB       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 增加到指定大小")]),s._v("\n        -L +10MB      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 增加指定大小")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("lvreduce "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("lv"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 减少 lv 的容量")]),s._v("\n        -L 10MB       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 减少到指定大小")]),s._v("\n        -L -10MB      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 减少指定大小")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("lvremove "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("lv"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除 lv")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"文件系统"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#文件系统"}},[s._v("#")]),s._v(" 文件系统")]),s._v(" "),t("h3",{attrs:{id:"block"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#block"}},[s._v("#")]),s._v(" block")]),s._v(" "),t("p",[s._v("：文件系统读写数据时的最小单位。")]),s._v(" "),t("ul",[t("li",[s._v("即使一个文件只包含 1 byte 数据，存储时也要占用 1 个 block 。")]),s._v(" "),t("li",[s._v("不同磁盘分区的文件系统可以设置不同的 block size 。\n"),t("ul",[t("li",[s._v("例如，ext3 文件系统的 block size 默认为 4096 Bytes 。")])])]),s._v(" "),t("li",[s._v("碎片整理：将磁盘中存储同一个文件的 block 整理到一起，提高读写速度。")]),s._v(" "),t("li",[s._v("block group ：磁盘中的所有 block 被分成几组。")]),s._v(" "),t("li",[s._v("super block ：保存整个文件系统的信息，包括 block、inode 的数量、使用情况等。\n"),t("ul",[t("li",[s._v("一般位于第一个 block group 中。")])])])]),s._v(" "),t("h3",{attrs:{id:"inode"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#inode"}},[s._v("#")]),s._v(" inode")]),s._v(" "),t("p",[s._v("：索引节点（index node），用于记录一个文件在磁盘中的信息。")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("新建一个文件保存到磁盘时，系统会给它分配一些 block 用于存储，再分配一个 inode 用于记录文件信息。")])]),s._v(" "),t("li",[t("p",[s._v("每个 inode 有一个数字编号作为唯一标识。")]),s._v(" "),t("ul",[t("li",[s._v("inode 里会记录文件的元数据。主要是通过 stat 命令查看到的那些信息，比如文件类型、访问权限、指向该 inode 的硬链接数。")]),s._v(" "),t("li",[s._v("inode 里会记录文件内容存储在磁盘的哪些 block 中。")]),s._v(" "),t("li",[s._v("inode 里并不会记录文件名，文件名记录在目录文件中。\n"),t("ul",[t("li",[s._v("因此移动、重命名文件时，不会改变文件本身（最后修改时间不变），而会改变所属的目录文件。")])])])])]),s._v(" "),t("li",[t("p",[s._v("每个文件系统在创建时，会划分 block 的位置、inode 的总数，不能改变。")]),s._v(" "),t("ul",[t("li",[s._v("每个文件系统会在磁盘中存储一张索引表（inode table），记录所有已使用的 inode 的内容。")]),s._v(" "),t("li",[s._v("当指向一个 inode 的所有文件都被删除时，系统就会认为该 inode 及其 block 不再使用，可以释放，供新创建的文件使用。")])])]),s._v(" "),t("li",[t("p",[s._v("例：")]),s._v(" "),t("ul",[t("li",[s._v("假设 Linux 系统要读取路径为 path 的某个文件的内容，需要先查询到该文件路径对应的 inode 编号为 xxx 。然后到磁盘的 inode table 中，找到该 inode 的内容，知道该文件存储在哪些 block 。最后读取这些 block 。")]),s._v(" "),t("li",[s._v("不能直接根据一个 inode 反查出对应的文件路径，只能遍历大量文件才能找出来。")]),s._v(" "),t("li",[s._v("如果在同一个文件系统内用 "),t("code",[s._v("mv f1 f2")]),s._v(" 的方式移动文件，则新的文件依然使用之前的 inode ，不会在磁盘中重新拷贝一份数据，因此几乎不消耗时间。")]),s._v(" "),t("li",[s._v("在同一个文件系统内用 "),t("code",[s._v("echo Hello > f1")]),s._v(" 的方式修改文件时， inode 编号不会变化。用 "),t("code",[s._v("vim f1")]),s._v(" 的方式修改文件时，默认会先创建一个备份文件进行修改，然后替换原文件，因此 inode 编号会变化。")])])]),s._v(" "),t("li",[t("p",[s._v("例：在 Python 中编辑文件")]),s._v(" "),t("div",{staticClass:"language-py line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-py"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" f "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("open")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'f1'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'w+'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打开文件，这会自动分配一个文件描述符，并根据文件路径查询到 inode ，读取文件的内容")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" f"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("write"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Hello\\n'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 给文件写入内容，即使覆盖原有内容，即使写入很长的内容，也不会改变文件的 inode")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" f"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("name                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看文件名")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'f1'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" f"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("close"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭文件，即关闭文件描述符")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("ul",[t("li",[s._v("当 Python 编辑文件时，可以另开一个终端，执行 "),t("code",[s._v("mv f1 f2")]),s._v(" 重命名文件。在 Windows 上则不允许修改已打开的文件。\n"),t("ul",[t("li",[s._v("此时 Python 写入文件的内容会根据原 inode 写入磁盘，关联到 f2 。")]),s._v(" "),t("li",[s._v("不过在 Python 中执行 "),t("code",[s._v("f.name")]),s._v(" ，依然会返回最初的文件名 f1 ，不会根据 inode 反查出当前的文件名。")])])])])])]),s._v(" "),t("h3",{attrs:{id:"分类"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#分类"}},[s._v("#")]),s._v(" 分类")]),s._v(" "),t("ul",[t("li",[s._v("存储在磁盘中的文件系统举例：\n"),t("ul",[t("li",[s._v("ext2 ：扩展文件系统（extended file system）的第二代，于 1993 年开始被 Linux 内核使用。")]),s._v(" "),t("li",[s._v("ext3 ：兼容 ext2 。能记录日志，在非正常关机后能根据日志快速恢复关机时没有保存的数据，而不必扫描整个磁盘。")]),s._v(" "),t("li",[s._v("ext4 ：兼容 ext3 。支持更大的文件系统和文件，支持无限数量的子目录。是 RHEL6 的默认文件系统。")]),s._v(" "),t("li",[s._v("xfs ：一个优秀的日志文件系统。是 RHEL7 的默认文件系统。")]),s._v(" "),t("li",[s._v("btrfs")]),s._v(" "),t("li",[s._v("FAT ：1977 年由比尔盖茨发明。目前最常见的一种 FAT 系统是 FAT32 ，它限制了单个文件最大为 4G 。")]),s._v(" "),t("li",[s._v("NTFS ：1993 年由微软公司发明，适用于 Windows2000 及以后的 Windows 版本。单个文件没有大小限制。")])])]),s._v(" "),t("li",[s._v("存储在 flash 中的文件系统如下，常用于嵌入式系统：\n"),t("ul",[t("li",[s._v("jffs2")]),s._v(" "),t("li",[s._v("yaffs")]),s._v(" "),t("li",[s._v("cramfs ：一个只读的压缩文件系统。文件被压缩后节约了大量存储空间，要载入 RAM 时才解压缩。")]),s._v(" "),t("li",[s._v("romfs")])])]),s._v(" "),t("li",[s._v("存储在 RAM 中的文件系统如下，读写速度很快：\n"),t("ul",[t("li",[s._v("rootfs ：根目录系统。\n"),t("ul",[t("li",[s._v("它的挂载点是它自己的 / 目录。")]),s._v(" "),t("li",[s._v("Linux 系统启动时，内核会创建一个只读（read-only）模式的 rootfs 。启动完成之后，可以将 rootfs 切换成读写（read-write）模式，或者在它上面挂载其它文件系统。\n"),t("ul",[t("li",[s._v("比如将一个 ext4 文件系统挂载到 rootfs 的 / 目录，使得 rootfs 对用户不可见。")])])])])]),s._v(" "),t("li",[s._v("ramdisk ：一种较旧的内存文件系统，已被 tmpfs 取代。")]),s._v(" "),t("li",[s._v("tmpfs\n"),t("ul",[t("li",[s._v("Linux 系统默认创建了几个 tmpfs 文件系统并分别挂载到 /dev/shm、/run、/sys/fs/cgroup、/run/user/0 ，在这些目录下写入的文件会存储到 RAM 的共享内存（shared memory）中，也可能被存储到 Swap 分区。")]),s._v(" "),t("li",[s._v("挂载时，默认限制了每个 tmpfs 文件系统的体积为 RAM 内存的一半。可以手动修改，例如："),t("code",[s._v("mount -o remount,rw,nosuid,nodev,size=4G /dev/shm")])])])]),s._v(" "),t("li",[s._v("proc ：挂载到 /proc 目录。")]),s._v(" "),t("li",[s._v("sysfs ：挂载到 /sys 目录。")]),s._v(" "),t("li",[s._v("devtmpfs ：挂载到 /dev 目录。\n"),t("ul",[t("li",[s._v("Linux 内核 2.6 版本开始使用一个用户态的守护进程 systemd-udevd 管理 /dev 目录下的设备，取代了传统的 devfsd 进程。")])])])])]),s._v(" "),t("li",[s._v("存储在网络中的文件系统举例：\n"),t("ul",[t("li",[s._v("nfs ：网络文件系统（Network File System），可以让不同主机通过网络共享文件。")])])]),s._v(" "),t("li",[s._v("FUSE（Filesystem in USErspace）：类 Unix 系统内核提供的一种 API ，允许用户态进程创建、挂载文件系统，不必进入内核态。")])]),s._v(" "),t("h3",{attrs:{id:"mkfs"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mkfs"}},[s._v("#")]),s._v(" mkfs")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkfs")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("device"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将一个 device 格式化成某种文件系统。device 可以是磁盘设备、磁盘分区或文件")]),s._v("\n    -t "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("fs"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定文件系统，默认为 ext2")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ul",[t("li",[s._v("例："),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkfs")]),s._v(" -t ext4 /dev/vdb\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("如果 device 已存在文件系统，则会报错："),t("code",[s._v("/dev/vdb appears to contain an existing filesystem")])]),s._v(" "),t("li",[s._v("如果 device 已被挂载，则会报错："),t("code",[s._v("/dev/vdb contains a mounted filesystem")])])])])]),s._v(" "),t("h3",{attrs:{id:"mount"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mount"}},[s._v("#")]),s._v(" mount")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mount")]),s._v("                   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示已挂载的所有目录")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("fs"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("dir"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将一个文件系统挂载到指定目录")]),s._v("\n        -t ext4         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定文件系统的类型，默认会自动识别")]),s._v("\n        -r              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 挂载为只读模式")]),s._v("\n        -L "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sdb3"')]),s._v("       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加卷标")]),s._v("\n        -o options      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加一些挂载选项，以逗号分隔")]),s._v("\n    -a                  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 挂载 /etc/fstab 中定义的所有文件系统")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("ul",[t("li",[t("p",[s._v("例：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mount")]),s._v("  /dev/vdb  /data\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("挂载点必须已存在，否则会报错："),t("code",[s._v("mount point /data does not exist")])]),s._v(" "),t("li",[s._v("如果文件系统已挂载，或挂载点正在被某进程使用，则会报错："),t("code",[s._v("/dev/vdb is already mounted or /data busy")])])])]),s._v(" "),t("li",[t("p",[s._v("文件系统要挂载到主机目录树中某个目录，才能被用户读写。")]),s._v(" "),t("ul",[t("li",[s._v("被挂载的目录称为挂载点（mount point）。")]),s._v(" "),t("li",[s._v("挂载后，原本位于挂载点目录下的文件会对用户不可见，相当于被新的一层目录覆盖了。")]),s._v(" "),t("li",[s._v("例如：当系统插入 CD 之后会自动生成磁盘分区 /dev/cdrom ，要执行 "),t("code",[s._v("mount /dev/cdrom /media/cdrom")]),s._v(" 将它挂载，才能读写。")])])]),s._v(" "),t("li",[t("p",[s._v("常见的挂载选项：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("defaults    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认选项，一般为 async,auto,dev,exec,nouser,rw,suid")]),s._v("\nremount     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果该文件系统已挂载，则重新挂载。常用于将一个只读模式的文件系统挂载为读写模式，例如 mount -o remount,rw /dir")]),s._v("\n\nasync       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许异步 IO")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sync")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 禁止异步 IO ，只能同步 IO")]),s._v("\natime       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 自动更新 inode 的 access time ，默认启用该选项")]),s._v("\nnoatime\nrelatime    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果当前 modify time 比 access time 更新，则更新 access time")]),s._v("\nnorelatime\n\ndev         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许读写该文件系统中的设备文件")]),s._v("\nnodev\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许执行该文件系统中的二进制文件")]),s._v("\nnoexec\nsuid        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行该文件系统中的程序时，允许 SUID 文件权限")]),s._v("\nnosuid\n\nauto        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许被 mount -a 挂载")]),s._v("\nnoauto\nuser        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许被非 root 用户挂载、卸载")]),s._v("\nnouser\nro          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 以只读模式挂载")]),s._v("\nrw          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 以读写模式挂载")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("用 mount 命令挂载的目录在系统重启后不会再挂载，而在 /etc/fstab 文件中可以设置系统开机时自动挂载的目录，例如：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# device    mount_point   fs_type   options     dump  pass")]),s._v("\n/dev/vdb    /data         xfs       defaults    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n/swapfile   swap          swap      defaults    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("ul",[t("li",[s._v("dump 字段表示通过 dump 工具备份该文件系统的频率，可以取值："),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 不备份。这是默认值")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 每天备份一次")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 每 2 天备份一次")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),s._v("不过目前的 Linux 发行版一般没有安装 dump 工具。")]),s._v(" "),t("li",[s._v("pass 字段表示开机自检的顺序，可以取值："),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 不检查。这是默认值")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动时检查，检查不通过则不能正常开机，需要进入救援模式修复")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动之后才检查")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])])])])])]),s._v(" "),t("h3",{attrs:{id:"umount"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#umount"}},[s._v("#")]),s._v(" umount")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("umount")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("fs"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 卸载文件系统，需要指定对应的磁盘分区或挂载点")]),s._v("\n          -f      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 强制卸载")]),s._v("\n      -a          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 卸载所有文件系统")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"autofs"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#autofs"}},[s._v("#")]),s._v(" autofs")]),s._v(" "),t("p",[s._v("使用 autofs 服务可以在用户访问一个尚未挂载的文件系统时自动挂载它，降低空闲时的系统负载。")]),s._v(" "),t("h3",{attrs:{id:"df"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#df"}},[s._v("#")]),s._v(" df")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("df")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示系统所有文件系统的信息")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("file"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示指定文件所属的文件系统的信息")]),s._v("\n    -h      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 以人类容易阅读的单位显示文件大小（默认单位为 kBytes）")]),s._v("\n    -i      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示 inode 的数量、使用率")]),s._v("\n    -a      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示所有文件系统（包括 proc、swap）")]),s._v("\n    -T      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 增加显示文件系统的类型")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h3",{attrs:{id:"扩容"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#扩容"}},[s._v("#")]),s._v(" 扩容")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("如果增加了磁盘设备的容量，用 fdisk -l 命令可看到其容量变化，但其中的磁盘分区、文件系统的容量并不会改变，还需要手动扩容。")])]),s._v(" "),t("li",[t("p",[s._v("常见的扩容方案：")]),s._v(" "),t("ul",[t("li",[s._v("格式化：取消挂载磁盘，重新创建磁盘分区，然后格式化为文件系统。")]),s._v(" "),t("li",[s._v("在线扩容：如果存在磁盘分区则用 growpart 命令扩容，然后用 resize2fs 命令扩容文件系统。")])])]),s._v(" "),t("li",[t("p",[s._v("相关命令：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("growpart "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("disk"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 扩展磁盘中的 n 号磁盘分区。这会修改分区表，使它占据后续的所有磁盘空间，直到磁盘末尾或下一个分区")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("resize2fs "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("device"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("size"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 调整文件系统的容量")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("resize2fs 命令支持处理 ext2、ext3、ext4 文件系统。\n"),t("ul",[t("li",[s._v("文件系统已挂载时，支持在线扩容，但不支持在线缩容。")]),s._v(" "),t("li",[s._v("size 可使用 K、M、G、T 等单位。如果未指定 size ，则默认占用 device 的全部容量。")])])]),s._v(" "),t("li",[s._v("例："),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("growpart  /dev/vdb  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nresize2fs /dev/vdb\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])])])])]),s._v(" "),t("h2",{attrs:{id:"数据备份"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数据备份"}},[s._v("#")]),s._v(" 数据备份")]),s._v(" "),t("p",[s._v("按实现方式分类:")]),s._v(" "),t("ul",[t("li",[s._v("物理备份\n"),t("ul",[t("li",[s._v("：直接拷贝文件，甚至拷贝整个磁盘。")]),s._v(" "),t("li",[s._v("这样拷贝、恢复的速度很快，接近磁盘的读写速度上限。但是会拷贝多余的数据。")])])]),s._v(" "),t("li",[s._v("逻辑备份\n"),t("ul",[t("li",[s._v("：从每个文件中读取要备份的数据，然后拷贝到其它文件中。")]),s._v(" "),t("li",[s._v("这样备份速度慢，但是占用磁盘空间小。")])])])]),s._v(" "),t("p",[s._v("按是否停止服务分类:")]),s._v(" "),t("ul",[t("li",[s._v("在线备份\n"),t("ul",[t("li",[s._v("：又称为热备份，在备份的同时保持提供服务，允许用户访问服务器。")])])]),s._v(" "),t("li",[s._v("离线备份\n"),t("ul",[t("li",[s._v("：又称为冷备份，通常需要停止服务器，中断服务。")])])])]),s._v(" "),t("p",[s._v("按备份策略分类:")]),s._v(" "),t("ul",[t("li",[s._v("完全备份\n"),t("ul",[t("li",[s._v("：将所有文件都备份。")]),s._v(" "),t("li",[s._v("这种备份策略最简单，恢复速度最快，但是备份速度最慢。")])])]),s._v(" "),t("li",[s._v("增量备份\n"),t("ul",[t("li",[s._v("：只备份上一次备份操作后的改动记录，恢复文件时需要按顺序使用每一次增量备份，任何一次增量备份都不能出问题。")]),s._v(" "),t("li",[s._v("这样备份速度最快，每次占用的磁盘空间也小，但是可靠性最低，恢复速度最慢。")])])]),s._v(" "),t("li",[s._v("差异备份\n"),t("ul",[t("li",[s._v("：将上一次完全备份后的改动记录都备份下来，这样恢复文件时只需要使用一个完全备份和一个差异备份。")]),s._v(" "),t("li",[s._v("效果介于完全备份与增量备份之间。")])])])])])}),[],!1,null,null,null);a.default=n.exports}}]);