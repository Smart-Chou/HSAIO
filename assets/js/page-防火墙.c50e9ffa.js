(window.webpackJsonp=window.webpackJsonp||[]).push([[418],{754:function(s,a,t){"use strict";t.r(a);var n=t(1),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"防火墙"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#防火墙"}},[s._v("#")]),s._v(" 防火墙")]),s._v(" "),t("h2",{attrs:{id:"iptables"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#iptables"}},[s._v("#")]),s._v(" iptables")]),s._v(" "),t("ul",[t("li",[s._v("RHEL 7 之前默认使用 iptables 工具来管理防火墙。")]),s._v(" "),t("li",[s._v("iptables 会将用户配置的规则传给内核的 netfilter 网络过滤器处理。\n"),t("ul",[t("li",[s._v("netfilter 会从上到下读取用户配置的规则，一旦找到匹配的规则就立即执行，没有找到则执行默认规则。")])])]),s._v(" "),t("li",[s._v("iptables 默认定义了四个规则表：\n"),t("ul",[t("li",[s._v("raw")]),s._v(" "),t("li",[s._v("mangle")]),s._v(" "),t("li",[s._v("nat ：用于端口转发、NAT 地址转换。")]),s._v(" "),t("li",[s._v("filter ：用于定义流量出入规则，过滤数据包。\n"),t("ul",[t("li",[s._v("每个规则表包含多个规则链。")]),s._v(" "),t("li",[s._v("网络传输的数据包会按 raw > mangle > nat > filter 的优先级依次被四个规则表处理。")])])])])]),s._v(" "),t("li",[s._v("每类规则称为一个规则链。常见的几类规则：\n"),t("ul",[t("li",[s._v("INPUT ：处理接收的数据包。")]),s._v(" "),t("li",[s._v("OUTPUT ：处理发出的数据包。")]),s._v(" "),t("li",[s._v("FORWARD ：处理路由转发的数据包。")]),s._v(" "),t("li",[s._v("PREROUTING ：在选择路由之前处理数据包，比如修改目标 IP 。")]),s._v(" "),t("li",[s._v("POSTROUTING ：在选择路由之后处理数据包，比如修改源 IP 。")])])]),s._v(" "),t("li",[s._v("常见的几种动作（target）：\n"),t("ul",[t("li",[s._v("ACCEPT\n"),t("ul",[t("li",[s._v("：允许数据包通过。")])])]),s._v(" "),t("li",[s._v("REJECT\n"),t("ul",[t("li",[s._v("：拒绝数据包通过，并回复一条拒绝信息给发送方。")]),s._v(" "),t("li",[s._v("不能用作默认动作。")])])]),s._v(" "),t("li",[s._v("DROP\n"),t("ul",[t("li",[s._v("：丢弃数据包，并且不作出回复。这可能导致发送方误以为网络不通。")])])]),s._v(" "),t("li",[s._v("LOG\n"),t("ul",[t("li",[s._v("：记录日志。")]),s._v(" "),t("li",[s._v("日志规则应该放在其它规则之前。因为执行日志规则之后还会执行后续规则，但执行其它动作之后就会结束规则链。")])])]),s._v(" "),t("li",[s._v("DNAT\n"),t("ul",[t("li",[s._v("：修改数据包的目标 IP、PORT 。")]),s._v(" "),t("li",[s._v("只能用于 nat 表的 OUTPUT 或 PREROUTING 链。")])])]),s._v(" "),t("li",[s._v("SNAT\n"),t("ul",[t("li",[s._v("：修改数据包的源 IP、PORT 。")]),s._v(" "),t("li",[s._v("只能用于 nat 表的 INPUT 或 POSTROUTING 链。")])])]),s._v(" "),t("li",[s._v("REDIRECT ：将数据包重定向到本机的某个端口。\n"),t("ul",[t("li",[s._v("与 DNAT 动作类似，会修改数据包的目标地址，但还会记录旧的目标地址，便于实现代理转发。")]),s._v(" "),t("li",[s._v("另外，mangle 表的 TPROXY 动作可将数据包重定向到本机某个 Socket ，且不修改数据包的目标地址。")])])])])])]),s._v(" "),t("h3",{attrs:{id:"安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" iptables-services\nsystemctl start iptables\nsystemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" iptables\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#命令"}},[s._v("#")]),s._v(" 命令")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("$ iptables\n          -L "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("chain"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示所有规则，或只显示某个规则链")]),s._v("\n            -n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将服务名显示成具体的端口号")]),s._v("\n            -v                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示详细的信息")]),s._v("\n            --line-numbers    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示行号")]),s._v("\n          -I "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("chain"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编辑某个规则链，插入一条新规则到第 n 行，默认是第一行")]),s._v("\n          -A "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("chain"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编辑某个规则链，添加一条新规则到最后一行")]),s._v("\n          -D "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("chain"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除规则链的第 n 行")]),s._v("\n          -F "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("chain"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 清空某个规则链，不指定 chain 则清空所有规则链")]),s._v("\n          -P "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("chain"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("target"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置某个规则链的默认动作")]),s._v("\n\n          -t filter           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定表，默认指定 filter 表")]),s._v("\n          -p "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("protocal"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定协议")]),s._v("\n          -s "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("ip"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定源地址")]),s._v("\n          -d "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("ip"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定目的地址")]),s._v("\n          --sport "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定源端口")]),s._v("\n          --dport "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定目的端口")]),s._v("\n          -j "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("target"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定动作")]),s._v("\n          -i eth0             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定 input 的网卡")]),s._v("\n          -o eth0             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定 output 的网卡")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("ul",[t("li",[t("p",[s._v("例：给 filter 表添加规则")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("iptables -D INPUT                                                 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除 INPUT 规则链")]),s._v("\niptables -P INPUT DROP                                            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置 INPUT 规则链的默认动作为 DROP")]),s._v("\niptables -I INPUT -p icmp -j REJECT                               "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在 INPUT 规则链的开头插入一条新规则，拒绝接收 icmp 数据包")]),s._v("\niptables -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许接收本机发起的连接的响应")]),s._v("\niptables -A INPUT -p tcp --dport "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" -j ACCEPT                     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许所有 IP 地址发送 tcp 数据包到 80 端口")]),s._v("\niptables -I INPUT -p tcp -s "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.0/24 --dport "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" -j ACCEPT  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许指定 IP 地址网段发送 tcp 数据包到 22 端口")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("ul",[t("li",[s._v("可以重复添加同样的规则。")]),s._v(" "),t("li",[s._v("指定多个端口的语法："),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("--dport "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":90                     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定一组连续的端口")]),s._v("\n--match multiport --dport "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80,90")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定多个端口，用逗号分隔")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])])])]),s._v(" "),t("li",[t("p",[s._v("例：查看详细的 INPUT 规则")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@CentOS ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# iptables -nvL  INPUT  --line-numbers")]),s._v("\nChain INPUT "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("policy ACCEPT "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" packets, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" bytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nnum   pkts bytes target     prot opt "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("     out     "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v("               destination\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2819")]),s._v("  446K ACCEPT     tcp  --  *      *       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0/0            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0/0            tcp dpt:80\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50557")]),s._v("  383M ACCEPT     all  --  *      *       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0/0            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0/0            ctstate RELATED,ESTABLISHED\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" ACCEPT     all  --  lo     *       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0/0            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0/0\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("53")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4960")]),s._v(" DROP       all  --  *      *       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0/0            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0/0            ctstate INVALID\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("484")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("26644")]),s._v(" REJECT     all  --  *      *       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0/0            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0/0            reject-with icmp-host-prohibited\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("各字段含义：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("pkts          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 该规则已匹配的数据包数")]),s._v("\nbytes         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 该规则已匹配的数据包总大小")]),s._v("\ntarget        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 该规则采取的动作")]),s._v("\nprot          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 该规则针对的协议")]),s._v("\nopt           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 该规则的选项")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 该规则针对从哪个网卡流入的数据包")]),s._v("\nout           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 该规则针对从哪个网卡流出的数据包")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 该规则针对哪个源地址的数据包")]),s._v("\ndestination   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 该规则针对哪个目的地址的数据包")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("例：给 nat 表添加规则")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("iptables -t nat -A OUTPUT -p tcp -d "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.0/24 --dport "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" -j REDIRECT --to-ports "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 采用 REDIRECT 动作，将发向指定目标 IP、PORT 的流量，重定向到本机的 80 端口")]),s._v("\niptables -t nat -A OUTPUT -p tcp -d "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.0/24 --dport "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" -j DNAT --to-destination "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.1:80  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 采用 DNAT 动作")]),s._v("\niptables -t nat -A POSTROUTING -p tcp -s "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.1 -j SNAT --to-source "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),s._v(".1.1                       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 采用 SNAT 动作")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("例：记录日志")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("iptables -t nat -I OUTPUT -d "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".21.0/24 -j LOG --log-level info --log-prefix "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'<iptables log>'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" -f /var/log/messages "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'<iptables log>'")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("执行 "),t("code",[s._v("service iptables save")]),s._v(" 会将 iptables 的当前配置保存到 /etc/sysconfig/iptables 文件中，每次系统重启时会自动读取。")]),s._v(" "),t("ul",[t("li",[s._v("可以手动导入、导出 iptables 的配置："),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("iptables-save "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" iptables.conf       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 导出到一个文件")]),s._v("\niptables-restore "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" iptables.conf    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从文件中导入")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])])])])]),s._v(" "),t("h2",{attrs:{id:"firewalld"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#firewalld"}},[s._v("#")]),s._v(" firewalld")]),s._v(" "),t("ul",[t("li",[s._v("RHEL 7 开始默认使用 firewalld 工具来管理防火墙。\n"),t("ul",[t("li",[s._v("iptables 和 firewalld 两个防火墙可以同时起作用。但同时使用容易搞混规则，建议将一个防火墙关闭或默认允许所有流量，只使用另一个防火墙。")]),s._v(" "),t("li",[s._v("重启 firewalld 时会自动重置 iptables 规则。")]),s._v(" "),t("li",[s._v("firewalld 从 0.6.0 版本开始，将默认后端从 iptables 改为 nftables 。")])])]),s._v(" "),t("li",[s._v("firewalld 引入了区域（zone）的设定，用户可以在各个 zone 中分别配置防火墙，然后通过切换 zone 来快速切换防火墙。常用的 zone 如下：\n"),t("ul",[t("li",[s._v("trusted ：允许接收所有数据包。")]),s._v(" "),t("li",[s._v("home 、internal ：只允许接收 ssh mdns samba-client dhcpv6-client 服务的数据包。")]),s._v(" "),t("li",[s._v("work 、public ：只允许接收 ssh、dhcpv6-client 服务的数据包。")]),s._v(" "),t("li",[s._v("external 、dmz ：只允许接收 ssh 服务的数据包。")]),s._v(" "),t("li",[s._v("block 、drop ：不接收外部发来的数据包。")]),s._v(" "),t("li",[s._v("所有的 zone 默认都允许发出数据包、接收回复本机的数据包。")])])]),s._v(" "),t("li",[s._v("firewalld 各个区域的配置文件以 XML 文件的形式保存在 /etc/firewalld/zones/ 目录下。")])]),s._v(" "),t("h3",{attrs:{id:"安装-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装-2"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" firewalld\nsystemctl start firewalld\nsystemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" firewalld\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"命令-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#命令-2"}},[s._v("#")]),s._v(" 命令")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("$ firewall-cmd\n              --get-zones                 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示所有区域的名字")]),s._v("\n              --get-active-zones          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示当前激活的区域")]),s._v("\n              --get-default-zone          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示默认区域的名称")]),s._v("\n              --set-default-zone"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("public   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置默认区域")]),s._v("\n\n              --get-zone-of-interface"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("eth0            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示指定网卡采用的区域")]),s._v("\n              --change-interface"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("eth0 --zone"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("public   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改指定网卡采用的区域")]),s._v("\n\n              "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("--zone"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("public"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("                         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 选择指定区域进行配置，不声明则是选择默认区域")]),s._v("\n                            --list-all                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示区域的信息")]),s._v("\n                            --add-service"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许接收 http 服务（即 TCP 80 端口）的数据包")]),s._v("\n                            --remove-service"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拒绝接收")]),s._v("\n                            --add-port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/tcp         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许接收发送到 TCP 80 端口的数据包")]),s._v("\n                            --add-port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("-82/tcp      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开放一组端口")]),s._v("\n                            --remove-port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/tcp      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拒绝接收")]),s._v("\n\n              --config_something"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". --permanent       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将配置写入配置文件（从而会永久保存，但是需要重启或 reload 才会生效）")]),s._v("\n              --runtime-to-permanent                  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将运行时的所有配置写入配置文件")]),s._v("\n              --reload                                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重新加载 firewall 的配置文件（这会覆盖运行时的配置）")]),s._v("\n              --complete-reload                       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 完全重新加载（这会丢失所有运行时的配置）")]),s._v("\n\n              --panic-on                              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启 panic 模式，拒绝接收所有数据包")]),s._v("\n              --panic-off                             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭 panic 模式")]),s._v("\n              --query-panic                           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示是否开启了 panic 模式")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br")])]),t("ul",[t("li",[t("p",[s._v("使用 "),t("code",[s._v("--add-service")]),s._v(" 的效果与 "),t("code",[s._v("--add-port")]),s._v(" 一样，只是标明了开放的端口是被哪个服务使用。")])]),s._v(" "),t("li",[t("p",[s._v('指定 IP 地址时，可以加上子网掩码，比如"10.0.0.1/32"。')])]),s._v(" "),t("li",[t("p",[s._v("例：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@CentOS ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# firewall-cmd --list-all")]),s._v("\npublic "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("active"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  target: default                                   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 处理数据包的默认动作（比如 ACCEPT、DROP）")]),s._v("\n  icmp-block-inversion: no\n  interfaces: eth0                                  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 应用的网卡")]),s._v("\n  sources:\n  services: "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" dhcpv6-client                       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许接收哪些服务的数据包")]),s._v("\n  ports: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),s._v("/tcp\n  protocols:\n  masquerade: "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n  forward-ports: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("port")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":proto"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tcp:toaddr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.2  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 端口转发的规则")]),s._v("\n  source-ports:\n  icmp-blocks:\n  rich rules:\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("通过 rich-rule 可以配置更丰富的防火墙规则，如下：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("firewall-cmd "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("--zone"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("public"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n                            --add-rich-rule"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rule family=ipv4 port port=22 protocol=tcp accept'")]),s._v("\n                            --add-rich-rule"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rule family=ipv4 source address=10.0.0.2 port port=80 protocol=tcp accept'")]),s._v("\n                            --remove-rich-rule"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'...'")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])])])]),s._v(" "),t("h3",{attrs:{id:"端口转发"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#端口转发"}},[s._v("#")]),s._v(" 端口转发")]),s._v(" "),t("p",[s._v("防火墙能够将本机网卡某个端口收到的数据包转发到另一个端口，甚至是其它网卡的端口。")]),s._v(" "),t("p",[s._v("命令：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("firewall-cmd "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("--zone"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("public"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n                            --add-forward-port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":proto"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tcp:toport"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将本机 TCP 80 端口收到的数据包转发到 8080 端口")]),s._v("\n                            --add-forward-port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":proto"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tcp:toaddr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.2            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将 TCP 80 端口收到的数据包转发到另一个主机的相同端口")]),s._v("\n                            --add-forward-port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":proto"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tcp:toport"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":toaddr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.2  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将 TCP 80 端口收到的数据包转发到另一个主机的 80 端口")]),s._v("\n                            --remove-forward-port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".                                       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 取消端口转发")]),s._v("\n\n                            --add-masquerade     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启伪装")]),s._v("\n                            --remove-masquerade  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 取消伪装")]),s._v("\n\n                            --add-rich-rule"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rule family=ipv4 source address=10.0.0.3 forward-port port=80 protocol=tcp to-port=80 to-addr=10.0.0.2"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许接收数据包，并进行端口转发")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("ul",[t("li",[s._v("端口转发时不需要本机有进程监听该端口。")]),s._v(" "),t("li",[s._v("只能转发外部发给本机的数据包，不能转发本机内部发出的数据包。不如 iptables 的 NAT 功能。")]),s._v(" "),t("li",[s._v("跨网卡转发数据包时，需要先启用如下内核参数："),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /proc/sys/net/ipv4/ip_forward\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),s._v("还需要开启 masquerade 伪装，从而在转发时将数据包的源 IP 改为本机接收它时的 IP 。")])]),s._v(" "),t("h2",{attrs:{id:"相关概念"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#相关概念"}},[s._v("#")]),s._v(" 相关概念")]),s._v(" "),t("ul",[t("li",[s._v("有状态防火墙（stateful firewall）\n"),t("ul",[t("li",[s._v("：能记录数据包的上下文信息，据此过滤数据包。")]),s._v(" "),t("li",[s._v("其它类型的防火墙称为无状态，只能根据源地址、目标地址等信息过滤数据包。")]),s._v(" "),t("li",[s._v("例：\n"),t("ul",[t("li",[s._v("Linux 的 iptables、firewalld 都属于有状态防火墙。")]),s._v(" "),t("li",[s._v("TCP 握手成功之后，就会将该 Socket 添加到状态表中。即使有状态防火墙关闭相应的端口，也不会中断该 Socket 连接，可以继续通信。")]),s._v(" "),t("li",[s._v("UDP 是无连接的，因此有状态防火墙关闭端口之后，就不能继续通信。")])])])])])])])}),[],!1,null,null,null);a.default=e.exports}}]);